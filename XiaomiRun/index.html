<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∞èÁ±≥Â§áË∑ëÁΩë - BLËß£ÈîÅÊ®°ÊãüÂô®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        /* Ê≥ïÂæãÂ£∞ÊòéÂºπÁ™óÊ†∑Âºè */
        .legal-modal {
            display: flex;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
        }

        .legal-content {
            background-color: #ffffff;
            margin: 5% auto;
            padding: 30px;
            border: none;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.5s ease;
            position: relative;
        }

        .legal-header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 3px solid #dc3545;
            padding-bottom: 15px;
        }

        .legal-title {
            font-size: 1.8em;
            color: #dc3545;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .legal-subtitle {
            color: #666;
            font-size: 1em;
        }

        .legal-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }

        .legal-section h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .legal-section p, .legal-section li {
            color: #555;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .legal-section ul {
            margin-left: 20px;
        }

        .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #856404;
        }

        .warning-box h3 {
            color: #856404;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3em;
        }

        .contact-box {
            background: #e7f3ff;
            border: 2px solid #007bff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #004085;
            text-align: center;
        }

        .contact-box h3 {
            color: #004085;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .contact-email {
            font-family: monospace;
            background: rgba(0, 123, 255, 0.1);
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: bold;
            margin: 5px 0;
            display: inline-block;
        }

        .legal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .legal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .accept-btn {
            background: #28a745;
            color: white;
        }

        .accept-btn:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }

        .reject-btn {
            background: #dc3545;
            color: white;
        }

        .reject-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .game-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            min-height: 100vh;
            padding-bottom: 120px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #ff6b6b;
            padding-bottom: 20px;
            position: relative;
        }

        .about-btn {
            background: #17a2b8;
            border: 2px solid #138496;
            border-radius: 20px;
            padding: 8px 15px;
            color: white;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            position: absolute;
            top: 0;
            right: 0;
        }

        .about-btn:hover {
            background: #138496;
            transform: translateY(-1px);
        }

        .logo {
            font-size: 4em;
            margin-bottom: 10px;
            cursor: pointer;
            transition: transform 0.3s ease;
            display: inline-block;
        }

        .logo:hover {
            transform: rotate(10deg) scale(1.1);
        }

        .title {
            font-size: 3em;
            color: #ff6b6b;
            margin-bottom: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
            font-weight: bold;
            text-align: center;
        }

        .game-area {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 25px;
            min-height: 400px;
            overflow-y: auto;
            width: 100%;
        }

        .story-text {
            font-size: 1.3em;
            line-height: 1.8;
            color: #333;
            margin-bottom: 30px;
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }

        .choice-btn {
            background: #007bff;
            border: 2px solid #0056b3;
            border-radius: 8px;
            padding: 15px 20px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            font-weight: 500;
        }

        .choice-btn:hover:not(:disabled) {
            background: #0056b3;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .choice-btn:disabled {
            background-color: #6c757d;
            border-color: #5a6268;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .choice-btn.danger {
            background: #dc3545;
            border-color: #c82333;
        }

        .choice-btn.danger:hover:not(:disabled) {
            background: #c82333;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .choice-btn.neutral {
            background: #ffc107;
            border-color: #e0a800;
            color: #000;
        }

        .choice-btn.neutral:hover:not(:disabled) {
            background: #e0a800;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .choice-btn.special {
            background: #6f42c1;
            border-color: #5a32a3;
            position: relative;
            font-weight: bold;
        }

        .choice-btn.special:hover:not(:disabled) {
            background: #5a32a3;
            box-shadow: 0 4px 12px rgba(111, 66, 193, 0.3);
        }

        .choice-btn.special::before {
            content: '‚ú®';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .choice-btn.deadly {
            background: #6c1e2b;
            border-color: #4a1419;
            position: relative;
            animation: pulse 2s infinite;
        }

        .choice-btn.deadly::before {
            content: 'üíÄ';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(108, 30, 43, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(108, 30, 43, 0); }
            100% { box-shadow: 0 0 0 0 rgba(108, 30, 43, 0); }
        }

        .start-btn {
            background: #28a745;
            border: 2px solid #1e7e34;
            border-radius: 50px;
            padding: 20px 40px;
            color: white;
            font-size: 1.4em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            display: block;
            margin: 30px auto;
        }

        .start-btn:hover {
            background: #1e7e34;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        }

        /* Á¥ßÂáëÊÇ¨ÊµÆÁä∂ÊÄÅÊ†è */
        .stats-dock {
            position: fixed;
            bottom: 15px;
            right: 15px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            display: none;
            animation: slideIn 0.3s ease-out;
            transition: all 0.2s ease;
            color: white;
            font-size: 0.85em;
            min-width: 200px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stats-dock:hover {
            background: rgba(0, 0, 0, 0.95);
            transform: scale(1.02);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .dock-content {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .dock-toggle {
            position: absolute;
            top: -8px;
            right: -8px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7em;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dock-toggle:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
        }

        .stat-section {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 0;
        }

        .stat-label {
            font-size: 0.75em;
            font-weight: bold;
            min-width: 35px;
            color: rgba(255, 255, 255, 0.9);
        }

        .stat-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            height: 8px;
            width: 60px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 6px;
        }

        .stat-text {
            font-size: 0.7em;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            min-width: 25px;
            text-align: right;
        }

        .random-event {
            background: #e7f3ff;
            border: 2px solid #007bff;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            animation: eventPop 0.5s ease-out;
        }

        @keyframes eventPop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .minigame-container {
            background: #fff3cd;
            border: 3px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }

        .reaction-game {
            margin: 20px 0;
        }

        .reaction-btn {
            background: #dc3545;
            border: none;
            border-radius: 50%;
            width: 100px;
            height: 100px;
            color: white;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .reaction-btn.active {
            background: #28a745;
            animation: bounce 0.3s ease;
        }
        
        .reaction-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
            opacity: 0.7;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            80% { transform: translateY(-10px); }
        }

        .skill-points-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }

        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 2000;
            animation: achievementSlide 3s ease-out forwards;
            border: 2px solid #1e7e34;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        @keyframes achievementSlide {
            0% { transform: translateX(100%); opacity: 0; }
            10%, 90% { transform: translateX(0); opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }

        .inventory {
            background: #ffffff;
            border: 2px solid #6c757d;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .inventory-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #6c757d;
            text-align: center;
        }

        .inventory-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .inventory-item {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .inventory-item.rare {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .inventory-item.legendary {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }

        .result {
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.4em;
            font-weight: bold;
            text-align: center;
            border: 3px solid;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border-color: #28a745;
        }

        .result.failure {
            background: #f8d7da;
            color: #721c24;
            border-color: #dc3545;
        }

        .result.caught {
            background: #fff3cd;
            color: #856404;
            border-color: #ffc107;
        }

        .result.death {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #17a2b8;
        }

        .result.legendary {
            background: #fff3cd;
            color: #856404;
            border-color: #ffc107;
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.5);
        }

        .reset-btn {
            background: #6c757d;
            border: 1px solid #5a6268;
            border-radius: 20px;
            padding: 10px 20px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.2s ease;
        }

        .reset-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .share-btn {
            background: #1da1f2;
            border: 1px solid #1991db;
            border-radius: 20px;
            padding: 10px 20px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.2s ease;
        }

        .share-btn:hover {
            background: #1991db;
            transform: translateY(-1px);
        }

        .revoke-btn {
            background: #dc3545;
            border: 1px solid #c82333;
            border-radius: 20px;
            padding: 10px 20px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.2s ease;
        }

        .revoke-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .hidden-menu {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #343a40;
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
            display: none;
            z-index: 1000;
            border: 2px solid #6c757d;
        }

        .timer {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(52, 58, 64, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.1em;
            border: 2px solid #6c757d;
            backdrop-filter: blur(10px);
            z-index: 1001;
        }

        .final-escape-area {
            background: #ffe6e6;
            border: 3px solid #ff4444;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
        }

        .danger-indicator {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #ff4444;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .konami-input {
            position: fixed;
            top: -100px;
            left: -100px;
            opacity: 0;
        }

        /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: none;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s ease;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 15px;
            right: 20px;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .close:hover,
        .close:focus {
            color: #dc3545;
        }

        .modal h2 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
        }

        .author-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .author-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .author-link {
            color: #fff3cd;
            text-decoration: none;
            font-weight: 500;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            transition: all 0.2s ease;
        }

        .author-link:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .disclaimer {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #856404;
            line-height: 1.6;
        }

        .disclaimer h3 {
            color: #856404;
            margin-bottom: 15px;
            text-align: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from { 
                opacity: 0;
                transform: translateY(-50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ÁßªÂä®Á´ØÈÄÇÈÖç */
        @media (max-width: 768px) {
            .legal-content {
                width: 95%;
                padding: 20px;
                margin: 2% auto;
            }

            .legal-buttons {
                flex-direction: column;
                align-items: center;
            }

            .legal-btn {
                width: 80%;
                max-width: 200px;
            }

            .game-container {
                padding: 15px;
                padding-bottom: 120px;
            }
            
            .title {
                font-size: 2.2em;
            }
            
            .story-text {
                font-size: 1.1em;
                padding: 20px;
            }

            .dock-content {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .stat-section {
                width: 100%;
                justify-content: center;
            }

            .stats-dock {
                padding: 8px 12px;
            }

            .modal-content {
                margin: 10% auto;
                padding: 20px;
                width: 90%;
                max-height: 85vh;
            }
            
            .about-btn {
                font-size: 0.8em;
                padding: 6px 12px;
            }
        }

        @media (max-width: 480px) {
            .game-container {
                padding-bottom: 100px;
            }

            .stats-dock {
                padding: 6px 10px;
            }

            .stat-bar {
                width: 60px;
                height: 10px;
            }

            .stat-section {
                padding: 6px 8px;
                gap: 6px;
            }
        }

    </style>
</head>
<body>
    <!-- Ê≥ïÂæãÂ£∞ÊòéÂºπÁ™ó -->
    <div id="legalModal" class="legal-modal">
        <div class="legal-content">
            <div class="legal-header">
                <div class="legal-title">‚öñÔ∏è Ê≥ïÂæãÂ£∞Êòé‰∏éÁî®Êà∑ÂçèËÆÆ</div>
                <div class="legal-subtitle">ËØ∑‰ªîÁªÜÈòÖËØª‰ª•‰∏ãÊù°Ê¨æ</div>
            </div>

            <div class="warning-box">
                <h3>üö® ÈáçË¶ÅÊèêÈÜí</h3>
                <p><strong>Êú¨ÁΩëÁ´ôÊòØÁ∫ØÂ®±‰πêÊÄßË¥®ÁöÑÊñáÂ≠óÂÜíÈô©Ê∏∏ÊàèÔºåÊâÄÊúâÂÜÖÂÆπÂùá‰∏∫ËôöÊûÑÔºå‰∏é‰ªª‰ΩïÁúüÂÆûÂìÅÁâå„ÄÅÁúüÂÆûËß£ÈîÅÊñπÊ≥ïÊó†ÂÖ≥„ÄÇ</strong></p>
            </div>

            <div class="legal-section">
                <h3>üìã ÁΩëÁ´ôÊÄßË¥®Â£∞Êòé</h3>
                <ul>
                    <li><strong>Á∫ØÂ®±‰πêÊ∏∏ÊàèÔºö</strong>Êú¨ÁΩëÁ´ôÊèê‰æõÁöÑÊòØÊñáÂ≠óÂÜíÈô©Ê∏∏ÊàèÔºå‰∏çÂåÖÂê´‰ªª‰ΩïÁúüÂÆûÁöÑÊäÄÊúØÊåáÂØºÊàñÁ†¥Ëß£Â∑•ÂÖ∑</li>
                    <li><strong>ÂÜÖÂÆπÔºö</strong>ÊâÄÊúâÊ∏∏ÊàèÊÉÖËäÇ„ÄÅÂìÅÁâåÂêçÁß∞„ÄÅÊìç‰ΩúÊµÅÁ®ãÂùá‰∏∫ËôöÊûÑÔºåÂ¶ÇÊúâÈõ∑ÂêåÁ∫ØÂ±ûÂ∑ßÂêà</li>
                    <li><strong>Êó†ÂÆûÈôÖÂäüËÉΩÔºö</strong>Êú¨Ê∏∏Êàè‰∏çËÉΩÁúüÊ≠£Ëß£ÈîÅ‰ªª‰ΩïËÆæÂ§áÔºå‰∏çÊèê‰æõ‰ªª‰ΩïÁ†¥Ëß£ÊúçÂä°</li>
                </ul>
            </div>

            <div class="legal-section">
                <h3>‚öñÔ∏è Ê≥ïÂæãÂêàËßÑÊâøËØ∫</h3>
                <ul>
                    <li><strong>ÈÅµÂÆàÊ≥ïÂæãÔºö</strong>Êú¨ÁΩëÁ´ô‰∏•Ê†ºÈÅµÂÆà„Ää‰∏≠Âçé‰∫∫Ê∞ëÂÖ±ÂíåÂõΩÁΩëÁªúÂÆâÂÖ®Ê≥ï„ÄãÁ≠âÁõ∏ÂÖ≥Ê≥ïÂæãÊ≥ïËßÑ</li>
                    <li><strong>‰∏çÈºìÂä±ËøùÊ≥ïÔºö</strong>Êàë‰ª¨ÊòéÁ°ÆÂèçÂØπ‰ªª‰ΩïÂΩ¢ÂºèÁöÑËÆæÂ§áÁ†¥Ëß£„ÄÅÈùûÊ≥ï‰æµÂÖ•Á≠âËøùÊ≥ïË°å‰∏∫</li>
                    <li><strong>ÊïôËÇ≤ÊÑè‰πâÔºö</strong>Ê∏∏ÊàèÊó®Âú®ÈÄöËøáÂ®±‰πêÂΩ¢ÂºèÊèêÈÜíÁî®Êà∑Ê≥®ÊÑèËÆæÂ§áÂÆâÂÖ®</li>
                    <li><strong>Ê≠£ÂΩìÈÄîÂæÑÔºö</strong>Êàë‰ª¨Âª∫ËÆÆÁî®Êà∑ÈÄöËøáÂÆòÊñπÊ≠£ÂΩìÊ∏†ÈÅìÂ§ÑÁêÜËÆæÂ§áÈóÆÈ¢ò</li>
                </ul>
            </div>

            <div class="legal-section">
                <h3>üîû Âπ¥ÈæÑ‰∏é‰ΩøÁî®ÈôêÂà∂</h3>
                <ul>
                    <li><strong>Âπ¥ÈæÑË¶ÅÊ±ÇÔºö</strong>Âª∫ËÆÆ18Â≤Å‰ª•‰∏äÁî®Êà∑‰ΩøÁî®ÔºåÊú™ÊàêÂπ¥‰∫∫ÈúÄÂú®ÁõëÊä§‰∫∫ÊåáÂØº‰∏ã‰ΩøÁî®</li>
                    <li><strong>ÁêÜÊÄßÂ®±‰πêÔºö</strong>ËØ∑ÁêÜÊÄßÂØπÂæÖÊ∏∏ÊàèÂÜÖÂÆπÔºå‰∏çË¶ÅÂ∞ÜËôöÊûÑÊÉÖËäÇ‰∏éÁé∞ÂÆûÊ∑∑Ê∑Ü</li>
                    <li><strong>Êó∂Èó¥ÊéßÂà∂Ôºö</strong>ËØ∑ÂêàÁêÜÂÆâÊéíÊ∏∏ÊàèÊó∂Èó¥ÔºåÈÅøÂÖçÊ≤âËø∑</li>
                </ul>
            </div>

            <div class="legal-section">
                <h3>üõ°Ô∏è ÂÖçË¥£Â£∞Êòé</h3>
                <ul>
                    <li><strong>ÂÜÖÂÆπÂÖçË¥£Ôºö</strong>Ê∏∏ÊàèÂÜÖÂÆπ‰ªÖ‰æõÂ®±‰πêÔºåÂºÄÂèëËÄÖ‰∏çÂØπ‰ªª‰ΩïÂü∫‰∫éÊ∏∏ÊàèÂÜÖÂÆπÁöÑË°å‰∏∫ÊâøÊãÖË¥£‰ªª</li>
                    <li><strong>ÊçüÂ§±ÂÖçË¥£Ôºö</strong>Áî®Êà∑Âõ†‰ΩøÁî®Êú¨ÁΩëÁ´ôÊàñÂü∫‰∫éÁΩëÁ´ôÂÜÖÂÆπÈááÂèñË°åÂä®ËÄå‰∫ßÁîüÁöÑ‰ªª‰ΩïÊçüÂ§±ÔºåÂºÄÂèëËÄÖÊ¶Ç‰∏çË¥üË¥£</li>
                    <li><strong>Á¨¨‰∏âÊñπÂÖçË¥£Ôºö</strong>Êú¨ÁΩëÁ´ô‰∏çÂØπÁ¨¨‰∏âÊñπÁΩëÁ´ôÊàñÊúçÂä°ÊâøÊãÖ‰ªª‰ΩïË¥£‰ªª</li>
                </ul>
            </div>

            <div class="legal-section">
                <h3>ü§ù Áî®Êà∑Ë¥£‰ªª</h3>
                <ul>
                    <li><strong>ÂêàÊ≥ï‰ΩøÁî®Ôºö</strong>Áî®Êà∑ÊâøËØ∫‰ªÖÂ∞ÜÊú¨ÁΩëÁ´ôÁî®‰∫éÂêàÊ≥ïÁöÑÂ®±‰πêÁõÆÁöÑ</li>
                    <li><strong>‰∏çÂæóÊ®°‰ªøÔºö</strong>‰∏•Á¶ÅÊ®°‰ªøÊ∏∏Êàè‰∏≠ÁöÑ‰ªª‰ΩïËôöÊûÑË°å‰∏∫</li>
                    <li><strong>Â∞äÈáç‰ªñ‰∫∫Ôºö</strong>Â∞äÈáçÊäÄÊúØ‰∫∫ÂëòÂíåÊúçÂä°‰∫∫ÂëòÔºåÁª¥Êä§ËâØÂ•ΩÁ§æ‰ºöÁß©Â∫è</li>
                    <li><strong>ÁêÜÊÄßÂàÜ‰∫´Ôºö</strong>ÂàÜ‰∫´Ê∏∏ÊàèÊó∂ËØ∑Ê≥®ÊòéËôöÊûÑÊÄßË¥®ÔºåÈÅøÂÖçËØØÂØº‰ªñ‰∫∫</li>
                </ul>
            </div>

            <div class="contact-box">
                <h3>üìß ËÅîÁ≥ªÊñπÂºè</h3>
                <p>Â¶ÇÊúâ‰ªª‰ΩïÈóÆÈ¢òÊàñÂª∫ËÆÆÔºåËØ∑ËÅîÁ≥ªÔºö</p>
                <div class="contact-email">CLeanZeroFeedBack@Gmail.com</div>
                <p style="font-size: 0.9em; margin-top: 10px; color: #666;">
                    Êàë‰ª¨‰ºöËÆ§ÁúüÂØπÂæÖÊØè‰∏Ä‰∏™ÂèçÈ¶àÔºå‰ΩÜËØ∑ÁêÜËß£ÊàëÂè™ÊòØÂ≠¶ÁîüÔºåÊó†ÁâπÊÆäÊÉÖÂÜµËØ∑ÂãøÊâìÊâ∞
                </p>
            </div>

            <div class="legal-buttons">
                <button class="legal-btn accept-btn" onclick="acceptTerms()">
                    ‚úÖ ÊàëÂ∑≤ÈòÖËØªÂπ∂ÂêåÊÑè
                </button>
                <button class="legal-btn reject-btn" onclick="rejectTerms()">
                    ‚ùå Êàë‰∏çÂêåÊÑè
                </button>
            </div>
        </div>
    </div>

    <div class="game-container" id="gameContainer" style="display: none;">
        <div class="timer" id="timer">00:00</div>
        <div class="hidden-menu" id="hiddenMenu">
            <div style="margin-bottom: 10px; font-weight: bold;">üïµÔ∏è ÈöêËóèËèúÂçï</div>
            <button onclick="toggleGodMode()" style="margin: 5px; padding: 8px; border-radius: 4px; border: none; background: #28a745; color: white; cursor: pointer;">‰∏äÂ∏ùÊ®°Âºè</button><br>
            <button onclick="setMaxStats()" style="margin: 5px; padding: 8px; border-radius: 4px; border: none; background: #ffc107; color: black; cursor: pointer;">Êª°Â±ûÊÄß</button><br>
            <button onclick="showAllEndings()" style="margin: 5px; padding: 8px; border-radius: 4px; border: none; background: #6f42c1; color: white; cursor: pointer;">Êü•ÁúãÁªìÂ±Ä</button><br>
            <button onclick="unlockAllAchievements()" style="margin: 5px; padding: 8px; border-radius: 4px; border: none; background: #fd7e14; color: white; cursor: pointer;">Ëß£ÈîÅÊàêÂ∞±</button>
        </div>

        <div class="header">
            <button class="about-btn" onclick="showAbout()">‚ùì ÂÖ≥‰∫é</button>
            <div class="logo" onclick="logoClick()">üèÉ‚Äç‚ôÇÔ∏èüì±</div>
            <h1 class="title" onclick="titleClick()">Â∞èÁ±≥Â§áË∑ëÁΩë</h1>
            <p class="subtitle">Á¨¨‰∏ÄÂ±äÂ∞èÁ±≥È©¨ÊãâÊùæ - BLËß£ÈîÅÊ®°ÊãüÂô®</p>
        </div>

        <div class="warning">
            ‚ö†Ô∏è Êú¨Ê∏∏ÊàèÁ∫ØÂ±ûËôöÊûÑÂ®±‰πêÔºå‰∏•Á¶ÅÁé∞ÂÆûÊ®°‰ªø | üéÆ ËôöÊûÑÂìÅÁâåÔºåËôöÊûÑÊÉÖËäÇ
        </div>

        <div id="mainContent">
            <div class="game-area" id="gameArea">
                <div class="story-text">
                    Ê¨¢ËøéÊù•Âà∞Â∞èÁ±≥Â§áË∑ëÁΩëÔºÅ‰Ω†Âç≥Â∞Ü‰ΩìÈ™åÊúÄÂÖ∑ÊåëÊàòÊÄßÁöÑËôöÊûÑBLËß£ÈîÅÂÜíÈô©Ê∏∏Êàè„ÄÇ
                    <br><br>
                    ‰Ωú‰∏∫‰∏ÄÂêçËôöÊûÑ‰∏ñÁïåÁöÑÊï∞Á†ÅÁà±Â•ΩËÄÖÔºå‰Ω†Â∑≤ÁªèÂéåÂÄ¶‰∫ÜË¢´Á≥ªÁªüÈôêÂà∂„ÄÇÂÆòÊñπËß£ÈîÅÊ∏†ÈÅìÂá†‰πé‰∏çÂèØËÉΩÈÄöËøáÔºåÂú®Ëøô‰∏™ËôöÊûÑÁöÑÊïÖ‰∫ã‰∏≠Ôºå‰Ω†ÂÜ≥ÂÆö...Â∞ùËØï‰∏Ä‰∫õÂàõÊÑèÊñπÊ≥ï„ÄÇ
                    <br><br>
                    ‚ö° <strong>Ê∏∏ÊàèÁâπÊÄßÔºö</strong><br>
                    üé≤ ÈöèÊú∫‰∫ã‰ª∂Á≥ªÁªü - ÊØèÊ≠•ÈÉΩÂèØËÉΩÈÅáÂà∞ÊÑèÂ§ñÔºÅ<br>
                    üéØ ÂèçÂ∫îÂ∞èÊ∏∏Êàè - ËÄÉÈ™å‰Ω†ÁöÑÊìç‰ΩúÊäÄÂ∑ßÔºÅ<br>
                    üèÜ ÊàêÂ∞±Á≥ªÁªü - Ëß£ÈîÅÂêÑÁßçÁß∞Âè∑ÔºÅ<br>
                    ‚öîÔ∏è ÊäÄËÉΩÁÇπÊï∞ - ÂΩ±Âìç‰Ω†ÁöÑËÉΩÂäõÔºÅ<br>
                    üíÄ ÊåëÊàòÊ®°Âºè - È´òÈöæÂ∫¶ÂÖ≥Âç°ÔºÅ
                    <br><br>
                    <div style="background: #e7f3ff; border: 2px solid #007bff; border-radius: 8px; padding: 15px; margin: 15px 0; font-size: 0.9em;">
                        <strong>üîî ÂÜçÊ¨°ÊèêÈÜíÔºö</strong>ËøôÊòØÂÆåÂÖ®ËôöÊûÑÁöÑÊñáÂ≠óÂÜíÈô©Ê∏∏ÊàèÔºÅÊâÄÊúâÂÜÖÂÆπÂùá‰∏∫Â®±‰πêÁõÆÁöÑÔºå‰∏éÁé∞ÂÆûÊó†ÂÖ≥„ÄÇ
                        ËØ∑ÈÄöËøáÂÆòÊñπÊ≠£ÂΩìÊ∏†ÈÅìÂ§ÑÁêÜÁúüÂÆûËÆæÂ§áÈóÆÈ¢ò„ÄÇÂ∞äÈáçÊäÄÊúØ‰∫∫ÂëòÔºåÁª¥Êä§ËâØÂ•ΩÁ§æ‰ºöÁéØÂ¢ÉÔºÅ
                    </div>
                    ‰Ω†ÂáÜÂ§áÂ•ΩÂºÄÂßãËøôÂú∫ËôöÊûÑÁöÑÂÜíÈô©‰∫ÜÂêóÔºü
                </div>
                
                <button class="start-btn" onclick="startGame()">üöÄ ÂºÄÂßãËôöÊûÑÂÜíÈô©</button>
            </div>
            
            <!-- Áâ©ÂìÅÊ†è -->
            <div class="inventory" id="inventoryPanel" style="display: none;">
                <div class="inventory-title">üì¶ Áâ©ÂìÅÊ†è</div>
                <div class="inventory-items" id="inventoryItems"></div>
            </div>

            <!-- ÊäÄËÉΩÁÇπÊï∞ÊòæÁ§∫ -->
            <div class="skill-points-display" id="skillPointsDisplay" style="display: none;">
                üåü ÊäÄËÉΩÁÇπÊï∞: <span id="skillPointsText">0</span> | ÂÆûÂäõ: <span id="powerLevelText">Êñ∞Êâã</span>
            </div>
        </div>

        <input type="text" class="konami-input" id="konamiInput" onkeyup="checkKonami(event)">
    </div>

    <!-- ÂÖ≥‰∫éÊ®°ÊÄÅÊ°Ü -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAbout()">&times;</span>
            <h2>üèÉ‚Äç‚ôÇÔ∏è ÂÖ≥‰∫éÂ∞èÁ±≥Â§áË∑ëÁΩë</h2>
            
            <div class="author-info">
                <div class="author-name">üëë Ë¥ùÂà©‰∫öË∂ÖÁ∫ßÊó†ÊïåÂ§ßÁéã</div>
                <a href="http://www.coolapk.com/u/31876429" target="_blank" class="author-link">
                    üì± ËÆøÈóÆÈÖ∑ÂÆâ‰∏ªÈ°µ
                </a>
            </div>

            <div class="contact-box">
                <h3>üìß ËÅîÁ≥ªÊñπÂºè</h3>
                <p>ÊúâÈóÆÈ¢òÊàñÂª∫ËÆÆÔºüÊ¨¢ËøéËÅîÁ≥ªÊàë‰ª¨Ôºö</p>
                <div class="contact-email">CLeanZeroFeedBack@Gmail.com</div>
                <p style="font-size: 0.9em; margin-top: 10px;">
                    Êàë‰ª¨‰ºöËÆ§ÁúüÂØπÂæÖÊØè‰∏Ä‰∏™ÂèçÈ¶àÔºå‰ΩÜËØ∑ÁêÜËß£ÊàëÂè™ÊòØÂ≠¶ÁîüÔºåÊó†ÁâπÊÆäÊÉÖÂÜµËØ∑ÂãøÊâìÊâ∞
                </p>
            </div>

            <div class="disclaimer">
                <h3>‚ö†Ô∏è ÈáçË¶ÅÂ£∞Êòé</h3>
                <p><strong>Êú¨È°πÁõÆÊòØÁ∫ØÂ®±‰πêÊÄßË¥®ÁöÑÊñáÂ≠óÂÜíÈô©Ê∏∏ÊàèÔºå‰ªÖ‰æõÂ®±‰πêÂíåÂ≠¶‰π†‰∫§ÊµÅ‰ΩøÁî®„ÄÇ</strong></p>
                <p><strong>ÊâÄÊúâÊ∏∏ÊàèÂÜÖÂÆπÂÆåÂÖ®ËôöÊûÑÔºåÊâÄÊúâÂìÅÁâåÂêçÁß∞„ÄÅÊìç‰ΩúÊµÅÁ®ãÂùá‰∏∫ËôöÊûÑËÆæÂÆö„ÄÇ</strong></p>
                <p><strong>Ê∏∏Êàè‰∏çÊèê‰æõ‰ªª‰ΩïÁúüÂÆûÁöÑÊäÄÊúØÊåáÂØºÔºå‰∏çÂåÖÂê´‰ªª‰ΩïÁ†¥Ëß£Â∑•ÂÖ∑ÊàñÊñπÊ≥ï„ÄÇ</strong></p>
                <br>
                <p>ü§ù <strong>ËØ∑ÁêÜÊÄßÂØπÂæÖËÆæÂ§áËß£ÈîÅÔºåÈÄöËøáÂÆòÊñπÊ≠£ÂΩìÊ∏†ÈÅìËß£ÂÜ≥ÈóÆÈ¢òÔºåÂ∞äÈáçÊäÄÊúØ‰∫∫ÂëòÔºÅ</strong></p>
                <p>‚öñÔ∏è <strong>‰∏•Ê†ºÈÅµÂÆàÊ≥ïÂæãÊ≥ïËßÑÔºå‰∏ç‰ªé‰∫ã‰ªª‰ΩïËøùÊ≥ïËøùËßÑË°å‰∏∫ÔºÅ</strong></p>
                <br>
                <p style="text-align: center; font-size: 0.9em; color: #666;">
                    üìß ‰ΩúËÄÖÂè™ÊòØ‰∏Ä‰∏™‰∏≠Â≠¶ÁîüÔºåËøòÊòØÊú™ÊàêÂπ¥ÔºåÊó†ÁâπÊÆäÊÉÖÂÜµËØ∑ÂãøÊâìÊâ∞ÔºåË∞¢Ë∞¢ÊÇ®<br>
                    üí° ÁúüÊ≠£ÁöÑÊäÄÊúØÂ≠¶‰π†Â∫îËØ•ÈÄöËøáÊ≠£ÂΩìÊ∏†ÈÅìÂíåÂÆòÊñπÊñáÊ°£ËøõË°å<br>
                    üåü ÊÑüË∞¢ÊâÄÊúâ‰∏∫ÂºÄÊ∫êÁ§æÂå∫Ë¥°ÁåÆÁöÑÂºÄÂèëËÄÖ‰ª¨<br>
                    üéÆ ‰∫´ÂèóÊ∏∏ÊàèÁöÑÂêåÊó∂ËØ∑Áâ¢ËÆ∞ÔºöËôöÊûÑÂ®±‰πêÔºåÁé∞ÂÆûÂÆàÊ≥ï
                </p>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="reset-btn" onclick="closeAbout()">üîô ËøîÂõûÊ∏∏Êàè</button>
                <button class="revoke-btn" onclick="revokeConsent()">üóëÔ∏è Êí§ÈîÄÂ£∞ÊòéÂêåÊÑè</button>
            </div>
        </div>
    </div>

    <!-- Â∫ïÈÉ®DockÊ†è -->
    <div class="stats-dock" id="statsDock">
        <div class="dock-content">
            <button class="dock-toggle" id="dockToggle" onclick="toggleDock()">‚åÑ</button>
            
            <div class="stat-section">
                <div class="stat-label" style="color: #dc3545;">‚ù§Ô∏è ÂÅ•Â∫∑</div>
                <div class="stat-bar">
                    <div class="stat-fill" id="healthFill"></div>
                </div>
                <div class="stat-text" id="healthText">100</div>
            </div>

            <div class="stat-section">
                <div class="stat-label" style="color: #007bff;">üõ°Ô∏è Á≤æÁ•û</div>
                <div class="stat-bar">
                    <div class="stat-fill" id="mentalFill"></div>
                </div>
                <div class="stat-text" id="mentalText">100</div>
            </div>

            <div class="stat-section">
                <div class="stat-label" style="color: #28a745;">üéØ ÊàêÂäüÁéá</div>
                <div class="stat-text" id="successRateText" style="font-weight: bold; font-size: 0.9em;">5%</div>
            </div>
        </div>
    </div>

    <script>
        // --- Game State Variables ---
        let currentStep = 0;
        let successRate = 5;
        let health = 100;
        let mentalHealth = 100;
        let skillPoints = 0;
        let gameStartTime = 0;
        let godMode = false;
        let logoClicks = 0;
        let titleClicks = 0;
        let konamiCode = '';
        let inventory = [];
        let achievements = [];
        let randomEventCount = 0;
        let playerStats = {};
        let flags = {};

        // --- Control Flags ---
        let isProcessing = false;
        let justHadRandomEvent = false;

        // Ê£ÄÊü•localStorageÊòØÂê¶ÂèØÁî®
        function isLocalStorageAvailable() {
            try {
                return typeof(Storage) !== "undefined" && window.localStorage !== null;
            } catch (e) {
                return false;
            }
        }

        // ÂÆâÂÖ®ÁöÑlocalStorageÊìç‰Ωú
        function safeSetItem(key, value) {
            if (isLocalStorageAvailable()) {
                try {
                    localStorage.setItem(key, value);
                    return true;
                } catch (e) {
                    console.log('localStorageÂÜôÂÖ•Â§±Ë¥•:', e);
                    return false;
                }
            }
            return false;
        }

        function safeGetItem(key) {
            if (isLocalStorageAvailable()) {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    console.log('localStorageËØªÂèñÂ§±Ë¥•:', e);
                    return null;
                }
            }
            return null;
        }

        function safeRemoveItem(key) {
            if (isLocalStorageAvailable()) {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (e) {
                    console.log('localStorageÂà†Èô§Â§±Ë¥•:', e);
                    return false;
                }
            }
            return false;
        }
        // --- Legal Modal Functions ---
        function acceptTerms() {
            document.getElementById('legalModal').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            // Â∞ùËØïËÆæÁΩÆÁî®Êà∑Â∑≤ÂêåÊÑèÁöÑÊ†áËÆ∞
            if (!safeSetItem('termsAccepted', 'true')) {
                console.log('Ê≥®ÊÑèÔºöÊó†Ê≥ï‰øùÂ≠òÂêåÊÑèÁä∂ÊÄÅÔºå‰∏ãÊ¨°ËÆøÈóÆÊó∂Â∞ÜÈáçÊñ∞ÊòæÁ§∫Â£∞Êòé');
            }
        }

        function rejectTerms() {
            alert('ÊÑüË∞¢ÊÇ®ÁöÑÂÖ≥Ê≥®ÔºÅÂ¶ÇÊûúÊÇ®ÊîπÂèò‰∏ªÊÑèÔºåÈöèÊó∂ÂèØ‰ª•ÈáçÊñ∞ËÆøÈóÆ„ÄÇ');
            window.close(); // Â∞ùËØïÂÖ≥Èó≠Á™óÂè£
            // Â¶ÇÊûúÊó†Ê≥ïÂÖ≥Èó≠Á™óÂè£ÔºåÈáçÂÆöÂêëÂà∞ÂÖ∂‰ªñÈ°µÈù¢
            setTimeout(() => {
                window.location.href = 'about:blank';
            }, 1000);
        }

        function revokeConsent() {
            console.log('Êí§ÈîÄÂáΩÊï∞Ë¢´Ë∞ÉÁî®‰∫Ü'); // Ë∞ÉËØï‰ø°ÊÅØ
            
            try {
                if (!isLocalStorageAvailable()) {
                    alert('‚ö†Ô∏è ÂΩìÂâçÁéØÂ¢É‰∏çÊîØÊåÅÊï∞ÊçÆÂ≠òÂÇ®ÂäüËÉΩ\n\nÊØèÊ¨°ËÆøÈóÆÈÉΩ‰ºöÊòæÁ§∫Ê≥ïÂæãÂ£∞ÊòéÔºåÊó†ÈúÄÊí§ÈîÄ„ÄÇ');
                    return;
                }

                if (confirm('Á°ÆÂÆöË¶ÅÊí§ÈîÄÂØπÊ≥ïÂæãÂ£∞ÊòéÁöÑÂêåÊÑèÂêóÔºü\n\nÊí§ÈîÄÂêé‰∏ãÊ¨°ËÆøÈóÆÁΩëÁ´ôÂ∞ÜÈúÄË¶ÅÈáçÊñ∞ÂêåÊÑèÂ£∞Êòé„ÄÇ')) {
                    // ÁßªÈô§Êú¨Âú∞Â≠òÂÇ®
                    if (safeRemoveItem('termsAccepted')) {
                        alert('‚úÖ Â∑≤ÊàêÂäüÊí§ÈîÄÂêåÊÑèÔºÅ\n\n‰∏ãÊ¨°ËÆøÈóÆÁΩëÁ´ôÊó∂Â∞ÜÈáçÊñ∞ÊòæÁ§∫Ê≥ïÂæãÂ£∞Êòé„ÄÇ');
                    } else {
                        alert('‚ö†Ô∏è Êí§ÈîÄÊìç‰ΩúÂÆåÊàêÔºå‰ΩÜÂèØËÉΩÊó†Ê≥ï‰øùÂ≠òÁä∂ÊÄÅ\n\nÂ¶ÇÊûúÊÇ®Âú®ÈöêÁßÅÊ®°Âºè‰∏ãÊµèËßàÔºåÊØèÊ¨°ËÆøÈóÆÈÉΩ‰ºöÈáçÊñ∞ÊòæÁ§∫Â£∞Êòé„ÄÇ');
                    }
                    
                    // ÂÖ≥Èó≠ÂÖ≥‰∫éÈ°µÈù¢
                    closeAbout();
                    
                    console.log('Êí§ÈîÄÊàêÂäüÂÆåÊàê'); // Ë∞ÉËØï‰ø°ÊÅØ
                } else {
                    console.log('Áî®Êà∑ÂèñÊ∂à‰∫ÜÊí§ÈîÄÊìç‰Ωú'); // Ë∞ÉËØï‰ø°ÊÅØ
                }
            } catch (error) {
                console.error('Êí§ÈîÄËøáÁ®ã‰∏≠Âá∫Áé∞ÈîôËØØ:', error);
                alert('‚ùå Êí§ÈîÄËøáÁ®ã‰∏≠Âá∫Áé∞ÈîôËØØÔºåËØ∑ÈáçËØï„ÄÇ\n\nÈîôËØØ‰ø°ÊÅØÔºö' + error.message);
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂêåÊÑèÊù°Ê¨æ
        window.addEventListener('load', function() {
            const termsAccepted = safeGetItem('termsAccepted');
            
            if (termsAccepted === 'true') {
                // Áî®Êà∑‰πãÂâçÂ∑≤ÁªèÂêåÊÑèÔºåÁõ¥Êé•ËøõÂÖ•Ê∏∏Êàè
                document.getElementById('legalModal').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'block';
            } else {
                // È¶ñÊ¨°ËÆøÈóÆÊàñlocalStorage‰∏çÂèØÁî®ÔºåÊòæÁ§∫ÂÆåÊï¥Â£∞Êòé
                document.getElementById('legalModal').style.display = 'flex';
            }
            
            // Â¶ÇÊûúlocalStorage‰∏çÂèØÁî®ÔºåÂú®ÊéßÂà∂Âè∞ÊèêÁ§∫
            if (!isLocalStorageAvailable()) {
                console.log('Ê≥®ÊÑèÔºölocalStorage‰∏çÂèØÁî®ÔºåÊØèÊ¨°ËÆøÈóÆÈÉΩÂ∞ÜÊòæÁ§∫Ê≥ïÂæãÂ£∞Êòé');
            }
        });

        // --- Game Data ---
        const randomEvents = [
            { text: 'üí• Á™ÅÁÑ∂‰∏ãÈõ®ÔºåÂú∞Èù¢ÊπøÊªëÔºÅ', effect: { successRate: -10, health: -8, mentalHealth: -5 } },
            { text: 'üö® Â∑ßÈÅáÂ∑°ÈÄª‰∫∫ÂëòÔºÅ', effect: { successRate: -15, health: -12, mentalHealth: -15 } },
            { text: 'üçÄ ÈÅáÂà∞Â•ΩÂøÉ‰∫∫ÊåáË∑ØÔºÅ', effect: { successRate: 8, mentalHealth: 5 } },
            { text: '‚ö° Á™ÅÁÑ∂ÂÅúÁîµÔºåÁõëÊéßÂ§±ÊïàÔºÅ', effect: { successRate: 15, skillPoints: 1 } },
            { text: 'üòµ ËÇöÂ≠êÁñºÔºåÁä∂ÊÄÅ‰∏ç‰Ω≥ÔºÅ', effect: { health: -20, mentalHealth: -10 } },
            { text: 'üéâ Â∑•Á®ãÂ∏àÂøÉÊÉÖÂæàÂ•ΩÔºÅ', effect: { successRate: 12, mentalHealth: 8 } },
            { text: 'üêï ÈáéÁãóËøΩËµ∂ÔºåÊ∂àËÄó‰ΩìÂäõÔºÅ', effect: { health: -25, mentalHealth: -8 } },
            { text: 'üì± ËÆæÂ§áÁ™ÅÁÑ∂Âç°Êú∫ÔºÅ', effect: { successRate: -12, mentalHealth: -10 } },
            { text: 'üåü Âπ∏ËøêÂ•≥Á•ûÁú∑È°æÔºÅ', effect: { successRate: 18, luck: 1, skillPoints: 2 } },
            { text: 'üöó ‰∫§ÈÄöÂ†µÂ°ûÂª∂ËØØÔºÅ', effect: { successRate: -8, health: -5, mentalHealth: -12 } },
            { text: '‚òï Âñù‰∫ÜËøáÊúüÂíñÂï°ÔºåË∫´‰Ωì‰∏çÈÄÇÔºÅ', effect: { health: -30, mentalHealth: -15, successRate: -15 } },
            { text: 'üéØ ÂÆåÁæéÂèëÊå•Ôºå‰ø°ÂøÉÂ§ßÂ¢ûÔºÅ', effect: { successRate: 20, mentalHealth: 15, skillPoints: 2 } },
            { text: 'üå™Ô∏è Á™ÅÂèëÊÅ∂Âä£Â§©Ê∞îÔºÅ', effect: { health: -35, mentalHealth: -20, successRate: -20 } },
            { text: 'üí∞ Êç°Âà∞Èí±ÂåÖÔºåÂøÉÊÉÖÊÑâÊÇ¶ÔºÅ', effect: { mentalHealth: 10, luck: 1 } },
            { text: 'üî• ÈôÑËøëÊñΩÂ∑•ÔºåÁ©∫Ê∞îÊ±°ÊµäÔºÅ', effect: { health: -15, mentalHealth: -20 } },
            { text: 'üéµ Âê¨Âà∞ÂñúÊ¨¢ÁöÑÈü≥‰πêÔºåÊñóÂøóÊòÇÊâ¨ÔºÅ', effect: { mentalHealth: 12, courage: 1 } },
            { text: 'üíª ÊäÄÊúØÊúãÂèãËøúÁ®ãÂçèÂä©ÔºÅ', effect: { successRate: 25, technology: 2, skillPoints: 3 } },
            { text: 'üöÅ Â§©Á©∫‰∏≠ÁöÑÊó†‰∫∫Êú∫ÁõëÊéßÔºÅ', effect: { successRate: -18, stealth: -1, mentalHealth: -15 } },
            { text: 'üçï ÂêÉ‰∫ÜÂèòË¥®È£üÁâ©ÔºåË∫´‰Ωì‰∏çÈÄÇÔºÅ', effect: { health: -40, mentalHealth: -25, successRate: -25 } },
            { text: '‚≠ê ÊµÅÊòüËÆ∏ÊÑøÊàêÂäüÔºÅ', effect: { successRate: 30, luck: 3, skillPoints: 5 } }
        ];

        const achievementList = [
            { id: 'first_play', name: 'ÂàùÊ¨°Â∞ùËØï', desc: 'Á¨¨‰∏ÄÊ¨°Ê∏∏Áé©Ê∏∏Êàè', emoji: 'üéÆ' },
            { id: 'survivor', name: 'Âπ∏Â≠òËÄÖ', desc: 'ÂÅ•Â∫∑ÂÄºË∑åÁ†¥10ÂêéÈáçÊñ∞ÂõûÂçá', emoji: 'üí™' },
            { id: 'lucky_seven', name: 'Âπ∏Ëøê‰∏É', desc: 'Ëß¶Âèë7Ê¨°Ê≠£Èù¢ÈöèÊú∫‰∫ã‰ª∂', emoji: 'üçÄ' },
            { id: 'speed_runner', name: 'ÈÄüÂ∫¶ÁãÇÈ≠î', desc: '60ÁßíÂÜÖÂÆåÊàêÊ∏∏Êàè', emoji: '‚ö°' },
            { id: 'collector', name: 'Êî∂ËóèÂÆ∂', desc: 'Êî∂ÈõÜ10‰∏™‰ª•‰∏äÁâ©ÂìÅ', emoji: 'üì¶' },
            { id: 'iron_will', name: 'Èí¢ÈìÅÊÑèÂøó', desc: 'Á≤æÁ•ûÂÅ•Â∫∑‰øùÊåÅÂú®80‰ª•‰∏äÂÆåÊàêÊ∏∏Êàè', emoji: 'üß†' },
            { id: 'master_hacker', name: 'Â§ßÂ∏à', desc: 'ÊäÄÊúØÂ±ûÊÄßËææÂà∞10', emoji: 'üíª' },
            { id: 'legendary_end', name: '‰º†ËØ¥ÁªàÁªì', desc: 'Ëé∑Âæó‰º†Â•áÁªìÂ±Ä', emoji: 'üëë' },
            { id: 'death_defier', name: 'Ê≠ªÁ•ûËîëËßÜËÄÖ', desc: '‰ªéÊ≠ª‰∫°ËæπÁºòÈÄÉËÑ±', emoji: 'üíÄ' },
            { id: 'perfect_health', name: 'ÂÆåÁæéÁä∂ÊÄÅ', desc: 'Êª°Ë°ÄÊª°Á≤æÁ•ûÈÄöÂÖ≥', emoji: 'üíé' }
        ];

        const gameSteps = [
            {
                id: 'physical_prep',
                title: 'üí™ Ë∫´‰ΩìÂáÜÂ§á',
                text: 'Âú®ÂºÄÂßãËøôÂú∫ËôöÊûÑÁöÑÊåëÊàòÂâçÔºå‰Ω†ÁöÑËôöÊãüË∫´‰ΩìÁä∂ÊÄÅËá≥ÂÖ≥ÈáçË¶ÅÔºÅ‰∏Ä‰∏™ËôöÂº±ÁöÑËôöÊãüË∫´‰ΩìÊ†πÊú¨Êíë‰∏çÂà∞ÊúÄÂêé...',
                choices: [
                    { text: 'üèÉ‚Äç‚ôÇÔ∏è ËøûÁª≠‰∏ÄÂë®È´òÂº∫Â∫¶ËôöÊãü‰ΩìËÉΩËÆ≠ÁªÉ', effect: { health: 20, speed: 3, preparation: 2, successRate: 15 }, skillPointsReward: 2, next: 'mental_training' },
                    { text: 'ü•ó ‰∏•Ê†ºÊéßÂà∂ËôöÊãüÈ•ÆÈ£üÔºå‰øùÊåÅÊúÄ‰Ω≥Áä∂ÊÄÅ', effect: { health: 15, mentalHealth: 10, preparation: 1, successRate: 10 }, skillPointsReward: 1, next: 'mental_training' },
                    { text: 'üíä ÊúçÁî®ÂÖ¥Â•ãÂâÇÂº∫Âåñ‰ΩìËÉΩ', effect: { health: -20, speed: 5, courage: 2, successRate: 8 }, flag: 'usedDrugs', next: 'mental_training' },
                    { text: 'üò¥ ‰ªÄ‰πàÈÉΩ‰∏çÂÅöÔºå‰øùÊåÅËá™ÁÑ∂Áä∂ÊÄÅ', effect: { health: -10, successRate: -8 }, next: 'mental_training' }
                ]
            },
            {
                id: 'mental_training',
                title: 'üß† ÂøÉÁêÜËÆ≠ÁªÉ',
                text: 'Ë∫´‰ΩìÂáÜÂ§áÂ•Ω‰∫ÜÔºå‰ΩÜÂøÉÁêÜÁ¥†Ë¥®Êõ¥ÈáçË¶ÅÔºÅÂú®È´òÂéãËôöÊãüÁéØÂ¢É‰∏ãÔºåÂøÉÁêÜÂ¥©Ê∫ÉÊØîË∫´‰ΩìÂèó‰º§Êõ¥Ëá¥ÂëΩ...',
                choices: [
                    { text: 'üßò‚Äç‚ôÇÔ∏è Ê∑±Â∫¶ÂÜ•ÊÉ≥ËÆ≠ÁªÉÔºåÊèêÂçá‰∏ìÊ≥®Âäõ', effect: { mentalHealth: 25, stealth: 2, preparation: 2, successRate: 12 }, skillPointsReward: 2, next: 'research' },
                    { text: 'üìö Á†îËØªÂøÉÁêÜÂ≠¶Ôºå‰∫ÜËß£ÂØπÊâãÊÄùÁª¥', effect: { mentalHealth: 15, stealth: 3, technology: 1, successRate: 15 }, skillPointsReward: 2, next: 'research' },
                    { text: 'üéÆ Áé©È´òÈöæÂ∫¶Ê∏∏ÊàèÈîªÁÇºÂèçÂ∫î', effect: { mentalHealth: 10, speed: 2, luck: 1, successRate: 8 }, flag: 'gamerTraining', next: 'research' },
                    { text: 'üç∫ ÂñùÈÖíÊ∞¥Â£ÆËÉÜ', effect: { mentalHealth: -15, health: -15, courage: 1, successRate: -12 }, next: 'research' }
                ]
            },
            {
                id: 'research',
                title: 'üîç ÂâçÊúüË∞ÉÁ†î',
                text: 'Ë∞ÉÁ†îÈò∂ÊÆµÊòØÊï¥‰∏™ËÆ°ÂàíÁöÑÂü∫Á°ÄÔºÅÈîôËØØÁöÑ‰ø°ÊÅØ‰ºöËÆ©‰Ω†Âú®Ê∏∏Êàè‰∏≠Â§±Ë¥•Ôºå‰ΩÜÊ∑±ÂÖ•Ë∞ÉÁ†î‰πüÊúâÊö¥Èú≤ÁöÑÈ£éÈô©...',
                choices: [
                    { text: 'üíª ËøûÁª≠72Â∞èÊó∂‰∏çÁú†‰∏ç‰ºëÊ∑±Â∫¶Á†îÁ©∂', effect: { successRate: 20, health: -25, mentalHealth: -15, preparation: 3, technology: 2 }, flag: 'exhaustedResearch', skillPointsReward: 3, next: 'equipment_prep' },
                    { text: 'üïµÔ∏è Èõá‰Ω£‰æ¶Êé¢Êî∂ÈõÜÂÜÖÈÉ®ÊÉÖÊä•', effect: { successRate: 15, stealth: 2, preparation: 2 }, flag: 'hasInside', item: 'ÂÜÖÈÉ®ÊÉÖÊä•', rarity: 'rare', skillPointsReward: 2, next: 'equipment_prep' },
                    { text: 'üì± Èöè‰æøÁúãÁúãËÆ∫ÂùõÔºåÂ§ßÊ¶Ç‰∫ÜËß£', effect: { successRate: 3, preparation: 1 }, next: 'equipment_prep' },
                    { text: 'üîç ‰ΩøÁî®ÊäÄÊúØÊâãÊÆµÂÖ•‰æµÁ≥ªÁªü', effect: { successRate: 25, technology: 3, health: -10, mentalHealth: -20 }, flag: 'hackedSystem', item: 'Á≥ªÁªüÊºèÊ¥û‰ø°ÊÅØ', rarity: 'legendary', skillPointsReward: 4, special: true, next: 'equipment_prep' }
                ]
            },
            {
                id: 'equipment_prep',
                title: 'üéí Ë£ÖÂ§áÂáÜÂ§á',
                text: '‰∏ì‰∏öÁöÑË£ÖÂ§áËÉΩÂ§ßÂ§ßÊèêÂçáÊàêÂäüÁéáÔºå‰ΩÜËé∑ÂèñËøô‰∫õË£ÖÂ§áÊú¨Ë∫´Â∞±ÊòØËôöÊûÑÁöÑÊåëÊàò...',
                choices: [
                    { text: 'üí£ Âà∂‰Ωú‰∏ì‰∏öÁàÜÁ†¥Ë£ÖÂ§á‰Ωú‰∏∫ÂêéÊâã', effect: { successRate: 30, health: -20, courage: 3 }, item: 'ÁàÜÁ†¥Ë£ÖÂ§á', rarity: 'legendary', flag: 'hasExplosives', skillPointsReward: 3, next: 'disguise_training' },
                    { text: 'üì° Ë¥≠‰π∞ÂÜõÁî®Á∫ß‰ø°Âè∑Âπ≤Êâ∞Âô®', effect: { successRate: 18, technology: 2, stealth: 2 }, item: '‰ø°Âè∑Âπ≤Êâ∞Âô®', rarity: 'rare', skillPointsReward: 2, next: 'disguise_training' },
                    { text: 'üîß ÂáÜÂ§áÂü∫Á°ÄÂ∑•ÂÖ∑ÂåÖ', effect: { successRate: 8, preparation: 1 }, item: 'Â∑•ÂÖ∑ÂåÖ', next: 'disguise_training' },
                    { text: 'üéí Á©∫Êâã‰∏äÈòµÔºåÁ∫ØÈù†ÊäÄÂ∑ß', effect: { courage: 2, successRate: -5 }, next: 'disguise_training' }
                ]
            },
            {
                id: 'disguise_training',
                title: 'üé≠ ‰º™Ë£ÖËÆ≠ÁªÉ',
                text: 'ÂÆåÁæéÁöÑ‰º™Ë£ÖÊòØÊàêÂäüÁöÑÂÖ≥ÈîÆÔºÅ‰ΩÜËøáÂ∫¶ËÆ≠ÁªÉÂèØËÉΩËÆ©‰Ω†Âú®ËôöÊûÑ‰∏ñÁïå‰∏≠ÂàÜ‰∏çÊ∏ÖÁúüÂÅá...',
                choices: [
                    { text: 'üé¨ ËØ∑‰∏ì‰∏öÂåñÂ¶ÜÂ∏àËÆ≠ÁªÉÂèòË£ÖÊúØ', effect: { stealth: 4, successRate: 20, mentalHealth: -10 }, item: '‰∏ì‰∏öÂåñÂ¶ÜÂåÖ', rarity: 'rare', flag: 'masterDisguise', skillPointsReward: 3, next: 'backup' },
                    { text: 'üëî ÁªÉ‰π†ÂïÜÂä°‰∫∫Â£´ÂΩ¢Ë±°', effect: { stealth: 2, successRate: 12 }, item: 'ÂïÜÂä°Â•óË£Ö', next: 'backup' },
                    { text: 'üéì ÊâÆÊºîÂ≠¶ÁîüÔºåÊòæÂæóÊó†ÂÆ≥', effect: { stealth: 3, luck: 1, successRate: 10 }, flag: 'studentDisguise', item: 'Â≠¶ÁîüËØÅ', next: 'backup' },
                    { text: 'ü•∑ ÂøçËÄÖËÆ≠ÁªÉÔºåÊöóÂΩ±Ë°åÂä®', effect: { stealth: 5, speed: 3, health: -15, successRate: 25 }, item: 'ÂøçËÄÖË£ÖÂ§á', rarity: 'legendary', flag: 'ninjaTraining', skillPointsReward: 4, special: true, next: 'backup' }
                ]
            },
            {
                id: 'backup',
                title: 'üíæ Êï∞ÊçÆÂ§á‰ªΩ',
                text: 'ËøôÂèØËÉΩÊòØ‰Ω†ÊúÄÂêé‰∏ÄÊ¨°ÁúãÂà∞ËÆæÂ§áÈáåÁöÑÊï∞ÊçÆ...Â§á‰ªΩÂ§±ËØØ‰ºöËÆ©‰∏ÄÂàáÂâçÂäüÂ∞ΩÂºÉÔºÅ',
                choices: [
                    { text: '‚ö° ‰ΩøÁî®ÂÆûÈ™åÊÄßÈáèÂ≠êÂ§á‰ªΩÊäÄÊúØ', effect: { successRate: 25, health: -30, technology: 3 }, flag: 'quantumBackup', item: 'ÈáèÂ≠êÂ§á‰ªΩËÆæÂ§á', rarity: 'legendary', skillPointsReward: 4, special: true, next: 'poison_test' },
                    { text: 'üîÑ ‰∏ì‰∏öËΩØ‰ª∂ÂÆåÊï¥ÈïúÂÉèÂ§á‰ªΩ', effect: { successRate: 15, health: -5, preparation: 2 }, flag: 'hasBackup', item: 'ÂÆåÊï¥Â§á‰ªΩ', rarity: 'rare', skillPointsReward: 2, next: 'poison_test' },
                    { text: '‚òÅÔ∏è ‰∫ëÁ´ØÂ§á‰ªΩÈáçË¶ÅÊñá‰ª∂', effect: { successRate: 8, technology: 1 }, item: '‰∫ëÁ´ØÂ§á‰ªΩ', next: 'poison_test' },
                    { text: 'üé≤ Ëµå‰∏ÄÊääÔºå‰ªÄ‰πàÈÉΩ‰∏çÂ§á‰ªΩ', effect: { successRate: -15, courage: 2 }, next: 'poison_test' }
                ]
            },
            {
                id: 'poison_test',
                title: '‚ò†Ô∏è ÊØíÊÄßÊµãËØï',
                text: 'Êúâ‰º†Ë®ÄËØ¥Êüê‰∫õÊúçÂä°‰∏≠ÂøÉ‰ºöÂú®Á©∫Ê∞î‰∏≠ÈáäÊîæËá¥ÂπªÊØíÊ∞îÊù•Èò≤ËåÉÔºÅ‰Ω†ÂÜ≥ÂÆöÊèêÂâçÈÄÇÂ∫î...',
                choices: [
                    { text: 'üíâ Ê≥®Â∞ÑÂ∞ëÈáèÊØíÁ¥†Âª∫Á´ãÊäóÊÄß', effect: { health: -40, mentalHealth: -25, successRate: 20 }, flag: 'poisonResistance', item: 'ÊäóÊØíË°ÄÊ∏Ö', rarity: 'rare', skillPointsReward: 3, next: 'phone_check' },
                    { text: 'üò∑ ‰Ω©Êà¥‰∏ì‰∏öÈò≤ÊØíÈù¢ÂÖ∑', effect: { health: -10, stealth: -2, successRate: 12 }, item: 'Èò≤ÊØíÈù¢ÂÖ∑', next: 'phone_check' },
                    { text: 'üß¨ ÊúçÁî®ÂÆûÈ™åÊÄßËß£ÊØíÂâÇ', effect: { health: -20, mentalHealth: 15, luck: 2, successRate: 8 }, item: 'Ëß£ÊØíÂâÇ', next: 'phone_check' },
                    { text: 'üö´ ÊãíÁªùÂèÇ‰∏éÔºå‰øùÊåÅÂéüÁä∂', effect: { health: 5 }, next: 'phone_check' }
                ]
            },
            {
                id: 'phone_check',
                title: 'üì± ËÆæÂ§áÊ£ÄÊü•',
                text: '‰∏çÂêåÊú∫ÂûãÁöÑËß£ÈîÅÈöæÂ∫¶ÂçÉÂ∑Æ‰∏áÂà´...ÈÄâÈîôÊú∫ÂûãÂ∞±ÊòØËá™ÂØªÊ≠ªË∑ØÔºÅ',
                choices: [
                    { text: 'üî¨ ‰ΩøÁî®È´òÁ≤æÂØÜ‰ª™Âô®ÂÖ®Èù¢Ê£ÄÊµã', effect: { technology: 3, preparation: 2, health: -5, successRate: 18 }, item: 'Ê£ÄÊµãÊä•Âëä', rarity: 'rare', skillPointsReward: 2, next: 'reaction_test' },
                    { text: 'üìä ËøêË°å‰∏ì‰∏öÊµãËØïËΩØ‰ª∂', effect: { technology: 2, successRate: 12 }, item: 'ÊµãËØïÁªìÊûú', next: 'reaction_test' },
                    { text: 'üëÄ Âá≠ÁªèÈ™åÁÆÄÂçïÊ£ÄÊü•', effect: { successRate: 5, preparation: 1 }, next: 'reaction_test' },
                    { text: 'üé≤ Áõ≤ÁõÆËá™‰ø°Ôºå‰∏çÊ£ÄÊü•', effect: { successRate: -15, courage: 1 }, next: 'reaction_test' }
                ]
            },
            {
                id: 'reaction_test',
                title: '‚ö° ÂèçÂ∫îÊµãËØï',
                text: 'ÂÖ≥ÈîÆÊó∂ÂàªÈúÄË¶ÅÈó™ÁîµËà¨ÁöÑÂèçÂ∫îÈÄüÂ∫¶ÔºÅÊù•ÊµãËØï‰∏Ä‰∏ã‰Ω†ÁöÑÊûÅÈôê...',
                isMinigame: true,
                minigameType: 'reaction',
                choices: [
                    { text: 'üéØ ÂºÄÂßãÂèçÂ∫îÈÄüÂ∫¶ÊµãËØï', next: 'minigame_reaction' }
                ]
            },
            {
                id: 'app_download',
                title: 'üì≤ Ëé∑ÂèñÂ∞èÁ±≥ÂïÜÂüé',
                text: 'ÂÖ≥ÈîÆÂ∑•ÂÖ∑ÔºÅ‰ΩÜ‰∏ãËΩΩËøáÁ®ã‰∏≠Ë¢´ËøΩË∏™ÁöÑÈ£éÈô©ÊûÅÈ´ò...',
                choices: [
                    { text: 'üåê ÈÄöËøáÊöóÁΩë‰∏ãËΩΩÂä†ÂØÜÁâàÊú¨', effect: { technology: 3, stealth: 2, health: -15, mentalHealth: -20, successRate: 20 }, item: 'Âä†ÂØÜÂ∞èÁ±≥ÂïÜÂüé', rarity: 'legendary', skillPointsReward: 3, next: 'scout_mission' },
                    { text: 'üîç ÊäÄÊúØËÆ∫ÂùõÂØªÊâæÁâπÊÆäÁâàÊú¨', effect: { technology: 2, health: -8, successRate: 15 }, item: 'ÁâπÊÆäÁâàÊú¨', rarity: 'rare', skillPointsReward: 2, next: 'scout_mission' },
                    { text: 'üì± ÂÆòÊñπÊ∏†ÈÅìÊ≠£Â∏∏‰∏ãËΩΩ', effect: { successRate: 5 }, next: 'scout_mission' },
                    { text: 'üíª ÁΩëÈ°µÁâàËÆøÈóÆ', effect: { stealth: 1, technology: 1, successRate: 8 }, next: 'scout_mission' }
                ]
            },
            {
                id: 'scout_mission',
                title: 'üïµÔ∏è ‰æ¶ÂØü‰ªªÂä°',
                text: 'Ê∑±ÂÖ•ËôéÁ©¥ËøõË°å‰æ¶ÂØüÔºÅË¢´ÂèëÁé∞Â∞±Âú®Ê∏∏Êàè‰∏≠Â§±Ë¥•...',
                choices: [
                    { text: 'üåô Â§úÈó¥ÊΩúÂÖ•ÔºåÂÆåÊï¥‰æ¶ÂØü', effect: { stealth: 4, preparation: 3, health: -20, mentalHealth: -15, successRate: 25 }, flag: 'nightScout', item: 'ËØ¶ÁªÜÂú∞Âõæ', rarity: 'legendary', skillPointsReward: 4, next: 'appointment_prep' },
                    { text: 'üì∑ ËøúÁ®ãÊãçÁÖßËÆ∞ÂΩï', effect: { preparation: 2, technology: 1, health: -5, successRate: 12 }, item: 'ÁÖßÁâáËÆ∞ÂΩï', next: 'appointment_prep' },
                    { text: 'üëÄ Â§ñÂõ¥ËßÇÂØü', effect: { preparation: 1, successRate: 5 }, next: 'appointment_prep' },
                    { text: 'üè† ÊîæÂºÉ‰æ¶ÂØü', effect: { successRate: -10 }, next: 'appointment_prep' }
                ]
            },
            {
                id: 'appointment_prep',
                title: 'üìã È¢ÑÁ∫¶ÂáÜÂ§á',
                text: 'ÁîüÊ≠ªÊî∏ÂÖ≥ÁöÑ‰ø°ÊÅØÂ°´ÂÜôÔºÅ‰∏Ä‰∏™ÈîôËØØÂ∞±‰ºöÂºïËµ∑ÊÄÄÁñë...',
                choices: [
                    { text: 'üé≠ ÂàõÈÄ†ÂÆåÁæéÂÅáË∫´‰ªΩ', effect: { stealth: 3, preparation: 2, mentalHealth: -10, successRate: 18 }, flag: 'fakeIdentity', item: 'ÂÅáË∫´‰ªΩËØÅ', rarity: 'rare', skillPointsReward: 3, next: 'final_preparations' },
                    { text: 'üìù ÊåâÊîªÁï•Á≤æÁ°ÆÂ°´ÂÜô', effect: { preparation: 2, successRate: 12 }, next: 'final_preparations' },
                    { text: 'üéì Â£∞Áß∞Â≠¶ÁîüÁ†îÁ©∂È°πÁõÆ', effect: { stealth: 2, successRate: 8 }, flag: 'studentCover', next: 'final_preparations' },
                    { text: 'üìÑ Èöè‰æøÂ°´ÂÜô', effect: { successRate: -8 }, next: 'final_preparations' }
                ]
            },
            {
                id: 'final_preparations',
                title: '‚öîÔ∏è ÊúÄÁªàÂáÜÂ§á',
                text: 'ÊúÄÂêéÁöÑÂáÜÂ§áÊó∂ÂàªÔºÅÊØè‰∏™ÁªÜËäÇÈÉΩÂèØËÉΩÂÜ≥ÂÆöÊ∏∏ÊàèÊàêË¥•...',
                choices: [
                    { text: 'üí™ ÊûÅÈôê‰ΩìËÉΩÂÜ≤Âà∫ËÆ≠ÁªÉ', effect: { speed: 3, health: -25, mentalHealth: -10, successRate: 15 }, skillPointsReward: 2, next: 'transportation' },
                    { text: 'üß† ÂøÉÁêÜÊöóÁ§∫Âº∫Âåñ', effect: { mentalHealth: 15, courage: 2, successRate: 10 }, skillPointsReward: 1, next: 'transportation' },
                    { text: 'üîß Ë£ÖÂ§áÊúÄÂêéÊ£ÄÊü•', effect: { preparation: 2, technology: 1, successRate: 8 }, next: 'transportation' },
                    { text: 'üç∫ ÂñùÈÖíÂéãÊÉä', effect: { health: -15, mentalHealth: -10, courage: 1, successRate: -5 }, next: 'transportation' }
                ]
            },
            {
                id: 'transportation',
                title: 'üöó ÈÄÉË∑ëËΩΩÂÖ∑',
                text: 'ÈÄâÊã©ÈîôËØØÁöÑÈÄÉË∑ëÂ∑•ÂÖ∑Â∞±ÊòØÊ≠ªË∑Ø‰∏ÄÊù°ÔºÅ',
                choices: [
                    { text: 'üèçÔ∏è ÊîπË£ÖÊë©ÊâòËΩ¶ÔºåÊûÅÈÄüÈÄÉË∑ë', effect: { speed: 5, health: -15, successRate: 20 }, flag: 'hasMotorcycle', item: 'ÊîπË£ÖÊë©Êâò', rarity: 'rare', skillPointsReward: 2, next: 'infiltration' },
                    { text: 'üõµ ÁîµÂä®ËΩ¶ÁÅµÊ¥ªÊú∫Âä®', effect: { speed: 3, stealth: 2, successRate: 15 }, flag: 'hasScooter', item: 'ÁîµÂä®ËΩ¶', next: 'infiltration' },
                    { text: 'üöó Ê±ΩËΩ¶Âø´ÈÄü‰ΩÜÊòæÁúº', effect: { speed: 2, successRate: 8 }, flag: 'hasCar', next: 'infiltration' },
                    { text: 'üèÉ‚Äç‚ôÇÔ∏è Á∫ØÈù†ÂèåËÖø', effect: { speed: 2, courage: 2, health: -10, successRate: 5 }, next: 'infiltration' },
                    { text: 'üöÅ Èõá‰Ω£Áõ¥ÂçáÊú∫', effect: { speed: 8, successRate: 35, skillPoints: 5 }, item: 'Áõ¥ÂçáÊú∫', rarity: 'legendary', special: true, next: 'infiltration' }
                ]
            },
            {
                id: 'infiltration',
                title: 'üèóÔ∏è ÊΩúÂÖ•Èò∂ÊÆµ',
                text: 'ÊΩúÂÖ•ÊúçÂä°‰∏≠ÂøÉÔºÅ‰∏ÄÊ≠•ÈîôËØØÂ∞±ÊòØ‰∏áÂä´‰∏çÂ§ç...',
                choices: [
                    { text: 'üï≥Ô∏è ‰ªé‰∏ãÊ∞¥ÈÅìÊΩúÂÖ•', effect: { stealth: 4, health: -30, mentalHealth: -20, successRate: 20 }, flag: 'sewerEntry', skillPointsReward: 3, next: 'security_bypass' },
                    { text: 'üè¢ ÁøªÂ¢ôËøõÂÖ•', effect: { stealth: 2, speed: 2, health: -15, successRate: 12 }, next: 'security_bypass' },
                    { text: 'üö™ Ê≠£Èó®ËøõÂÖ•', effect: { courage: 1, successRate: 5 }, next: 'security_bypass' },
                    { text: 'üí• ÁÇ∏Âá∫‰∏Ä‰∏™Ê¥û', effect: { courage: 3, health: -20, successRate: -10 }, condition: 'hasExplosives', next: 'security_bypass' }
                ]
            },
            {
                id: 'security_bypass',
                title: 'üîí ÂÆâÂÖ®Á™ÅÁ†¥',
                text: 'Èù¢ÂØπÈ´òÁßëÊäÄÂÆâÈò≤Á≥ªÁªüÔºÅÁ†¥Ëß£Â§±Ë¥•‰ºöÂºïÊù•ÊâÄÊúâ‰øùÂÆâ...',
                choices: [
                    { text: 'üíª ÊäÄÊúØÁ†¥Ëß£', effect: { technology: 3, health: -10, mentalHealth: -15, successRate: 25 }, condition: 'hackedSystem', skillPointsReward: 4, next: 'enter_store' },
                    { text: 'üì° ‰ΩøÁî®‰ø°Âè∑Âπ≤Êâ∞Âô®', effect: { technology: 2, stealth: 2, successRate: 18 }, condition: 'hasJammer', next: 'enter_store' },
                    { text: 'üîß Áâ©ÁêÜÁ†¥Âùè', effect: { health: -20, courage: 2, successRate: 10 }, next: 'enter_store' },
                    { text: 'ü§û Á•àÁ•∑Ê≤°ÊúâÂÆâÈò≤', effect: { luck: 1, successRate: -15 }, next: 'enter_store' }
                ]
            },
            {
                id: 'enter_store',
                title: 'üè™ ËøõÂÖ•ÊúçÂä°‰∏≠ÂøÉ',
                text: 'Áªà‰∫éËøõÂÖ•‰∫ÜÔºÅ‰ΩÜËøôÈáåÂ∞±ÊòØÁöÑÈæôÊΩ≠ËôéÁ©¥...',
                choices: [
                    { text: 'üïµÔ∏è Êöó‰∏≠ËßÇÂØüÂ∏ÉÂ±Ä', effect: { stealth: 2, preparation: 1, successRate: 8 }, next: 'interaction' },
                    { text: 'üòä Ë°®Áé∞Ëá™ÁÑ∂ÔºåÁõ¥Êé•Ë°åÂä®', effect: { courage: 1, successRate: 5 }, next: 'interaction' },
                    { text: 'üì± ÂÅáË£ÖÁ¥ßÊÄ•ÁîµËØù', effect: { stealth: 1, successRate: 3 }, next: 'interaction' },
                    { text: 'üí® Âø´ÈÄüÂÜ≤Âà∫', effect: { speed: 2, health: -5, successRate: -5 }, next: 'interaction' }
                ]
            },
            {
                id: 'interaction',
                title: 'ü§ù ÂàùÊ¨°Êé•Ëß¶',
                text: 'Â∑•Á®ãÂ∏àÁúãÂêë‰Ω†...Ëøô‰∏ÄÂàªÂÜ≥ÂÆöÊ∏∏ÊàèÊàêË¥•ÔºÅ',
                choices: [
                    { text: 'üé≠ ÂÆåÁæéÊºîÊäÄÊ¨∫È™ó', effect: { stealth: 3, mentalHealth: -10, successRate: 15 }, condition: 'masterDisguise', skillPointsReward: 2, next: 'diagnosis' },
                    { text: 'üìã Âá∫Á§∫È¢ÑÁ∫¶‰ø°ÊÅØ', effect: { preparation: 1, successRate: 8 }, next: 'diagnosis' },
                    { text: 'üòÖ Ë£Ö‰ΩúÊó†ÂÆ≥ÂÆ¢Êà∑', effect: { stealth: 2, successRate: 10 }, next: 'diagnosis' },
                    { text: 'üò∞ Á¥ßÂº†ËøáÂ∫¶Êö¥Èú≤', effect: { mentalHealth: -15, successRate: -20 }, next: 'diagnosis' }
                ]
            },
            {
                id: 'diagnosis',
                title: 'üîç ÊïÖÈöúËØäÊñ≠',
                text: 'Â∑•Á®ãÂ∏àÂºÄÂßãÊ£ÄÊü•...ÂøÉË∑≥Â¶ÇÈõ∑È∏£ÔºÅ',
                choices: [
                    { text: 'üìñ ËØ¶ÁªÜÊèèËø∞ÊïÖÈöú', effect: { preparation: 2, successRate: 8 }, next: 'computer_access' },
                    { text: 'ü§î Ê®°Á≥äÂºïÂØºÊìç‰Ωú', effect: { stealth: 2, successRate: 6 }, next: 'computer_access' },
                    { text: 'üí° ÊöóÁ§∫ÈúÄË¶ÅÈáçÁΩÆ', effect: { technology: 1, successRate: 10 }, next: 'computer_access' },
                    { text: 'üòµ Ë£Ö‰ΩúÊäÄÊúØÂ∞èÁôΩ', effect: { stealth: 1, luck: 1, successRate: 5 }, next: 'computer_access' }
                ]
            },
            {
                id: 'computer_access',
                title: 'üíª ÂÖ≥ÈîÆÊó∂Âàª',
                text: '‰ªñËøûÊé•‰∫ÜÁîµËÑëÔºÅÂçÉËΩΩÈöæÈÄ¢ÁöÑÊú∫‰ºöÔºÅ',
                choices: [
                    { text: 'üëÄ Ê≠ªÊ≠ªÁõØÁùÄÊìç‰Ωú', effect: { technology: 2, preparation: 1, successRate: 8 }, next: 'critical_moment' },
                    { text: 'üó£Ô∏è ËÅäÂ§©ÂàÜÊï£Ê≥®ÊÑè', effect: { stealth: 2, successRate: 10 }, next: 'critical_moment' },
                    { text: 'üì± ÂÅáË£ÖÊé•ÁîµËØù', effect: { stealth: 1, successRate: 5 }, next: 'critical_moment' },
                    { text: 'üò§ ÂáÜÂ§áË°åÂä®', effect: { courage: 2, successRate: 6 }, next: 'critical_moment' }
                ]
            },
            {
                id: 'critical_moment',
                title: '‚ö° ÂçÉÈíß‰∏ÄÂèë',
                text: 'BLËß£ÈîÅÊ†áÂøóÂá∫Áé∞‰∫ÜÔºÅÔºÅÔºÅËøôÊòØÂîØ‰∏ÄÁöÑÊú∫‰ºöÔºÅÔºÅÔºÅ',
                choices: [
                    { text: '‚è∞ Á≠âÂæÖÂÆåÁæéÊó∂Êú∫', effect: { preparation: 3, stealth: 2, successRate: 15 }, next: 'action_phase' },
                    { text: '‚ö° Èó™ÁîµÂá∫Âáª', effect: { speed: 3, successRate: 12 }, next: 'action_phase' },
                    { text: 'üé≠ Âà∂ÈÄ†Ê∑∑‰π±', effect: { stealth: 2, courage: 2, successRate: 10 }, next: 'action_phase' },
                    { text: 'üò± ÊâãÊäñÊö¥Èú≤', effect: { mentalHealth: -20, successRate: -25 }, next: 'action_phase' }
                ]
            },
            {
                id: 'action_phase',
                title: 'üèÉ‚Äç‚ôÇÔ∏è ÁîüÊ≠ªÊó∂ÈÄü',
                text: 'ÊäìËµ∑ËÆæÂ§áÁöÑÁû¨Èó¥ÔºÅ"Á´ô‰ΩèÔºÅÔºÅ"ÊÄíÂêºÂìçÂΩªÊàøÈó¥ÔºÅ',
                choices: [
                    { text: 'üí® ÊãºÂëΩÁãÇÂ•î', effect: { speed: 4, health: -15, successRate: 18 }, next: 'chase_sequence' },
                    { text: 'ü™ë Ë∏¢ÁøªÈöúÁ¢çÁâ©', effect: { speed: 2, courage: 2, successRate: 12 }, next: 'chase_sequence' },
                    { text: 'üî• Â§ßÂñä"ÁùÄÁÅ´‰∫Ü"', effect: { courage: 3, mentalHealth: -5, successRate: 8 }, next: 'chase_sequence' },
                    { text: 'ü§∏ ÊàòÊúØÁøªÊªö', effect: { speed: 2, stealth: 1, luck: 1, successRate: 10 }, next: 'chase_sequence' },
                    { text: 'üí• ÂºïÁàÜÁÇ∏ÂºπÊé©Êä§', effect: { courage: 5, health: -25, successRate: 30 }, condition: 'hasExplosives', special: true, next: 'chase_sequence' }
                ]
            },
            {
                id: 'chase_sequence',
                title: 'üö® ÁñØÁãÇËøΩÂáª',
                text: 'Ë∫´Âêé‰º†Êù•ÂØÜÈõÜÁöÑËÑöÊ≠•Â£∞ÔºÅË≠¶Á¨õÂ£∞ÂìçËµ∑ÔºÅËøôÊòØÁîüÊ≠ªÂÖ≥Â§¥ÔºÅ',
                choices: [
                    { text: 'üèÉ‚Äç‚ôÇÔ∏è ÁáÉÁÉßÁîüÂëΩÁãÇÂ•î', effect: { speed: 5, health: -30, mentalHealth: -15, successRate: 20 }, next: 'final_escape' },
                    { text: 'üß† ÂÜ∑ÈùôÂàÜÊûêË∑ØÁ∫ø', effect: { preparation: 2, stealth: 2, health: -10, successRate: 15 }, next: 'final_escape' },
                    { text: 'üó∫Ô∏è ‰ΩøÁî®È¢ÑËÆæË∑ØÁ∫ø', effect: { preparation: 3, successRate: 22 }, condition: 'nightScout', next: 'final_escape' },
                    { text: 'üåÉ Ê∂àÂ§±Âú®Â§úËâ≤‰∏≠', effect: { stealth: 4, luck: 2, successRate: 18 }, condition: 'ninjaTraining', next: 'final_escape' }
                ]
            },
            {
                id: 'final_escape',
                title: 'üèÅ ÁªàÊûÅÈÄÉËÑ±',
                text: 'ÊúÄÂêéÁöÑÂÜ≤Âà∫ÔºÅ‰Ω†Â∑≤ÁªèÁ≠ãÁñ≤ÂäõÂ∞ΩÔºå‰ΩÜËÉúÂà©Â∞±Âú®ÁúºÂâçÔºÅ',
                choices: [
                    { text: 'üöÄ Ë∂ÖË∂äÊûÅÈôêÁàÜÂèë', effect: { speed: 6, health: -35, mentalHealth: -20, successRate: 25 }, next: 'result' },
                    { text: 'üéØ Á≤æÂáÜËÆ°ÁÆóÈÄÉËÑ±', effect: { preparation: 3, stealth: 2, health: -15, successRate: 20 }, next: 'result' },
                    { text: 'üçÄ Á•àÁ•∑Âπ∏ËøêÂ•≥Á•û', effect: { luck: 5, health: -10, successRate: 15 }, next: 'result' },
                    { text: 'üòé Ê∑°ÂÆöÂÆåÁæéÊî∂Â∞æ', effect: { stealth: 3, courage: 2, successRate: 18 }, next: 'result' },
                    { text: 'üöÅ Áõ¥ÂçáÊú∫Á©∫‰∏≠Êé•Â∫î', effect: { speed: 10, successRate: 40 }, condition: 'hasHelicopter', special: true, next: 'result' }
                ]
            }
        ];

        // --- Core Game Logic ---
        function initializeGameState() {
            currentStep = 0;
            successRate = 5;
            health = 100;
            mentalHealth = 100;
            skillPoints = 0;
            gameStartTime = Date.now();
            randomEventCount = 0;
            achievements = [];
            godMode = false;
            inventory = [];
            isProcessing = false;
            justHadRandomEvent = false;
            
            playerStats = { 
                preparation: 0, stealth: 0, speed: 0, 
                luck: 0, courage: 0, technology: 0 
            };
            flags = {
                hasBackup: false, knowsLayout: false, hasInside: false,
                hasDisguise: false, isMinor: false, hasVehicle: false,
                perfectTiming: false, survivedPoison: false, wonReactionGame: false,
                masterHacker: false, speedRunner: false, luckyDodge: false
            };
        }

        function startGame() {
            initializeGameState();
            
            const statsDock = document.getElementById('statsDock');
            const dockToggle = document.getElementById('dockToggle');
            statsDock.style.display = 'block';
            dockToggle.textContent = '√ó';
            dockToggle.style.backgroundColor = 'rgba(220, 53, 69, 0.9)';
            dockToggle.style.color = 'white';
            document.getElementById('skillPointsDisplay').style.display = 'block';
            
            unlockAchievement('first_play');
            
            updateTimer();
            nextStep();
        }

        function nextStep() {
            if (!justHadRandomEvent && currentStep > 0 && currentStep < gameSteps.length - 2 && Math.random() < 0.3) {
                justHadRandomEvent = true;
                triggerRandomEvent();
                return;
            }

            justHadRandomEvent = false;

            const step = gameSteps[currentStep];
            const gameArea = document.getElementById('gameArea');
            
            if (step.isMinigame) {
                showMinigame(step);
                return;
            }
            
            let choicesHtml = '';
            step.choices.forEach((choice, index) => {
                if (choice.condition && !flags[choice.condition]) return;
                
                let btnClass = 'choice-btn';
                if (choice.special) btnClass += ' special';
                else if ((choice.effect.health && choice.effect.health <= -20) || (choice.effect.mentalHealth && choice.effect.mentalHealth <= -15)) btnClass += ' deadly';
                else if ((choice.effect.successRate && choice.effect.successRate < 0) || (choice.effect.health && choice.effect.health < 0)) btnClass += ' danger';
                else if (choice.effect.successRate && choice.effect.successRate < 5) btnClass += ' neutral';
                
                choicesHtml += `<button class="${btnClass}" onclick="makeChoice(${index})">${choice.text}</button>`;
            });

            const isFinalEscape = step.id.includes('final') || step.id.includes('escape') || step.id.includes('chase');
            const areaClass = isFinalEscape ? 'final-escape-area' : '';
            const dangerIndicator = isFinalEscape ? '<div class="danger-indicator">‚ö†Ô∏è Âç±Èô©</div>' : '';

            gameArea.innerHTML = `
                <div class="${areaClass}">
                    ${dangerIndicator}
                    <h2 style="color: #333; margin-bottom: 20px;">${step.title}</h2>
                    <div class="story-text">${step.text}</div>
                    <div class="choices">${choicesHtml}</div>
                </div>
            `;

            updateStats();
            isProcessing = false;
        }

        function makeChoice(choiceIndex) {
            if (isProcessing) return;
            isProcessing = true;

            document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = true);

            const step = gameSteps[currentStep];
            const choice = step.choices[choiceIndex];
            
            Object.keys(choice.effect).forEach(key => {
                if (key === 'successRate') successRate += choice.effect[key];
                else if (key === 'health') health = Math.max(0, Math.min(100, health + choice.effect[key]));
                else if (key === 'mentalHealth') mentalHealth = Math.max(0, Math.min(100, mentalHealth + choice.effect[key]));
                else if (key === 'skillPoints') skillPoints += choice.effect[key];
                else playerStats[key] = Math.max(0, playerStats[key] + choice.effect[key]);
            });

            if (choice.skillPointsReward) skillPoints += choice.skillPointsReward;
            if (choice.flag) flags[choice.flag] = true;
            if (choice.item) inventory.push({ name: choice.item, rarity: choice.rarity || 'common' });

            updateStats();
            checkAchievements();

            if (checkHealthStatus()) {
                return;
            }

            try {
                if (choice.next === 'result') {
                    showResult();
                } else if (choice.next === 'minigame_reaction') {
                    showReactionGame(); 
                } else {
                    const nextStepIndex = gameSteps.findIndex(s => s.id === choice.next);
                    if (nextStepIndex !== -1) {
                        currentStep = nextStepIndex;
                        nextStep();
                    } else {
                        throw new Error(`Next step ID not found: ${choice.next}`);
                    }
                }
            } catch (error) {
                console.error("CRITICAL ERROR:", error.message);
                alert("ÂèëÁîü‰∫Ü‰∏Ä‰∏™‰∏•ÈáçÈîôËØØÔºöÊâæ‰∏çÂà∞‰∏ã‰∏ÄÊ≠•„ÄÇÊ∏∏ÊàèÂ∑≤ÂÅúÊ≠¢„ÄÇËØ∑Â∞ùËØïÂà∑Êñ∞ÊàñÈáçÊñ∞ÂºÄÂßã„ÄÇ");
                isProcessing = false;
            }
        }

        function checkHealthStatus() {
            if (health <= 0) {
                showResult('death');
                return true;
            }
            if (mentalHealth <= 0) {
                showResult('mental_breakdown');
                return true;
            }
            if (health <= 15 && !achievements.includes('survivor')) {
                unlockAchievement('survivor');
            }
            return false;
        }

        function checkAchievements() {
            const gameTime = Math.floor((Date.now() - gameStartTime) / 1000);
            if (gameTime <= 60 && !achievements.includes('speed_runner')) unlockAchievement('speed_runner');
            if (inventory.length >= 10 && !achievements.includes('collector')) unlockAchievement('collector');
            if (mentalHealth >= 80 && !achievements.includes('iron_will')) unlockAchievement('iron_will');
            if (playerStats.technology >= 10 && !achievements.includes('master_hacker')) unlockAchievement('master_hacker');
        }

        function unlockAchievement(achievementId) {
            if (achievements.includes(achievementId)) return;
            achievements.push(achievementId);
            const achievement = achievementList.find(a => a.id === achievementId);
            if (achievement) {
                showAchievementPopup(achievement);
                skillPoints += 2;
            }
        }

        function showAchievementPopup(achievement) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">üèÜ ÊàêÂ∞±Ëß£ÈîÅ!</div>
                <div>${achievement.emoji} ${achievement.name}</div>
                <div style="font-size: 0.8em; margin-top: 5px;">${achievement.desc}</div>
                <div style="font-size: 0.7em; margin-top: 3px; color: #ffd700;">+2 ÊäÄËÉΩÁÇπÊï∞</div>
            `;
            document.body.appendChild(popup);
            setTimeout(() => {
                if (document.body.contains(popup)) {
                    document.body.removeChild(popup);
                }
            }, 3000);
        }

        function triggerRandomEvent() {
            const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
            randomEventCount++;
            
            Object.keys(event.effect).forEach(key => {
                if (key === 'successRate') successRate += event.effect[key];
                else if (key === 'health') health = Math.max(0, Math.min(100, health + event.effect[key]));
                else if (key === 'mentalHealth') mentalHealth = Math.max(0, Math.min(100, mentalHealth + event.effect[key]));
                else if (key === 'skillPoints') skillPoints += event.effect[key];
                else playerStats[key] = Math.max(0, playerStats[key] + (event.effect[key] || 0));
            });

            if (randomEventCount >= 7 && event.effect.successRate > 0 && !achievements.includes('lucky_seven')) {
                unlockAchievement('lucky_seven');
            }

            const effectStrings = Object.keys(event.effect).map(key => {
                const value = event.effect[key];
                const symbol = value > 0 ? '+' : '';
                const chineseKey = { 'successRate': 'ÊàêÂäüÁéá', 'health': 'ÂÅ•Â∫∑ÂÄº', 'mentalHealth': 'Á≤æÁ•ûÂÄº', 'skillPoints': 'ÊäÄËÉΩÁÇπ', 'preparation': 'ÂáÜÂ§á', 'stealth': 'ÈöêËîΩ', 'speed': 'ÈÄüÂ∫¶', 'luck': 'ËøêÊ∞î', 'courage': 'ÂãáÊ∞î', 'technology': 'ÊäÄÊúØ' }[key] || key;
                return `${chineseKey}: ${symbol}${value}`;
            });

            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="random-event">
                    <h2 style="color: #007bff; margin-bottom: 15px;">üé≤ ÈöèÊú∫‰∫ã‰ª∂</h2>
                    <div style="font-size: 1.2em; margin-bottom: 20px;">${event.text}</div>
                    <div style="font-size: 0.9em; color: #666;">${effectStrings.join(' | ')}</div>
                    <button class="choice-btn" onclick="continueAfterEvent()" style="margin-top: 20px;">ÁªßÁª≠ÂâçËøõ</button>
                </div>
            `;

            updateStats();
            if (checkHealthStatus()) return;
            isProcessing = false;
        }

        function continueAfterEvent() {
            if (isProcessing) return;
            isProcessing = true;
            document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = true);
            nextStep();
        }

        function showMinigame(step) {
            if (step.minigameType === 'reaction') showReactionGame();
        }

        function showReactionGame() {
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="minigame-container">
                    <h2 style="color: #ffc107; margin-bottom: 20px;">‚ö° ÂèçÂ∫îÈÄüÂ∫¶ÊµãËØï</h2>
                    <div style="margin-bottom: 20px;">ÂΩìÊåâÈíÆÂèòÁªøÊó∂Á´ãÂç≥ÁÇπÂáªÔºÅÊµãËØï‰Ω†ÁöÑÂèçÂ∫îÊûÅÈôêÔºÅ</div>
                    <div class="reaction-game">
                        <button class="reaction-btn" id="reactionBtn" onclick="reactionTest()">Á≠âÂæÖ...</button>
                    </div>
                    <div id="reactionResult" style="margin-top: 20px; font-weight: bold;"></div>
                </div>
            `;
            isProcessing = false;
            setTimeout(() => {
                const btn = document.getElementById('reactionBtn');
                if (btn) {
                    btn.classList.add('active');
                    btn.textContent = 'ÁÇπÂáª!';
                    btn.dataset.startTime = Date.now();
                }
            }, Math.random() * 3000 + 2000);
        }

        function reactionTest() {
            if (isProcessing) return;
            isProcessing = true;
            const btn = document.getElementById('reactionBtn');
            const resultDiv = document.getElementById('reactionResult');
            btn.disabled = true;
            
            if (!btn.classList.contains('active')) {
                resultDiv.innerHTML = '‚ùå Â§™Êó©‰∫ÜÔºÅÂèçÂ∫îÊµãËØïÂ§±Ë¥•ÔºÅ<br><button class="choice-btn" onclick="finishReactionGame(false)">ÁªßÁª≠Ê∏∏Êàè</button>';
                isProcessing = false;
                return;
            }

            const reactionTime = Date.now() - parseInt(btn.dataset.startTime);
            let bonus = 0, message = '';
            
            if (reactionTime < 200) { message = 'üöÄ Èó™ÁîµÂèçÂ∫îÔºÅ'; bonus = 20; flags.wonReactionGame = true; unlockAchievement('speed_runner'); }
            else if (reactionTime < 400) { message = '‚ö° ‰ºòÁßÄÂèçÂ∫îÔºÅ'; bonus = 15; flags.wonReactionGame = true; }
            else if (reactionTime < 600) { message = 'üëç ËâØÂ•ΩÂèçÂ∫îÔºÅ'; bonus = 10; }
            else { message = 'üòê ÂèçÂ∫î‰∏ÄËà¨...'; bonus = 5; }

            resultDiv.innerHTML = `
                ${message}<br>ÂèçÂ∫îÊó∂Èó¥: ${reactionTime}ms<br>ÊàêÂäüÁéáÂ•ñÂä±: +${bonus}%<br>
                <button class="choice-btn" onclick="finishReactionGame(true, ${bonus})">ÁªßÁª≠Ê∏∏Êàè</button>
            `;
            isProcessing = false;
        }

        function finishReactionGame(success, bonus = 0) {
            if (isProcessing) return;
            isProcessing = true;

            if (success) {
                successRate += bonus;
                if (bonus >= 15) { skillPoints += 3; playerStats.speed += 2; }
            } else {
                successRate -= 10; health -= 10; mentalHealth -= 15;
            }

            updateStats();
            if (checkHealthStatus()) return;

            const nextStepIndex = gameSteps.findIndex(s => s.id === 'app_download');
            if (nextStepIndex !== -1) {
                currentStep = nextStepIndex;
                nextStep();
            } else {
                console.error("CRITICAL ERROR: Could not find 'app_download' step after minigame.");
                alert("ÂèëÁîü‰∫Ü‰∏Ä‰∏™‰∏•ÈáçÈîôËØØÔºöÂ∞èÊ∏∏ÊàèÂêéÊó†Ê≥ïÁªßÁª≠„ÄÇÊ∏∏ÊàèÂ∑≤ÂÅúÊ≠¢„ÄÇËØ∑Â∞ùËØïÂà∑Êñ∞ÊàñÈáçÊñ∞ÂºÄÂßã„ÄÇ");
                isProcessing = false;
            }
        }

        function calculateCurrentSuccessRate() {
            if (gameStartTime === 0) return successRate;
            let currentSuccessRate = successRate + playerStats.preparation * 1.2 + playerStats.stealth * 1.5 + playerStats.speed * 1.8 + playerStats.luck * 1.5 + playerStats.courage * 1.0 + playerStats.technology * 1.0 + skillPoints * 0.8;
            if (flags.hasBackup) currentSuccessRate += 5;
            if (flags.nightScout) currentSuccessRate += 8;
            if (flags.hasInside) currentSuccessRate += 10;
            if (flags.masterDisguise) currentSuccessRate += 7;
            if (flags.ninjaTraining) currentSuccessRate += 12;
            if (flags.quantumBackup) currentSuccessRate += 15;
            if (flags.wonReactionGame) currentSuccessRate += 8;
            if (health < 30) currentSuccessRate -= 15;
            if (mentalHealth < 30) currentSuccessRate -= 20;
            if (health <= 10) currentSuccessRate -= 25;
            if (mentalHealth <= 10) currentSuccessRate -= 30;
            if (godMode) return 100;
            return Math.max(0, Math.min(95, currentSuccessRate));
        }

        function updateStats() {
            const healthFill = document.getElementById('healthFill');
            const healthText = document.getElementById('healthText');
            if (healthFill && healthText) {
                const healthColor = health > 60 ? '#28a745' : health > 30 ? '#ffc107' : '#dc3545';
                healthFill.style.width = health + '%';
                healthFill.style.background = healthColor;
                healthText.textContent = health;
            }

            const mentalFill = document.getElementById('mentalFill');
            const mentalText = document.getElementById('mentalText');
            if (mentalFill && mentalText) {
                const mentalColor = mentalHealth > 60 ? '#007bff' : mentalHealth > 30 ? '#ffc107' : '#dc3545';
                mentalFill.style.width = mentalHealth + '%';
                mentalFill.style.background = mentalColor;
                mentalText.textContent = mentalHealth;
            }

            const successRateText = document.getElementById('successRateText');
            if (successRateText) {
                const rate = Math.round(calculateCurrentSuccessRate());
                const color = rate > 30 ? '#28a745' : rate > 15 ? '#ffc107' : '#dc3545';
                successRateText.innerHTML = `<span style="color: ${color};">${rate}%</span>`;
            }

            const skillPointsText = document.getElementById('skillPointsText');
            const powerLevelText = document.getElementById('powerLevelText');
            if (skillPointsText && powerLevelText) {
                skillPointsText.textContent = skillPoints;
                const totalPower = Object.values(playerStats).reduce((a, b) => a + b, 0) + skillPoints;
                let powerLevel = 'Êñ∞Êâã';
                if (totalPower >= 50) powerLevel = '‰º†Â•á';
                else if (totalPower >= 30) powerLevel = '‰∏ìÂÆ∂';
                else if (totalPower >= 20) powerLevel = 'ÁÜüÁªÉ';
                else if (totalPower >= 10) powerLevel = 'ËøõÈò∂';
                powerLevelText.textContent = powerLevel;
            }

            const inventoryPanel = document.getElementById('inventoryPanel');
            const inventoryItems = document.getElementById('inventoryItems');
            if (inventoryPanel && inventoryItems) {
                if (inventory.length > 0) {
                    inventoryPanel.style.display = 'block';
                    inventoryItems.innerHTML = inventory.map(item => `<span class="inventory-item ${item.rarity}">${item.name}</span>`).join('');
                } else {
                    inventoryPanel.style.display = 'none';
                }
            }
        }

        function showResult(forceResult = null) {
            const gameArea = document.getElementById('gameArea');
            const finalSuccessRate = calculateCurrentSuccessRate();
            
            let resultType = forceResult;
            if (!resultType) {
                const roll = Math.random() * 100;
                if (roll < finalSuccessRate * 0.08) resultType = 'legendary';
                else if (roll < finalSuccessRate * 0.35) resultType = 'success';
                else if (roll < finalSuccessRate * 0.65) resultType = 'caught';
                else if (health <= 5) resultType = 'death';
                else if (mentalHealth <= 5) resultType = 'mental_breakdown';
                else if (roll < 85) resultType = 'failure';
                else resultType = (finalSuccessRate < 20) ? 'caught' : 'failure';
            }
            
            if ((resultType === 'success' || resultType === 'legendary') && health === 100 && mentalHealth === 100) unlockAchievement('perfect_health');
            if (resultType === 'legendary') unlockAchievement('legendary_end');
            if (health <= 5 && (resultType === 'success' || resultType === 'legendary')) unlockAchievement('death_defier');
            
            const endingDetails = getDetailedEnding(resultType);
            const gameTime = Math.floor((Date.now() - gameStartTime) / 1000);

            let rating = 'F';
            if (finalSuccessRate >= 80 && health >= 70 && mentalHealth >= 70) rating = 'S+';
            else if (finalSuccessRate >= 70) rating = 'S';
            else if (finalSuccessRate >= 60) rating = 'A';
            else if (finalSuccessRate >= 50) rating = 'B';
            else if (finalSuccessRate >= 35) rating = 'C';
            else if (finalSuccessRate >= 20) rating = 'D';

            gameArea.innerHTML = `
                <div class="result ${endingDetails.class}">
                    ${endingDetails.emoji} ${endingDetails.title} ${endingDetails.emoji}
                </div>
                <div class="story-text">
                    ${endingDetails.message}
                    <br><br>
                    <div style="text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <div style="font-size: 1.5em; margin-bottom: 10px;">Ê∏∏ÊàèËØÑÁ∫ß: <span style="color: #ffd700; font-weight: bold;">${rating}</span></div>
                        <div>${endingDetails.subtitle}</div>
                        <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.9;">${endingDetails.specialNote}</div>
                    </div>
                </div>
                <div style="text-align: center; margin: 20px 0;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 20px 0;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ÊúÄÁªàÊàêÂäüÁéá</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${Math.round(finalSuccessRate)}%</div></div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Ê∏∏ÊàèÊó∂Èïø</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${gameTime}Áßí</div></div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Áâ©ÂìÅÊî∂ÈõÜ</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${inventory.length}‰∏™</div></div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ÊäÄËÉΩÁÇπÊï∞</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${skillPoints}</div></div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ÊúÄÁªàÂÅ•Â∫∑</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${health}/100</div></div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Á≤æÁ•ûÁä∂ÊÄÅ</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${mentalHealth}/100</div></div>
                    </div>
                    <div style="margin: 20px 0; font-size: 0.9em; color: #666;"><strong>ÊúÄÁªàÂ±ûÊÄßÔºö</strong> ÂáÜÂ§á${playerStats.preparation} | ÈöêËîΩ${playerStats.stealth} | ÈÄüÂ∫¶${playerStats.speed} | ËøêÊ∞î${playerStats.luck} | ÂãáÊ∞î${playerStats.courage} | ÊäÄÊúØ${playerStats.technology}</div>
                    <div style="margin: 20px 0; font-size: 0.9em; color: #666;"><strong>Ëé∑ÂæóÊàêÂ∞±Ôºö</strong> ${achievements.length}‰∏™ ${achievements.length > 0 ? '<br>' + achievements.map(id => { const ach = achievementList.find(a => a.id === id); return ach ? `${ach.emoji} ${ach.name}` : ''; }).join(' | ') : 'Êó†'}</div>
                    <div style="margin: 20px 0; font-size: 0.9em; color: #666;"><strong>ÈöèÊú∫‰∫ã‰ª∂Ôºö</strong> ${randomEventCount}Ê¨°</div>
                </div>
                <div style="text-align: center;">
                    <button class="reset-btn" onclick="startGame()">üîÑ ÂÜçÊ¨°ÊåëÊàò</button>
                    <button class="share-btn" onclick="shareResult('${resultType}', ${Math.round(finalSuccessRate)}, ${gameTime}, '${rating}')">üì§ ÂàÜ‰∫´ÁªìÊûú</button>
                </div>
                <div style="margin-top: 20px; color: #666; font-size: 0.9em; text-align: center;">${getMotivationalMessage(resultType, finalSuccessRate)}</div>
            `;
            isProcessing = false;
        }

        function getDetailedEnding(baseType) {
            const gameTime = Math.floor((Date.now() - gameStartTime) / 1000);
            let specialModifiers = [];
            if (health === 100 && mentalHealth === 100) specialModifiers.push('perfect');
            else if (health <= 10) specialModifiers.push('barely_alive');
            if (skillPoints >= 20) specialModifiers.push('master');
            if (gameTime <= 60) specialModifiers.push('speedrun');
            if (inventory.length >= 10) specialModifiers.push('collector');
            if (flags.ninjaTraining) specialModifiers.push('ninja');
            if (flags.hackedSystem) specialModifiers.push('hacker');
            return getEndingData(baseType, specialModifiers);
        }

        function getEndingData(baseType, modifiers) {
            const baseEndings = {
                legendary: { emoji: 'üëë', class: 'legendary', baseTitle: '‰º†Â•áÁªìÂ±Ä' },
                success: { emoji: 'üéâ', class: 'success', baseTitle: 'ÊàêÂäüÁªìÂ±Ä' },
                caught: { emoji: 'üòÖ', class: 'caught', baseTitle: 'Ë¢´ÊäìÁªìÂ±Ä' },
                failure: { emoji: 'üò¢', class: 'failure', baseTitle: 'Â§±Ë¥•ÁªìÂ±Ä' },
                death: { emoji: 'üíÄ', class: 'death', baseTitle: 'Ê≠ª‰∫°ÁªìÂ±Ä' },
                mental_breakdown: { emoji: 'ü§Ø', class: 'failure', baseTitle: 'Á≤æÁ•ûÂ¥©Ê∫ÉÁªìÂ±Ä' }
            };
            const base = baseEndings[baseType];
            let title = base.baseTitle, subtitle = '', specialNote = '', message = '';
            if (modifiers.includes('perfect')) { title += ' - ÂÆåÁæéÊó†Áëï'; subtitle = '‰ª•ÂÆåÁæéÁä∂ÊÄÅËææÊàêÁõÆÊ†áÔºÅ'; specialNote = '‰º†ËØ¥‰∏≠ÁöÑÂÆåÁæéÈÄöÂÖ≥ÔºÅ'; }
            else if (modifiers.includes('barely_alive')) { title += ' - Ê≠ªÈáåÈÄÉÁîü'; subtitle = 'Âú®Ê≠ª‰∫°ËæπÁºòÂÆåÊàê‰ªªÂä°ÔºÅ'; specialNote = 'ÁúüÊ≠£ÁöÑÊ≠ªÁ•ûËîëËßÜËÄÖÔºÅ'; }
            if (modifiers.includes('speedrun')) { title += ' - Èó™ÁîµË°åÂä®'; subtitle = '‰ª•ÊÉä‰∫∫ÁöÑÈÄüÂ∫¶ÂÆåÊàêÊåëÊàòÔºÅ'; specialNote = 'ÈÄüÂ∫¶Â∞±ÊòØÁîüÂëΩÔºÅ'; }
            if (modifiers.includes('ninja')) { title += ' - ÊöóÂΩ±Â§ßÂ∏à'; subtitle = 'Â¶ÇÂΩ±ÈöèÂΩ¢ÔºåÊó†Â£∞Êó†ÊÅØÔºÅ'; specialNote = 'ÂøçËÄÖ‰πãÈÅìÔºåÂ§ßÊàêÔºÅ'; }
            message = generateEndingMessage(baseType, modifiers);
            return { emoji: base.emoji, title, subtitle, specialNote, message, class: base.class };
        }

        function generateEndingMessage(baseType, modifiers) {
            const messages = {
                legendary: ['Á•ûËØùËØûÁîüÔºÅ‰Ω†ÁöÑË°®Áé∞Â∑≤ÁªèË∂ÖË∂ä‰∫ÜÊ∏∏ÊàèÁöÑÊûÅÈôêÔºÅ', '‰º†Â•á‰∏≠ÁöÑ‰º†Â•áÔºÅ‰Ω†ÂàõÈÄ†‰∫ÜÂâçÊó†Âè§‰∫∫ÁöÑÂÆåÁæéËÆ∞ÂΩïÔºÅ'],
                success: ['Â•áËøπÔºÅ‰Ω†ÊàêÂäüÈÄÉËÑ±‰∫ÜÔºÅËé∑Âæó‰∫Ü‰º†ËØ¥‰∏≠ÁöÑROOTÊùÉÈôêÔºÅ', '‰∏çÂèØÊÄùËÆÆÔºÅ‰Ω†ÁúüÁöÑÂÅöÂà∞‰∫ÜÔºÅÊàê‰∏∫‰∫ÜÂ∞èÁ±≥È©¨ÊãâÊùæÁöÑ‰º†Â•á‰∫∫Áâ©ÔºÅ'],
                caught: ['ÂæàÈÅóÊÜæÔºå‰Ω†Ë¢´Êäì‰Ωè‰∫Ü...ËôΩÁÑ∂BLËß£ÈîÅ‰∫ÜÔºå‰ΩÜÈù¢‰∏¥Â∑®È¢ùËµîÂÅøÔºÅ', 'Âäü‰∫è‰∏ÄÁØëÔºÅË¢´‰øùÂÆâÂà∂Êúç‰∫ÜÔºå‰∏çËøáËá≥Â∞ëËÆæÂ§áËß£ÈîÅ‰∫ÜÔºÅ'],
                failure: ['ÂÆåÂÖ®Â§±Ë¥•ÔºÅBLÊ≤°Ëß£ÈîÅÔºåËøòÂèØËÉΩÈù¢‰∏¥Ëµ∑ËØâÔºÅ', '‰ªªÂä°Â§±Ë¥•ÔºÅÂ∑•Á®ãÂ∏àÂèäÊó∂ÈòªÊ≠¢‰∫Ü‰Ω†ÔºåËÆæÂ§á‰æùÁÑ∂Ë¢´ÈîÅÁùÄÔºÅ'],
                death: ['Âú®ÊøÄÁÉàÁöÑËøΩÈÄê‰∏≠Ôºå‰Ω†‰ªòÂá∫‰∫ÜÊúÄÁªàÁöÑ‰ª£‰ª∑...‰ΩÜÁ≤æÁ•ûÊ∞∏Â≠òÔºÅ', 'Â£ÆÁÉàÁâ∫Áâ≤ÔºÅËôΩÁÑ∂ÁîüÂëΩÁªàÁªì‰∫ÜÔºå‰ΩÜÊàê‰∏∫‰∫ÜËß£ÈîÅÂè≤‰∏äÁöÑËã±ÈõÑÔºÅ'],
                mental_breakdown: ['Â∑®Â§ßÁöÑÂøÉÁêÜÂéãÂäõËÆ©‰Ω†ÂΩªÂ∫ïÂ¥©Ê∫É‰∫Ü...Áé∞Âú®Âè™ËÉΩÂú®ÂåªÈô¢ÈáåÂõûÂøÜ...', 'Á≤æÁ•ûÈò≤Á∫øÂÖ®Èù¢Â¥©Â°åÔºÅÈ´òÂº∫Â∫¶ÁöÑÂéãÂäõËÆ©‰Ω†Â§±Âéª‰∫ÜÁêÜÊô∫...']
            };
            let baseMessage = messages[baseType][Math.floor(Math.random() * messages[baseType].length)];
            if (modifiers.includes('perfect')) baseMessage += '\n\nüíé Êõ¥‰ª§‰∫∫ÈúáÊÉäÁöÑÊòØÔºå‰Ω†‰ª•ÂÆåÁæéÁöÑÁä∂ÊÄÅÂÆåÊàê‰∫ÜËøô‰∏ÄÂàáÔºÅ';
            if (modifiers.includes('barely_alive')) baseMessage += '\n\nüíÄ ËôΩÁÑ∂‰Ω†Âá†‰πéÊ≠ªÂú®‰∫ÜË∑Ø‰∏äÔºå‰ΩÜÂá≠ÂÄüÁùÄÊÉä‰∫∫ÁöÑÊÑèÂøóÂäõÂùöÊåÅÂà∞‰∫ÜÊúÄÂêéÔºÅ';
            if (modifiers.includes('ninja')) baseMessage += '\n\nü•∑ ‰Ω†ÁöÑÂøçËÄÖÊäÄËÉΩÂèëÊå•‰∫ÜÂÖ≥ÈîÆ‰ΩúÁî®ÔºÅ';
            return baseMessage;
        }

        function getMotivationalMessage(resultType, successRate) {
            if (resultType === 'success' || resultType === 'legendary') return 'üèÜ ÊÅ≠ÂñúÊàê‰∏∫Â∞èÁ±≥È©¨ÊãâÊùæÂ§ßÂ∏àÔºÅ‰Ω†Â∞±ÊòØ‰º†ËØ¥‰∏≠ÁöÑÊàêÂäüËÄÖÔºÅ';
            if (resultType === 'caught') return 'üòÖ ËôΩÁÑ∂Ë¢´Êäì‰ΩÜËá≥Â∞ëÂ∞ùËØï‰∫ÜÔºÅÂãáÊ∞îÂèØÂòâÔºåÁªßÁª≠Âä™ÂäõÔºÅ';
            if (successRate >= 60) return 'üí™ ÊàêÂäüÁéáÂæàÈ´òÔºÅËøêÊ∞îÂ∑Æ‰∫ÜÁÇπÔºåÂÜçËØïËØïÂêßÔºÅ';
            if (successRate >= 40) return 'üìà ÊàêÂäüÁéá‰∏çÈîôÔºÅÂÜçË∞ÉÊï¥‰∏Ä‰∏ãÁ≠ñÁï•Â∞±ËÉΩÊàêÂäü‰∫ÜÔºÅ';
            return 'üí° ÊèêÁ§∫ÔºöÈÄâÊã©Êõ¥Â•ΩÁöÑË£ÖÂ§áÂíåËÆ≠ÁªÉÈÄâÈ°πËÉΩÂ§ßÂπÖÊèêÂçáÊàêÂäüÁéáÔºÅ';
        }

        function shareResult(resultType, successRate, gameTime, rating) {
            const resultEmojis = { 'success': 'üéâ', 'legendary': 'üëë', 'caught': 'üòÖ', 'failure': 'üò¢', 'death': 'üíÄ', 'mental_breakdown': 'ü§Ø' };
            const resultNames = { 'success': 'ÊàêÂäüÁªìÂ±Ä', 'legendary': '‰º†Â•áÁªìÂ±Ä', 'caught': 'Ë¢´ÊäìÁªìÂ±Ä', 'failure': 'Â§±Ë¥•ÁªìÂ±Ä', 'death': 'Ê≠ª‰∫°ÁªìÂ±Ä', 'mental_breakdown': 'Á≤æÁ•ûÂ¥©Ê∫ÉÁªìÂ±Ä' };
            const shareText = `üèÉ‚Äç‚ôÇÔ∏è ÊàëÂàö‰ΩìÈ™å‰∫Ü"Â∞èÁ±≥Â§áË∑ëÁΩë"BLËß£ÈîÅÊ®°ÊãüÂô®ÔºÅ\nËøôÊòØ‰∏Ä‰∏™Á∫ØÂ®±‰πêÁöÑÊñáÂ≠óÂÜíÈô©Ê∏∏Êàè\nÈÖ∑ÂÆâ @Ë¥ùÂà©‰∫öË∂ÖÁ∫ßÊó†ÊïåÂ§ßÁéã Âà∂‰ΩúÁöÑËôöÊûÑÊ∏∏Êàè‰ΩìÈ™å\n\n${resultEmojis[resultType]} ÁªìÂ±ÄÔºö${resultNames[resultType]}\nüìä ÊúÄÁªàÊàêÂäüÁéáÔºö${successRate}%\n‚è±Ô∏è Ê∏∏ÊàèÊó∂ÈïøÔºö${gameTime}Áßí\nüéØ ÁªºÂêàËØÑÁ∫ßÔºö${rating}\n‚ù§Ô∏è ÊúÄÁªàÂÅ•Â∫∑Ôºö${health}/100\nüß† Á≤æÁ•ûÁä∂ÊÄÅÔºö${mentalHealth}/100\n\n${successRate >= 50 ? 'ÊàëÂú®Ê∏∏Êàè‰∏≠ÊàêÂäüÁéáËøô‰πàÈ´òÔºÅ' : 'ËøôËôöÊûÑÊ∏∏ÊàèÁúüÁöÑÂ§™Èöæ‰∫Ü...'}\nÂà´Á¨ëÔºå‰Ω†Êù•‰πüÈÄö‰∏ç‰∫ÜÂÖ≥ÔºÅ\nÊ∏∏ÊàèÂú∞ÂùÄÔºö8805288.xyz`;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(shareText).then(() => alert('üéâ ÂàÜ‰∫´ÂÜÖÂÆπÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ')).catch(() => fallbackCopyTextToClipboard(shareText));
            } else {
                fallbackCopyTextToClipboard(shareText);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0"; textArea.style.left = "0"; textArea.style.position = "fixed"; textArea.style.opacity = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                alert('üéâ ÂàÜ‰∫´ÂÜÖÂÆπÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
            } catch (err) {
                alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂„ÄÇ');
            }
            document.body.removeChild(textArea);
        }

        function updateTimer() {
            if (gameStartTime > 0) {
                const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            setTimeout(updateTimer, 1000);
        }

        // --- Hidden Menu & Easter Eggs ---
        function logoClick() {
            logoClicks++;
            if (logoClicks >= 5) {
                document.getElementById('hiddenMenu').style.display = 'block';
                logoClicks = 0;
                alert('üïµÔ∏è ÈöêËóèËèúÂçïÂ∑≤ÊøÄÊ¥ªÔºÅ');
            }
        }

        function titleClick() {
            titleClicks++;
            if (titleClicks >= 3) {
                alert('üí° ÊèêÁ§∫ÔºöËØïËØïËøûÁª≠ÁÇπÂáª5Ê¨°logoÔºÅ');
                titleClicks = 0;
            }
        }

        function checkKonami(event) {
            konamiCode += event.key;
            if (konamiCode.includes('ArrowUpArrowUpArrowDownArrowDownArrowLeftArrowRightArrowLeftArrowRightba')) {
                document.getElementById('hiddenMenu').style.display = 'block';
                alert('üéÆ Áßë‰πêÁæéÁßòÁ±çÊøÄÊ¥ªÔºÅ');
                konamiCode = '';
            }
            if (konamiCode.length > 50) konamiCode = '';
        }

        function toggleGodMode() {
            godMode = !godMode;
            alert(godMode ? 'üòá ‰∏äÂ∏ùÊ®°ÂºèÂºÄÂêØÔºÅ' : 'üòà ‰∏äÂ∏ùÊ®°ÂºèÂÖ≥Èó≠ÔºÅ');
            updateStats();
        }

        function setMaxStats() {
            Object.keys(playerStats).forEach(key => playerStats[key] = 10);
            skillPoints += 20;
            alert('üí™ Â±ûÊÄßÂ∑≤ËÆæÁΩÆ‰∏∫ÊúÄÂ§ßÂÄºÔºÅÊäÄËÉΩÁÇπÊï∞+20ÔºÅ');
            updateStats();
        }

        function showAllEndings() {
            alert(`üéØ Ê∏∏ÊàèÁªìÂ±ÄÂèò‰Ωì‰ºóÂ§öÔºÅ\n\nÂü∫Á°ÄÁªìÂ±ÄÁ±ªÂûãÔºö\nüëë ‰º†Â•á, üéâ ÊàêÂäü, üòÖ Ë¢´Êäì, üò¢ Â§±Ë¥•, üíÄ Ê≠ª‰∫°, ü§Ø Á≤æÁ•ûÂ¥©Ê∫É\n\nÁâπÊÆäÂèò‰ΩìÔºàÂü∫‰∫éË°®Áé∞ÔºâÔºö\nüíé ÂÆåÁæéÊó†Áëï, üíÄ Ê≠ªÈáåÈÄÉÁîü, ü•∑ ÊöóÂΩ±Â§ßÂ∏à, üíª ÁΩëÁªúÂπΩÁÅµ, ‚ö° Èó™ÁîµË°åÂä®Á≠â„ÄÇ\n\nÂ∞ùËØï‰∏çÂêåÈÄâÊã©‰ª•Ëß£ÈîÅÔºÅ`);
        }

        function unlockAllAchievements() {
            achievementList.forEach(ach => unlockAchievement(ach.id));
            alert('üèÜ ÊâÄÊúâÊàêÂ∞±Â∑≤Ëß£ÈîÅÔºÅ');
        }

        function toggleDock() {
            const dock = document.getElementById('statsDock');
            const toggle = document.getElementById('dockToggle');
            const isHidden = dock.style.display === 'none';
            dock.style.display = isHidden ? 'block' : 'none';
            if (isHidden) {
                toggle.textContent = '√ó';
                toggle.style.backgroundColor = 'rgba(220, 53, 69, 0.9)';
            }
        }

        function showAbout() { 
            document.getElementById('aboutModal').style.display = 'block'; 
            // ÈòªÊ≠¢ËÉåÊôØÊªöÂä®
            document.body.style.overflow = 'hidden';
        }
        
        function closeAbout() { 
            document.getElementById('aboutModal').style.display = 'none'; 
            // ÊÅ¢Â§çËÉåÊôØÊªöÂä®
            document.body.style.overflow = 'auto';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('aboutModal');
            if (event.target === modal) {
                modal.style.display = 'none';
                // ÊÅ¢Â§çËÉåÊôØÊªöÂä®
                document.body.style.overflow = 'auto';
            }
        }

        // --- Initial Setup ---
        updateTimer();
        document.getElementById('konamiInput').focus();
    </script>
</body>
</html>
