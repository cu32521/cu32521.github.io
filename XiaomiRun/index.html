<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç±³å¤‡è·‘ç½‘ - BLè§£é”æ¨¡æ‹Ÿå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        /* æ³•å¾‹å£°æ˜å¼¹çª—æ ·å¼ */
        .legal-modal {
            display: flex;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
        }

        .legal-content {
            background-color: #ffffff;
            margin: 5% auto;
            padding: 30px;
            border: none;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.5s ease;
            position: relative;
        }

        .legal-header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 3px solid #dc3545;
            padding-bottom: 15px;
        }

        .legal-title {
            font-size: 1.8em;
            color: #dc3545;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .legal-subtitle {
            color: #666;
            font-size: 1em;
        }

        .legal-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }

        .legal-section h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .legal-section p, .legal-section li {
            color: #555;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .legal-section ul {
            margin-left: 20px;
        }

        .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #856404;
        }

        .warning-box h3 {
            color: #856404;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3em;
        }

        .contact-box {
            background: #e7f3ff;
            border: 2px solid #007bff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #004085;
            text-align: center;
        }

        .contact-box h3 {
            color: #004085;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .contact-email {
            font-family: monospace;
            background: rgba(0, 123, 255, 0.1);
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: bold;
            margin: 5px 0;
            display: inline-block;
        }

        .legal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .legal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .accept-btn {
            background: #28a745;
            color: white;
        }

        .accept-btn:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }

        .reject-btn {
            background: #dc3545;
            color: white;
        }

        .reject-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .game-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            min-height: 100vh;
            padding-bottom: 120px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #ff6b6b;
            padding-bottom: 20px;
            position: relative;
        }

        .about-btn {
            background: #17a2b8;
            border: 2px solid #138496;
            border-radius: 20px;
            padding: 8px 15px;
            color: white;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            position: absolute;
            top: 0;
            right: 0;
        }

        .about-btn:hover {
            background: #138496;
            transform: translateY(-1px);
        }

        .logo {
            font-size: 4em;
            margin-bottom: 10px;
            cursor: pointer;
            transition: transform 0.3s ease;
            display: inline-block;
        }

        .logo:hover {
            transform: rotate(10deg) scale(1.1);
        }

        .title {
            font-size: 3em;
            color: #ff6b6b;
            margin-bottom: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
            font-weight: bold;
            text-align: center;
        }

        .game-area {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 25px;
            min-height: 400px;
            overflow-y: auto;
            width: 100%;
        }

        .story-text {
            font-size: 1.3em;
            line-height: 1.8;
            color: #333;
            margin-bottom: 30px;
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }

        .choice-btn {
            background: #007bff;
            border: 2px solid #0056b3;
            border-radius: 8px;
            padding: 15px 20px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            font-weight: 500;
        }

        .choice-btn:hover:not(:disabled) {
            background: #0056b3;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .choice-btn:disabled {
            background-color: #6c757d;
            border-color: #5a6268;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .choice-btn.danger {
            background: #dc3545;
            border-color: #c82333;
        }

        .choice-btn.danger:hover:not(:disabled) {
            background: #c82333;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .choice-btn.neutral {
            background: #ffc107;
            border-color: #e0a800;
            color: #000;
        }

        .choice-btn.neutral:hover:not(:disabled) {
            background: #e0a800;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .choice-btn.special {
            background: #6f42c1;
            border-color: #5a32a3;
            position: relative;
            font-weight: bold;
        }

        .choice-btn.special:hover:not(:disabled) {
            background: #5a32a3;
            box-shadow: 0 4px 12px rgba(111, 66, 193, 0.3);
        }

        .choice-btn.special::before {
            content: 'âœ¨';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .choice-btn.deadly {
            background: #6c1e2b;
            border-color: #4a1419;
            position: relative;
            animation: pulse 2s infinite;
        }

        .choice-btn.deadly::before {
            content: 'ğŸ’€';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(108, 30, 43, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(108, 30, 43, 0); }
            100% { box-shadow: 0 0 0 0 rgba(108, 30, 43, 0); }
        }

        .start-btn {
            background: #28a745;
            border: 2px solid #1e7e34;
            border-radius: 50px;
            padding: 20px 40px;
            color: white;
            font-size: 1.4em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            display: block;
            margin: 30px auto;
        }

        .start-btn:hover {
            background: #1e7e34;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        }

        /* ç´§å‡‘æ‚¬æµ®çŠ¶æ€æ  */
        .stats-dock {
            position: fixed;
            bottom: 15px;
            right: 15px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            display: none;
            animation: slideIn 0.3s ease-out;
            transition: all 0.2s ease;
            color: white;
            font-size: 0.85em;
            min-width: 200px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stats-dock:hover {
            background: rgba(0, 0, 0, 0.95);
            transform: scale(1.02);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .dock-content {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .dock-toggle {
            position: absolute;
            top: -8px;
            right: -8px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7em;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dock-toggle:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
        }

        .stat-section {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 0;
        }

        .stat-label {
            font-size: 0.75em;
            font-weight: bold;
            min-width: 35px;
            color: rgba(255, 255, 255, 0.9);
        }

        .stat-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            height: 8px;
            width: 60px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 6px;
        }

        .stat-text {
            font-size: 0.7em;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            min-width: 25px;
            text-align: right;
        }

        .random-event {
            background: #e7f3ff;
            border: 2px solid #007bff;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            animation: eventPop 0.5s ease-out;
        }

        @keyframes eventPop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .minigame-container {
            background: #fff3cd;
            border: 3px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }

        .reaction-game {
            margin: 20px 0;
        }

        .reaction-btn {
            background: #dc3545;
            border: none;
            border-radius: 50%;
            width: 100px;
            height: 100px;
            color: white;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .reaction-btn.active {
            background: #28a745;
            animation: bounce 0.3s ease;
        }
        
        .reaction-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
            opacity: 0.7;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            80% { transform: translateY(-10px); }
        }

        .skill-points-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }

        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 2000;
            animation: achievementSlide 3s ease-out forwards;
            border: 2px solid #1e7e34;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        @keyframes achievementSlide {
            0% { transform: translateX(100%); opacity: 0; }
            10%, 90% { transform: translateX(0); opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }

        .inventory {
            background: #ffffff;
            border: 2px solid #6c757d;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .inventory-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #6c757d;
            text-align: center;
        }

        .inventory-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .inventory-item {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .inventory-item.rare {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .inventory-item.legendary {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }

        .result {
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.4em;
            font-weight: bold;
            text-align: center;
            border: 3px solid;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border-color: #28a745;
        }

        .result.failure {
            background: #f8d7da;
            color: #721c24;
            border-color: #dc3545;
        }

        .result.caught {
            background: #fff3cd;
            color: #856404;
            border-color: #ffc107;
        }

        .result.death {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #17a2b8;
        }

        .result.legendary {
            background: #fff3cd;
            color: #856404;
            border-color: #ffc107;
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.5);
        }

        .reset-btn {
            background: #6c757d;
            border: 1px solid #5a6268;
            border-radius: 20px;
            padding: 10px 20px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.2s ease;
        }

        .reset-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .share-btn {
            background: #1da1f2;
            border: 1px solid #1991db;
            border-radius: 20px;
            padding: 10px 20px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.2s ease;
        }

        .share-btn:hover {
            background: #1991db;
            transform: translateY(-1px);
        }

        .revoke-btn {
            background: #dc3545;
            border: 1px solid #c82333;
            border-radius: 20px;
            padding: 10px 20px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.2s ease;
        }

        .revoke-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .hidden-menu {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #343a40;
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
            display: none;
            z-index: 1000;
            border: 2px solid #6c757d;
        }

        .timer {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(52, 58, 64, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.1em;
            border: 2px solid #6c757d;
            backdrop-filter: blur(10px);
            z-index: 1001;
        }

        .final-escape-area {
            background: #ffe6e6;
            border: 3px solid #ff4444;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
        }

        .danger-indicator {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #ff4444;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .konami-input {
            position: fixed;
            top: -100px;
            left: -100px;
            opacity: 0;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: none;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s ease;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 15px;
            right: 20px;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .close:hover,
        .close:focus {
            color: #dc3545;
        }

        .modal h2 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
        }

        .author-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .author-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .author-link {
            color: #fff3cd;
            text-decoration: none;
            font-weight: 500;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            transition: all 0.2s ease;
        }

        .author-link:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .disclaimer {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #856404;
            line-height: 1.6;
        }

        .disclaimer h3 {
            color: #856404;
            margin-bottom: 15px;
            text-align: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from { 
                opacity: 0;
                transform: translateY(-50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .legal-content {
                width: 95%;
                padding: 20px;
                margin: 2% auto;
            }

            .legal-buttons {
                flex-direction: column;
                align-items: center;
            }

            .legal-btn {
                width: 80%;
                max-width: 200px;
            }

            .game-container {
                padding: 15px;
                padding-bottom: 120px;
            }
            
            .title {
                font-size: 2.2em;
            }
            
            .story-text {
                font-size: 1.1em;
                padding: 20px;
            }

            .dock-content {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .stat-section {
                width: 100%;
                justify-content: center;
            }

            .stats-dock {
                padding: 8px 12px;
            }

            .modal-content {
                margin: 10% auto;
                padding: 20px;
                width: 90%;
                max-height: 85vh;
            }
            
            .about-btn {
                font-size: 0.8em;
                padding: 6px 12px;
            }
        }

        @media (max-width: 480px) {
            .game-container {
                padding-bottom: 100px;
            }

            .stats-dock {
                padding: 6px 10px;
            }

            .stat-bar {
                width: 60px;
                height: 10px;
            }

            .stat-section {
                padding: 6px 8px;
                gap: 6px;
            }
        }

    </style>
</head>
<body>
    <!-- æ³•å¾‹å£°æ˜å¼¹çª— -->
    <div id="legalModal" class="legal-modal">
        <div class="legal-content">
            <div class="legal-header">
                <div class="legal-title">âš–ï¸ æ³•å¾‹å£°æ˜ä¸ç”¨æˆ·åè®®</div>
                <div class="legal-subtitle">è¯·ä»”ç»†é˜…è¯»ä»¥ä¸‹æ¡æ¬¾</div>
            </div>

            <div class="warning-box">
                <h3>ğŸš¨ é‡è¦æé†’</h3>
                <p><strong>æœ¬ç½‘ç«™æ˜¯çº¯å¨±ä¹æ€§è´¨çš„æ–‡å­—å†’é™©æ¸¸æˆï¼Œæ‰€æœ‰å†…å®¹å‡ä¸ºè™šæ„ï¼Œä¸ä»»ä½•çœŸå®å“ç‰Œã€çœŸå®è§£é”æ–¹æ³•æ— å…³ã€‚</strong></p>
            </div>

            <div class="legal-section">
                <h3>ğŸ“‹ ç½‘ç«™æ€§è´¨å£°æ˜</h3>
                <ul>
                    <li><strong>çº¯å¨±ä¹æ¸¸æˆï¼š</strong>æœ¬ç½‘ç«™æä¾›çš„æ˜¯æ–‡å­—å†’é™©æ¸¸æˆï¼Œä¸åŒ…å«ä»»ä½•çœŸå®çš„æŠ€æœ¯æŒ‡å¯¼æˆ–ç ´è§£å·¥å…·</li>
                    <li><strong>å†…å®¹ï¼š</strong>æ‰€æœ‰æ¸¸æˆæƒ…èŠ‚ã€å“ç‰Œåç§°ã€æ“ä½œæµç¨‹å‡ä¸ºè™šæ„ï¼Œå¦‚æœ‰é›·åŒçº¯å±å·§åˆ</li>
                    <li><strong>æ— å®é™…åŠŸèƒ½ï¼š</strong>æœ¬æ¸¸æˆä¸èƒ½çœŸæ­£è§£é”ä»»ä½•è®¾å¤‡ï¼Œä¸æä¾›ä»»ä½•ç ´è§£æœåŠ¡</li>
                </ul>
            </div>

            <div class="legal-section">
                <h3>âš–ï¸ æ³•å¾‹åˆè§„æ‰¿è¯º</h3>
                <ul>
                    <li><strong>éµå®ˆæ³•å¾‹ï¼š</strong>æœ¬ç½‘ç«™ä¸¥æ ¼éµå®ˆã€Šä¸­åäººæ°‘å…±å’Œå›½ç½‘ç»œå®‰å…¨æ³•ã€‹ç­‰ç›¸å…³æ³•å¾‹æ³•è§„</li>
                    <li><strong>ä¸é¼“åŠ±è¿æ³•ï¼š</strong>æˆ‘ä»¬æ˜ç¡®åå¯¹ä»»ä½•å½¢å¼çš„è®¾å¤‡ç ´è§£ã€éæ³•ä¾µå…¥ç­‰è¿æ³•è¡Œä¸º</li>
                    <li><strong>æ•™è‚²æ„ä¹‰ï¼š</strong>æ¸¸æˆæ—¨åœ¨é€šè¿‡å¨±ä¹å½¢å¼æé†’ç”¨æˆ·æ³¨æ„è®¾å¤‡å®‰å…¨</li>
                    <li><strong>æ­£å½“é€”å¾„ï¼š</strong>æˆ‘ä»¬å»ºè®®ç”¨æˆ·é€šè¿‡å®˜æ–¹æ­£å½“æ¸ é“å¤„ç†è®¾å¤‡é—®é¢˜</li>
                </ul>
            </div>

            <div class="legal-section">
                <h3>ğŸ” å¹´é¾„ä¸ä½¿ç”¨é™åˆ¶</h3>
                <ul>
                    <li><strong>å¹´é¾„è¦æ±‚ï¼š</strong>å»ºè®®18å²ä»¥ä¸Šç”¨æˆ·ä½¿ç”¨ï¼Œæœªæˆå¹´äººéœ€åœ¨ç›‘æŠ¤äººæŒ‡å¯¼ä¸‹ä½¿ç”¨</li>
                    <li><strong>ç†æ€§å¨±ä¹ï¼š</strong>è¯·ç†æ€§å¯¹å¾…æ¸¸æˆå†…å®¹ï¼Œä¸è¦å°†è™šæ„æƒ…èŠ‚ä¸ç°å®æ··æ·†</li>
                    <li><strong>æ—¶é—´æ§åˆ¶ï¼š</strong>è¯·åˆç†å®‰æ’æ¸¸æˆæ—¶é—´ï¼Œé¿å…æ²‰è¿·</li>
                </ul>
            </div>

            <div class="legal-section">
                <h3>ğŸ›¡ï¸ å…è´£å£°æ˜</h3>
                <ul>
                    <li><strong>å†…å®¹å…è´£ï¼š</strong>æ¸¸æˆå†…å®¹ä»…ä¾›å¨±ä¹ï¼Œå¼€å‘è€…ä¸å¯¹ä»»ä½•åŸºäºæ¸¸æˆå†…å®¹çš„è¡Œä¸ºæ‰¿æ‹…è´£ä»»</li>
                    <li><strong>æŸå¤±å…è´£ï¼š</strong>ç”¨æˆ·å› ä½¿ç”¨æœ¬ç½‘ç«™æˆ–åŸºäºç½‘ç«™å†…å®¹é‡‡å–è¡ŒåŠ¨è€Œäº§ç”Ÿçš„ä»»ä½•æŸå¤±ï¼Œå¼€å‘è€…æ¦‚ä¸è´Ÿè´£</li>
                    <li><strong>ç¬¬ä¸‰æ–¹å…è´£ï¼š</strong>æœ¬ç½‘ç«™ä¸å¯¹ç¬¬ä¸‰æ–¹ç½‘ç«™æˆ–æœåŠ¡æ‰¿æ‹…ä»»ä½•è´£ä»»</li>
                </ul>
            </div>

            <div class="legal-section">
                <h3>ğŸ¤ ç”¨æˆ·è´£ä»»</h3>
                <ul>
                    <li><strong>åˆæ³•ä½¿ç”¨ï¼š</strong>ç”¨æˆ·æ‰¿è¯ºä»…å°†æœ¬ç½‘ç«™ç”¨äºåˆæ³•çš„å¨±ä¹ç›®çš„</li>
                    <li><strong>ä¸å¾—æ¨¡ä»¿ï¼š</strong>ä¸¥ç¦æ¨¡ä»¿æ¸¸æˆä¸­çš„ä»»ä½•è™šæ„è¡Œä¸º</li>
                    <li><strong>å°Šé‡ä»–äººï¼š</strong>å°Šé‡æŠ€æœ¯äººå‘˜å’ŒæœåŠ¡äººå‘˜ï¼Œç»´æŠ¤è‰¯å¥½ç¤¾ä¼šç§©åº</li>
                    <li><strong>ç†æ€§åˆ†äº«ï¼š</strong>åˆ†äº«æ¸¸æˆæ—¶è¯·æ³¨æ˜è™šæ„æ€§è´¨ï¼Œé¿å…è¯¯å¯¼ä»–äºº</li>
                </ul>
            </div>

            <div class="contact-box">
                <h3>ğŸ“§ è”ç³»æ–¹å¼</h3>
                <p>å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼š</p>
                <div class="contact-email">CLeanZeroFeedBack@Gmail.com</div>
                <p style="font-size: 0.9em; margin-top: 10px; color: #666;">
                    æˆ‘ä»¬ä¼šè®¤çœŸå¯¹å¾…æ¯ä¸€ä¸ªåé¦ˆï¼Œä½†è¯·ç†è§£æˆ‘åªæ˜¯å­¦ç”Ÿï¼Œæ— ç‰¹æ®Šæƒ…å†µè¯·å‹¿æ‰“æ‰°
                </p>
            </div>

            <div class="legal-buttons">
                <button class="legal-btn accept-btn" onclick="acceptTerms()">
                    âœ… æˆ‘å·²é˜…è¯»å¹¶åŒæ„
                </button>
                <button class="legal-btn reject-btn" onclick="rejectTerms()">
                    âŒ æˆ‘ä¸åŒæ„
                </button>
            </div>
        </div>
    </div>

    <div class="game-container" id="gameContainer" style="display: none;">
        <div class="timer" id="timer">00:00</div>
        <div class="hidden-menu" id="hiddenMenu">
            <div style="margin-bottom: 10px; font-weight: bold;">ğŸ•µï¸ éšè—èœå•</div>
            <button onclick="toggleGodMode()" style="margin: 5px; padding: 8px; border-radius: 4px; border: none; background: #28a745; color: white; cursor: pointer;">ä¸Šå¸æ¨¡å¼</button><br>
            <button onclick="setMaxStats()" style="margin: 5px; padding: 8px; border-radius: 4px; border: none; background: #ffc107; color: black; cursor: pointer;">æ»¡å±æ€§</button><br>
            <button onclick="showAllEndings()" style="margin: 5px; padding: 8px; border-radius: 4px; border: none; background: #6f42c1; color: white; cursor: pointer;">æŸ¥çœ‹ç»“å±€</button><br>
            <button onclick="unlockAllAchievements()" style="margin: 5px; padding: 8px; border-radius: 4px; border: none; background: #fd7e14; color: white; cursor: pointer;">è§£é”æˆå°±</button>
        </div>

        <div class="header">
            <button class="about-btn" onclick="showAbout()">â“ å…³äº</button>
            <div class="logo" onclick="logoClick()">ğŸƒâ€â™‚ï¸ğŸ“±</div>
            <h1 class="title" onclick="titleClick()">å°ç±³å¤‡è·‘ç½‘</h1>
            <p class="subtitle">ç¬¬ä¸€å±Šå°ç±³é©¬æ‹‰æ¾ - BLè§£é”æ¨¡æ‹Ÿå™¨</p>
        </div>

        <div class="warning">
            âš ï¸ æœ¬æ¸¸æˆçº¯å±è™šæ„å¨±ä¹ï¼Œä¸¥ç¦ç°å®æ¨¡ä»¿ | ğŸ® è™šæ„å“ç‰Œï¼Œè™šæ„æƒ…èŠ‚
        </div>

        <div id="mainContent">
            <div class="game-area" id="gameArea">
                <div class="story-text">
                    æ¬¢è¿æ¥åˆ°å°ç±³å¤‡è·‘ç½‘ï¼ä½ å³å°†ä½“éªŒæœ€å…·æŒ‘æˆ˜æ€§çš„è™šæ„BLè§£é”å†’é™©æ¸¸æˆã€‚
                    <br><br>
                    ä½œä¸ºä¸€åè™šæ„ä¸–ç•Œçš„æ•°ç çˆ±å¥½è€…ï¼Œä½ å·²ç»åŒå€¦äº†è¢«ç³»ç»Ÿé™åˆ¶ã€‚å®˜æ–¹è§£é”æ¸ é“å‡ ä¹ä¸å¯èƒ½é€šè¿‡ï¼Œåœ¨è¿™ä¸ªè™šæ„çš„æ•…äº‹ä¸­ï¼Œä½ å†³å®š...å°è¯•ä¸€äº›åˆ›æ„æ–¹æ³•ã€‚
                    <br><br>
                    âš¡ <strong>æ¸¸æˆç‰¹æ€§ï¼š</strong><br>
                    ğŸ² éšæœºäº‹ä»¶ç³»ç»Ÿ - æ¯æ­¥éƒ½å¯èƒ½é‡åˆ°æ„å¤–ï¼<br>
                    ğŸ¯ ååº”å°æ¸¸æˆ - è€ƒéªŒä½ çš„æ“ä½œæŠ€å·§ï¼<br>
                    ğŸ† æˆå°±ç³»ç»Ÿ - è§£é”å„ç§ç§°å·ï¼<br>
                    âš”ï¸ æŠ€èƒ½ç‚¹æ•° - å½±å“ä½ çš„èƒ½åŠ›ï¼<br>
                    ğŸ’€ æŒ‘æˆ˜æ¨¡å¼ - é«˜éš¾åº¦å…³å¡ï¼
                    <br><br>
                    <div style="background: #e7f3ff; border: 2px solid #007bff; border-radius: 8px; padding: 15px; margin: 15px 0; font-size: 0.9em;">
                        <strong>ğŸ”” å†æ¬¡æé†’ï¼š</strong>è¿™æ˜¯å®Œå…¨è™šæ„çš„æ–‡å­—å†’é™©æ¸¸æˆï¼æ‰€æœ‰å†…å®¹å‡ä¸ºå¨±ä¹ç›®çš„ï¼Œä¸ç°å®æ— å…³ã€‚
                        è¯·é€šè¿‡å®˜æ–¹æ­£å½“æ¸ é“å¤„ç†çœŸå®è®¾å¤‡é—®é¢˜ã€‚å°Šé‡æŠ€æœ¯äººå‘˜ï¼Œç»´æŠ¤è‰¯å¥½ç¤¾ä¼šç¯å¢ƒï¼
                    </div>
                    ä½ å‡†å¤‡å¥½å¼€å§‹è¿™åœºè™šæ„çš„å†’é™©äº†å—ï¼Ÿ
                </div>
                
                <button class="start-btn" onclick="startGame()">ğŸš€ å¼€å§‹è™šæ„å†’é™©</button>
            </div>
            
            <!-- ç‰©å“æ  -->
            <div class="inventory" id="inventoryPanel" style="display: none;">
                <div class="inventory-title">ğŸ“¦ ç‰©å“æ </div>
                <div class="inventory-items" id="inventoryItems"></div>
            </div>

            <!-- æŠ€èƒ½ç‚¹æ•°æ˜¾ç¤º -->
            <div class="skill-points-display" id="skillPointsDisplay" style="display: none;">
                ğŸŒŸ æŠ€èƒ½ç‚¹æ•°: <span id="skillPointsText">0</span> | å®åŠ›: <span id="powerLevelText">æ–°æ‰‹</span>
            </div>
        </div>

        <input type="text" class="konami-input" id="konamiInput" onkeyup="checkKonami(event)">
    </div>

    <!-- å…³äºæ¨¡æ€æ¡† -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAbout()">&times;</span>
            <h2>ğŸƒâ€â™‚ï¸ å…³äºå°ç±³å¤‡è·‘ç½‘</h2>
            
            <div class="author-info">
                <div class="author-name">ğŸ‘‘ è´åˆ©äºšè¶…çº§æ— æ•Œå¤§ç‹</div>
                <a href="http://www.coolapk.com/u/31876429" target="_blank" class="author-link">
                    ğŸ“± è®¿é—®é…·å®‰ä¸»é¡µ
                </a>
            </div>

            <div class="contact-box">
                <h3>ğŸ“§ è”ç³»æ–¹å¼</h3>
                <p>æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Ÿæ¬¢è¿è”ç³»æˆ‘ä»¬ï¼š</p>
                <div class="contact-email">CLeanZeroFeedBack@Gmail.com</div>
                <p style="font-size: 0.9em; margin-top: 10px;">
                    æˆ‘ä»¬ä¼šè®¤çœŸå¯¹å¾…æ¯ä¸€ä¸ªåé¦ˆï¼Œä½†è¯·ç†è§£æˆ‘åªæ˜¯å­¦ç”Ÿï¼Œæ— ç‰¹æ®Šæƒ…å†µè¯·å‹¿æ‰“æ‰°
                </p>
            </div>

            <div class="disclaimer">
                <h3>âš ï¸ é‡è¦å£°æ˜</h3>
                <p><strong>æœ¬é¡¹ç›®æ˜¯çº¯å¨±ä¹æ€§è´¨çš„æ–‡å­—å†’é™©æ¸¸æˆï¼Œä»…ä¾›å¨±ä¹å’Œå­¦ä¹ äº¤æµä½¿ç”¨ã€‚</strong></p>
                <p><strong>æ‰€æœ‰æ¸¸æˆå†…å®¹å®Œå…¨è™šæ„ï¼Œæ‰€æœ‰å“ç‰Œåç§°ã€æ“ä½œæµç¨‹å‡ä¸ºè™šæ„è®¾å®šã€‚</strong></p>
                <p><strong>æ¸¸æˆä¸æä¾›ä»»ä½•çœŸå®çš„æŠ€æœ¯æŒ‡å¯¼ï¼Œä¸åŒ…å«ä»»ä½•ç ´è§£å·¥å…·æˆ–æ–¹æ³•ã€‚</strong></p>
                <br>
                <p>ğŸ¤ <strong>è¯·ç†æ€§å¯¹å¾…è®¾å¤‡è§£é”ï¼Œé€šè¿‡å®˜æ–¹æ­£å½“æ¸ é“è§£å†³é—®é¢˜ï¼Œå°Šé‡æŠ€æœ¯äººå‘˜ï¼</strong></p>
                <p>âš–ï¸ <strong>ä¸¥æ ¼éµå®ˆæ³•å¾‹æ³•è§„ï¼Œä¸ä»äº‹ä»»ä½•è¿æ³•è¿è§„è¡Œä¸ºï¼</strong></p>
                <br>
                <p style="text-align: center; font-size: 0.9em; color: #666;">
                    ğŸ“§ ä½œè€…åªæ˜¯ä¸€ä¸ªä¸­å­¦ç”Ÿï¼Œè¿˜æ˜¯æœªæˆå¹´ï¼Œæ— ç‰¹æ®Šæƒ…å†µè¯·å‹¿æ‰“æ‰°ï¼Œè°¢è°¢æ‚¨<br>
                    ğŸ’¡ çœŸæ­£çš„æŠ€æœ¯å­¦ä¹ åº”è¯¥é€šè¿‡æ­£å½“æ¸ é“å’Œå®˜æ–¹æ–‡æ¡£è¿›è¡Œ<br>
                    ğŸŒŸ æ„Ÿè°¢æ‰€æœ‰ä¸ºå¼€æºç¤¾åŒºè´¡çŒ®çš„å¼€å‘è€…ä»¬<br>
                    ğŸ® äº«å—æ¸¸æˆçš„åŒæ—¶è¯·ç‰¢è®°ï¼šè™šæ„å¨±ä¹ï¼Œç°å®å®ˆæ³•
                </p>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="reset-btn" onclick="closeAbout()">ğŸ”™ è¿”å›æ¸¸æˆ</button>
                <button class="revoke-btn" onclick="revokeConsent()">ğŸ—‘ï¸ æ’¤é”€å£°æ˜åŒæ„</button>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨Dockæ  -->
    <div class="stats-dock" id="statsDock">
        <div class="dock-content">
            <button class="dock-toggle" id="dockToggle" onclick="toggleDock()">âŒ„</button>
            
            <div class="stat-section">
                <div class="stat-label" style="color: #dc3545;">â¤ï¸ å¥åº·</div>
                <div class="stat-bar">
                    <div class="stat-fill" id="healthFill"></div>
                </div>
                <div class="stat-text" id="healthText">100</div>
            </div>

            <div class="stat-section">
                <div class="stat-label" style="color: #007bff;">ğŸ›¡ï¸ ç²¾ç¥</div>
                <div class="stat-bar">
                    <div class="stat-fill" id="mentalFill"></div>
                </div>
                <div class="stat-text" id="mentalText">100</div>
            </div>

            <div class="stat-section">
                <div class="stat-label" style="color: #28a745;">ğŸ¯ æˆåŠŸç‡</div>
                <div class="stat-text" id="successRateText" style="font-weight: bold; font-size: 0.9em;">5%</div>
            </div>
        </div>
    </div>

    <script>
        // --- Game State Variables ---
        let currentStep = 0;
        let successRate = 5;
        let health = 100;
        let mentalHealth = 100;
        let skillPoints = 0;
        let gameStartTime = 0;
        let godMode = false;
        let logoClicks = 0;
        let titleClicks = 0;
        let konamiCode = '';
        let inventory = [];
        let achievements = [];
        let randomEventCount = 0;
        let playerStats = {};
        let flags = {};

        // --- Control Flags ---
        let isProcessing = false;
        let justHadRandomEvent = false;

        // æ£€æŸ¥localStorageæ˜¯å¦å¯ç”¨
        function isLocalStorageAvailable() {
            try {
                return typeof(Storage) !== "undefined" && window.localStorage !== null;
            } catch (e) {
                return false;
            }
        }

        // å®‰å…¨çš„localStorageæ“ä½œ
        function safeSetItem(key, value) {
            if (isLocalStorageAvailable()) {
                try {
                    localStorage.setItem(key, value);
                    return true;
                } catch (e) {
                    console.log('localStorageå†™å…¥å¤±è´¥:', e);
                    return false;
                }
            }
            return false;
        }

        function safeGetItem(key) {
            if (isLocalStorageAvailable()) {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    console.log('localStorageè¯»å–å¤±è´¥:', e);
                    return null;
                }
            }
            return null;
        }

        function safeRemoveItem(key) {
            if (isLocalStorageAvailable()) {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (e) {
                    console.log('localStorageåˆ é™¤å¤±è´¥:', e);
                    return false;
                }
            }
            return false;
        }
        // --- Legal Modal Functions ---
        function acceptTerms() {
            document.getElementById('legalModal').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            // å°è¯•è®¾ç½®ç”¨æˆ·å·²åŒæ„çš„æ ‡è®°
            if (!safeSetItem('termsAccepted', 'true')) {
                console.log('æ³¨æ„ï¼šæ— æ³•ä¿å­˜åŒæ„çŠ¶æ€ï¼Œä¸‹æ¬¡è®¿é—®æ—¶å°†é‡æ–°æ˜¾ç¤ºå£°æ˜');
            }
        }

        function rejectTerms() {
            alert('æ„Ÿè°¢æ‚¨çš„å…³æ³¨ï¼å¦‚æœæ‚¨æ”¹å˜ä¸»æ„ï¼Œéšæ—¶å¯ä»¥é‡æ–°è®¿é—®ã€‚');
            window.close(); // å°è¯•å…³é—­çª—å£
            // å¦‚æœæ— æ³•å…³é—­çª—å£ï¼Œé‡å®šå‘åˆ°å…¶ä»–é¡µé¢
            setTimeout(() => {
                window.location.href = 'about:blank';
            }, 1000);
        }

        function revokeConsent() {
            console.log('æ’¤é”€å‡½æ•°è¢«è°ƒç”¨äº†'); // è°ƒè¯•ä¿¡æ¯
            
            try {
                if (!isLocalStorageAvailable()) {
                    alert('âš ï¸ å½“å‰ç¯å¢ƒä¸æ”¯æŒæ•°æ®å­˜å‚¨åŠŸèƒ½\n\næ¯æ¬¡è®¿é—®éƒ½ä¼šæ˜¾ç¤ºæ³•å¾‹å£°æ˜ï¼Œæ— éœ€æ’¤é”€ã€‚');
                    return;
                }

                if (confirm('ç¡®å®šè¦æ’¤é”€å¯¹æ³•å¾‹å£°æ˜çš„åŒæ„å—ï¼Ÿ\n\næ’¤é”€åä¸‹æ¬¡è®¿é—®ç½‘ç«™å°†éœ€è¦é‡æ–°åŒæ„å£°æ˜ã€‚')) {
                    // ç§»é™¤æœ¬åœ°å­˜å‚¨
                    if (safeRemoveItem('termsAccepted')) {
                        alert('âœ… å·²æˆåŠŸæ’¤é”€åŒæ„ï¼\n\nä¸‹æ¬¡è®¿é—®ç½‘ç«™æ—¶å°†é‡æ–°æ˜¾ç¤ºæ³•å¾‹å£°æ˜ã€‚');
                    } else {
                        alert('âš ï¸ æ’¤é”€æ“ä½œå®Œæˆï¼Œä½†å¯èƒ½æ— æ³•ä¿å­˜çŠ¶æ€\n\nå¦‚æœæ‚¨åœ¨éšç§æ¨¡å¼ä¸‹æµè§ˆï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šé‡æ–°æ˜¾ç¤ºå£°æ˜ã€‚');
                    }
                    
                    // å…³é—­å…³äºé¡µé¢
                    closeAbout();
                    
                    console.log('æ’¤é”€æˆåŠŸå®Œæˆ'); // è°ƒè¯•ä¿¡æ¯
                } else {
                    console.log('ç”¨æˆ·å–æ¶ˆäº†æ’¤é”€æ“ä½œ'); // è°ƒè¯•ä¿¡æ¯
                }
            } catch (error) {
                console.error('æ’¤é”€è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:', error);
                alert('âŒ æ’¤é”€è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚\n\né”™è¯¯ä¿¡æ¯ï¼š' + error.message);
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦å·²ç»åŒæ„æ¡æ¬¾
        window.addEventListener('load', function() {
            const termsAccepted = safeGetItem('termsAccepted');
            
            if (termsAccepted === 'true') {
                // ç”¨æˆ·ä¹‹å‰å·²ç»åŒæ„ï¼Œç›´æ¥è¿›å…¥æ¸¸æˆ
                document.getElementById('legalModal').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'block';
            } else {
                // é¦–æ¬¡è®¿é—®æˆ–localStorageä¸å¯ç”¨ï¼Œæ˜¾ç¤ºå®Œæ•´å£°æ˜
                document.getElementById('legalModal').style.display = 'flex';
            }
            
            // å¦‚æœlocalStorageä¸å¯ç”¨ï¼Œåœ¨æ§åˆ¶å°æç¤º
            if (!isLocalStorageAvailable()) {
                console.log('æ³¨æ„ï¼šlocalStorageä¸å¯ç”¨ï¼Œæ¯æ¬¡è®¿é—®éƒ½å°†æ˜¾ç¤ºæ³•å¾‹å£°æ˜');
            }
        });

        // --- Game Data ---
        const randomEvents = [
            { text: 'ğŸ’¥ çªç„¶ä¸‹é›¨ï¼Œåœ°é¢æ¹¿æ»‘ï¼', effect: { successRate: -10, health: -8, mentalHealth: -5 } },
            { text: 'ğŸš¨ å·§é‡å·¡é€»äººå‘˜ï¼', effect: { successRate: -15, health: -12, mentalHealth: -15 } },
            { text: 'ğŸ€ é‡åˆ°å¥½å¿ƒäººæŒ‡è·¯ï¼', effect: { successRate: 8, mentalHealth: 5 } },
            { text: 'âš¡ çªç„¶åœç”µï¼Œç›‘æ§å¤±æ•ˆï¼', effect: { successRate: 15, skillPoints: 1 } },
            { text: 'ğŸ˜µ è‚šå­ç–¼ï¼ŒçŠ¶æ€ä¸ä½³ï¼', effect: { health: -20, mentalHealth: -10 } },
            { text: 'ğŸ‰ å·¥ç¨‹å¸ˆå¿ƒæƒ…å¾ˆå¥½ï¼', effect: { successRate: 12, mentalHealth: 8 } },
            { text: 'ğŸ• é‡ç‹—è¿½èµ¶ï¼Œæ¶ˆè€—ä½“åŠ›ï¼', effect: { health: -25, mentalHealth: -8 } },
            { text: 'ğŸ“± è®¾å¤‡çªç„¶å¡æœºï¼', effect: { successRate: -12, mentalHealth: -10 } },
            { text: 'ğŸŒŸ å¹¸è¿å¥³ç¥çœ·é¡¾ï¼', effect: { successRate: 18, luck: 1, skillPoints: 2 } },
            { text: 'ğŸš— äº¤é€šå µå¡å»¶è¯¯ï¼', effect: { successRate: -8, health: -5, mentalHealth: -12 } },
            { text: 'â˜• å–äº†è¿‡æœŸå’–å•¡ï¼Œèº«ä½“ä¸é€‚ï¼', effect: { health: -30, mentalHealth: -15, successRate: -15 } },
            { text: 'ğŸ¯ å®Œç¾å‘æŒ¥ï¼Œä¿¡å¿ƒå¤§å¢ï¼', effect: { successRate: 20, mentalHealth: 15, skillPoints: 2 } },
            { text: 'ğŸŒªï¸ çªå‘æ¶åŠ£å¤©æ°”ï¼', effect: { health: -35, mentalHealth: -20, successRate: -20 } },
            { text: 'ğŸ’° æ¡åˆ°é’±åŒ…ï¼Œå¿ƒæƒ…æ„‰æ‚¦ï¼', effect: { mentalHealth: 10, luck: 1 } },
            { text: 'ğŸ”¥ é™„è¿‘æ–½å·¥ï¼Œç©ºæ°”æ±¡æµŠï¼', effect: { health: -15, mentalHealth: -20 } },
            { text: 'ğŸµ å¬åˆ°å–œæ¬¢çš„éŸ³ä¹ï¼Œæ–—å¿—æ˜‚æ‰¬ï¼', effect: { mentalHealth: 12, courage: 1 } },
            { text: 'ğŸ’» æŠ€æœ¯æœ‹å‹è¿œç¨‹ååŠ©ï¼', effect: { successRate: 25, technology: 2, skillPoints: 3 } },
            { text: 'ğŸš å¤©ç©ºä¸­çš„æ— äººæœºç›‘æ§ï¼', effect: { successRate: -18, stealth: -1, mentalHealth: -15 } },
            { text: 'ğŸ• åƒäº†å˜è´¨é£Ÿç‰©ï¼Œèº«ä½“ä¸é€‚ï¼', effect: { health: -40, mentalHealth: -25, successRate: -25 } },
            { text: 'â­ æµæ˜Ÿè®¸æ„¿æˆåŠŸï¼', effect: { successRate: 30, luck: 3, skillPoints: 5 } }
        ];

        const achievementList = [
            { id: 'first_play', name: 'åˆæ¬¡å°è¯•', desc: 'ç¬¬ä¸€æ¬¡æ¸¸ç©æ¸¸æˆ', emoji: 'ğŸ®' },
            { id: 'survivor', name: 'å¹¸å­˜è€…', desc: 'å¥åº·å€¼è·Œç ´10åé‡æ–°å›å‡', emoji: 'ğŸ’ª' },
            { id: 'lucky_seven', name: 'å¹¸è¿ä¸ƒ', desc: 'è§¦å‘7æ¬¡æ­£é¢éšæœºäº‹ä»¶', emoji: 'ğŸ€' },
            { id: 'speed_runner', name: 'é€Ÿåº¦ç‹‚é­”', desc: '60ç§’å†…å®Œæˆæ¸¸æˆ', emoji: 'âš¡' },
            { id: 'collector', name: 'æ”¶è—å®¶', desc: 'æ”¶é›†10ä¸ªä»¥ä¸Šç‰©å“', emoji: 'ğŸ“¦' },
            { id: 'iron_will', name: 'é’¢é“æ„å¿—', desc: 'ç²¾ç¥å¥åº·ä¿æŒåœ¨80ä»¥ä¸Šå®Œæˆæ¸¸æˆ', emoji: 'ğŸ§ ' },
            { id: 'master_hacker', name: 'å¤§å¸ˆ', desc: 'æŠ€æœ¯å±æ€§è¾¾åˆ°10', emoji: 'ğŸ’»' },
            { id: 'legendary_end', name: 'ä¼ è¯´ç»ˆç»“', desc: 'è·å¾—ä¼ å¥‡ç»“å±€', emoji: 'ğŸ‘‘' },
            { id: 'death_defier', name: 'æ­»ç¥è”‘è§†è€…', desc: 'ä»æ­»äº¡è¾¹ç¼˜é€ƒè„±', emoji: 'ğŸ’€' },
            { id: 'perfect_health', name: 'å®Œç¾çŠ¶æ€', desc: 'æ»¡è¡€æ»¡ç²¾ç¥é€šå…³', emoji: 'ğŸ’' }
        ];

        const gameSteps = [
            {
                id: 'physical_prep',
                title: 'ğŸ’ª èº«ä½“å‡†å¤‡',
                text: 'åœ¨å¼€å§‹è¿™åœºè™šæ„çš„æŒ‘æˆ˜å‰ï¼Œä½ çš„è™šæ‹Ÿèº«ä½“çŠ¶æ€è‡³å…³é‡è¦ï¼ä¸€ä¸ªè™šå¼±çš„è™šæ‹Ÿèº«ä½“æ ¹æœ¬æ’‘ä¸åˆ°æœ€å...',
                choices: [
                    { text: 'ğŸƒâ€â™‚ï¸ è¿ç»­ä¸€å‘¨é«˜å¼ºåº¦è™šæ‹Ÿä½“èƒ½è®­ç»ƒ', effect: { health: 20, speed: 3, preparation: 2, successRate: 15 }, skillPointsReward: 2, next: 'mental_training' },
                    { text: 'ğŸ¥— ä¸¥æ ¼æ§åˆ¶è™šæ‹Ÿé¥®é£Ÿï¼Œä¿æŒæœ€ä½³çŠ¶æ€', effect: { health: 15, mentalHealth: 10, preparation: 1, successRate: 10 }, skillPointsReward: 1, next: 'mental_training' },
                    { text: 'ğŸ’Š æœç”¨å…´å¥‹å‰‚å¼ºåŒ–ä½“èƒ½', effect: { health: -20, speed: 5, courage: 2, successRate: 8 }, flag: 'usedDrugs', next: 'mental_training' },
                    { text: 'ğŸ˜´ ä»€ä¹ˆéƒ½ä¸åšï¼Œä¿æŒè‡ªç„¶çŠ¶æ€', effect: { health: -10, successRate: -8 }, next: 'mental_training' }
                ]
            },
            {
                id: 'mental_training',
                title: 'ğŸ§  å¿ƒç†è®­ç»ƒ',
                text: 'èº«ä½“å‡†å¤‡å¥½äº†ï¼Œä½†å¿ƒç†ç´ è´¨æ›´é‡è¦ï¼åœ¨é«˜å‹è™šæ‹Ÿç¯å¢ƒä¸‹ï¼Œå¿ƒç†å´©æºƒæ¯”èº«ä½“å—ä¼¤æ›´è‡´å‘½...',
                choices: [
                    { text: 'ğŸ§˜â€â™‚ï¸ æ·±åº¦å†¥æƒ³è®­ç»ƒï¼Œæå‡ä¸“æ³¨åŠ›', effect: { mentalHealth: 25, stealth: 2, preparation: 2, successRate: 12 }, skillPointsReward: 2, next: 'research' },
                    { text: 'ğŸ“š ç ”è¯»å¿ƒç†å­¦ï¼Œäº†è§£å¯¹æ‰‹æ€ç»´', effect: { mentalHealth: 15, stealth: 3, technology: 1, successRate: 15 }, skillPointsReward: 2, next: 'research' },
                    { text: 'ğŸ® ç©é«˜éš¾åº¦æ¸¸æˆé”»ç‚¼ååº”', effect: { mentalHealth: 10, speed: 2, luck: 1, successRate: 8 }, flag: 'gamerTraining', next: 'research' },
                    { text: 'ğŸº å–é…’æ°´å£®èƒ†', effect: { mentalHealth: -15, health: -15, courage: 1, successRate: -12 }, next: 'research' }
                ]
            },
            {
                id: 'research',
                title: 'ğŸ” å‰æœŸè°ƒç ”',
                text: 'è°ƒç ”é˜¶æ®µæ˜¯æ•´ä¸ªè®¡åˆ’çš„åŸºç¡€ï¼é”™è¯¯çš„ä¿¡æ¯ä¼šè®©ä½ åœ¨æ¸¸æˆä¸­å¤±è´¥ï¼Œä½†æ·±å…¥è°ƒç ”ä¹Ÿæœ‰æš´éœ²çš„é£é™©...',
                choices: [
                    { text: 'ğŸ’» è¿ç»­72å°æ—¶ä¸çœ ä¸ä¼‘æ·±åº¦ç ”ç©¶', effect: { successRate: 20, health: -25, mentalHealth: -15, preparation: 3, technology: 2 }, flag: 'exhaustedResearch', skillPointsReward: 3, next: 'equipment_prep' },
                    { text: 'ğŸ•µï¸ é›‡ä½£ä¾¦æ¢æ”¶é›†å†…éƒ¨æƒ…æŠ¥', effect: { successRate: 15, stealth: 2, preparation: 2 }, flag: 'hasInside', item: 'å†…éƒ¨æƒ…æŠ¥', rarity: 'rare', skillPointsReward: 2, next: 'equipment_prep' },
                    { text: 'ğŸ“± éšä¾¿çœ‹çœ‹è®ºå›ï¼Œå¤§æ¦‚äº†è§£', effect: { successRate: 3, preparation: 1 }, next: 'equipment_prep' },
                    { text: 'ğŸ” ä½¿ç”¨æŠ€æœ¯æ‰‹æ®µå…¥ä¾µç³»ç»Ÿ', effect: { successRate: 25, technology: 3, health: -10, mentalHealth: -20 }, flag: 'hackedSystem', item: 'ç³»ç»Ÿæ¼æ´ä¿¡æ¯', rarity: 'legendary', skillPointsReward: 4, special: true, next: 'equipment_prep' }
                ]
            },
            {
                id: 'equipment_prep',
                title: 'ğŸ’ è£…å¤‡å‡†å¤‡',
                text: 'ä¸“ä¸šçš„è£…å¤‡èƒ½å¤§å¤§æå‡æˆåŠŸç‡ï¼Œä½†è·å–è¿™äº›è£…å¤‡æœ¬èº«å°±æ˜¯è™šæ„çš„æŒ‘æˆ˜...',
                choices: [
                    { text: 'ğŸ’£ åˆ¶ä½œä¸“ä¸šçˆ†ç ´è£…å¤‡ä½œä¸ºåæ‰‹', effect: { successRate: 30, health: -20, courage: 3 }, item: 'çˆ†ç ´è£…å¤‡', rarity: 'legendary', flag: 'hasExplosives', skillPointsReward: 3, next: 'disguise_training' },
                    { text: 'ğŸ“¡ è´­ä¹°å†›ç”¨çº§ä¿¡å·å¹²æ‰°å™¨', effect: { successRate: 18, technology: 2, stealth: 2 }, item: 'ä¿¡å·å¹²æ‰°å™¨', rarity: 'rare', skillPointsReward: 2, next: 'disguise_training' },
                    { text: 'ğŸ”§ å‡†å¤‡åŸºç¡€å·¥å…·åŒ…', effect: { successRate: 8, preparation: 1 }, item: 'å·¥å…·åŒ…', next: 'disguise_training' },
                    { text: 'ğŸ’ ç©ºæ‰‹ä¸Šé˜µï¼Œçº¯é æŠ€å·§', effect: { courage: 2, successRate: -5 }, next: 'disguise_training' }
                ]
            },
            {
                id: 'disguise_training',
                title: 'ğŸ­ ä¼ªè£…è®­ç»ƒ',
                text: 'å®Œç¾çš„ä¼ªè£…æ˜¯æˆåŠŸçš„å…³é”®ï¼ä½†è¿‡åº¦è®­ç»ƒå¯èƒ½è®©ä½ åœ¨è™šæ„ä¸–ç•Œä¸­åˆ†ä¸æ¸…çœŸå‡...',
                choices: [
                    { text: 'ğŸ¬ è¯·ä¸“ä¸šåŒ–å¦†å¸ˆè®­ç»ƒå˜è£…æœ¯', effect: { stealth: 4, successRate: 20, mentalHealth: -10 }, item: 'ä¸“ä¸šåŒ–å¦†åŒ…', rarity: 'rare', flag: 'masterDisguise', skillPointsReward: 3, next: 'backup' },
                    { text: 'ğŸ‘” ç»ƒä¹ å•†åŠ¡äººå£«å½¢è±¡', effect: { stealth: 2, successRate: 12 }, item: 'å•†åŠ¡å¥—è£…', next: 'backup' },
                    { text: 'ğŸ“ æ‰®æ¼”å­¦ç”Ÿï¼Œæ˜¾å¾—æ— å®³', effect: { stealth: 3, luck: 1, successRate: 10 }, flag: 'studentDisguise', item: 'å­¦ç”Ÿè¯', next: 'backup' },
                    { text: 'ğŸ¥· å¿è€…è®­ç»ƒï¼Œæš—å½±è¡ŒåŠ¨', effect: { stealth: 5, speed: 3, health: -15, successRate: 25 }, item: 'å¿è€…è£…å¤‡', rarity: 'legendary', flag: 'ninjaTraining', skillPointsReward: 4, special: true, next: 'backup' }
                ]
            },
            {
                id: 'backup',
                title: 'ğŸ’¾ æ•°æ®å¤‡ä»½',
                text: 'è¿™å¯èƒ½æ˜¯ä½ æœ€åä¸€æ¬¡çœ‹åˆ°è®¾å¤‡é‡Œçš„æ•°æ®...å¤‡ä»½å¤±è¯¯ä¼šè®©ä¸€åˆ‡å‰åŠŸå°½å¼ƒï¼',
                choices: [
                    { text: 'âš¡ ä½¿ç”¨å®éªŒæ€§é‡å­å¤‡ä»½æŠ€æœ¯', effect: { successRate: 25, health: -30, technology: 3 }, flag: 'quantumBackup', item: 'é‡å­å¤‡ä»½è®¾å¤‡', rarity: 'legendary', skillPointsReward: 4, special: true, next: 'poison_test' },
                    { text: 'ğŸ”„ ä¸“ä¸šè½¯ä»¶å®Œæ•´é•œåƒå¤‡ä»½', effect: { successRate: 15, health: -5, preparation: 2 }, flag: 'hasBackup', item: 'å®Œæ•´å¤‡ä»½', rarity: 'rare', skillPointsReward: 2, next: 'poison_test' },
                    { text: 'â˜ï¸ äº‘ç«¯å¤‡ä»½é‡è¦æ–‡ä»¶', effect: { successRate: 8, technology: 1 }, item: 'äº‘ç«¯å¤‡ä»½', next: 'poison_test' },
                    { text: 'ğŸ² èµŒä¸€æŠŠï¼Œä»€ä¹ˆéƒ½ä¸å¤‡ä»½', effect: { successRate: -15, courage: 2 }, next: 'poison_test' }
                ]
            },
            {
                id: 'poison_test',
                title: 'â˜ ï¸ æ¯’æ€§æµ‹è¯•',
                text: 'æœ‰ä¼ è¨€è¯´æŸäº›æœåŠ¡ä¸­å¿ƒä¼šåœ¨ç©ºæ°”ä¸­é‡Šæ”¾è‡´å¹»æ¯’æ°”æ¥é˜²èŒƒï¼ä½ å†³å®šæå‰é€‚åº”...',
                choices: [
                    { text: 'ğŸ’‰ æ³¨å°„å°‘é‡æ¯’ç´ å»ºç«‹æŠ—æ€§', effect: { health: -40, mentalHealth: -25, successRate: 20 }, flag: 'poisonResistance', item: 'æŠ—æ¯’è¡€æ¸…', rarity: 'rare', skillPointsReward: 3, next: 'phone_check' },
                    { text: 'ğŸ˜· ä½©æˆ´ä¸“ä¸šé˜²æ¯’é¢å…·', effect: { health: -10, stealth: -2, successRate: 12 }, item: 'é˜²æ¯’é¢å…·', next: 'phone_check' },
                    { text: 'ğŸ§¬ æœç”¨å®éªŒæ€§è§£æ¯’å‰‚', effect: { health: -20, mentalHealth: 15, luck: 2, successRate: 8 }, item: 'è§£æ¯’å‰‚', next: 'phone_check' },
                    { text: 'ğŸš« æ‹’ç»å‚ä¸ï¼Œä¿æŒåŸçŠ¶', effect: { health: 5 }, next: 'phone_check' }
                ]
            },
            {
                id: 'phone_check',
                title: 'ğŸ“± è®¾å¤‡æ£€æŸ¥',
                text: 'ä¸åŒæœºå‹çš„è§£é”éš¾åº¦åƒå·®ä¸‡åˆ«...é€‰é”™æœºå‹å°±æ˜¯è‡ªå¯»æ­»è·¯ï¼',
                choices: [
                    { text: 'ğŸ”¬ ä½¿ç”¨é«˜ç²¾å¯†ä»ªå™¨å…¨é¢æ£€æµ‹', effect: { technology: 3, preparation: 2, health: -5, successRate: 18 }, item: 'æ£€æµ‹æŠ¥å‘Š', rarity: 'rare', skillPointsReward: 2, next: 'reaction_test' },
                    { text: 'ğŸ“Š è¿è¡Œä¸“ä¸šæµ‹è¯•è½¯ä»¶', effect: { technology: 2, successRate: 12 }, item: 'æµ‹è¯•ç»“æœ', next: 'reaction_test' },
                    { text: 'ğŸ‘€ å‡­ç»éªŒç®€å•æ£€æŸ¥', effect: { successRate: 5, preparation: 1 }, next: 'reaction_test' },
                    { text: 'ğŸ² ç›²ç›®è‡ªä¿¡ï¼Œä¸æ£€æŸ¥', effect: { successRate: -15, courage: 1 }, next: 'reaction_test' }
                ]
            },
            {
                id: 'reaction_test',
                title: 'âš¡ ååº”æµ‹è¯•',
                text: 'å…³é”®æ—¶åˆ»éœ€è¦é—ªç”µèˆ¬çš„ååº”é€Ÿåº¦ï¼æ¥æµ‹è¯•ä¸€ä¸‹ä½ çš„æé™...',
                isMinigame: true,
                minigameType: 'reaction',
                choices: [
                    { text: 'ğŸ¯ å¼€å§‹ååº”é€Ÿåº¦æµ‹è¯•', next: 'minigame_reaction' }
                ]
            },
            {
                id: 'app_download',
                title: 'ğŸ“² è·å–å°ç±³å•†åŸ',
                text: 'å…³é”®å·¥å…·ï¼ä½†ä¸‹è½½è¿‡ç¨‹ä¸­è¢«è¿½è¸ªçš„é£é™©æé«˜...',
                choices: [
                    { text: 'ğŸŒ é€šè¿‡æš—ç½‘ä¸‹è½½åŠ å¯†ç‰ˆæœ¬', effect: { technology: 3, stealth: 2, health: -15, mentalHealth: -20, successRate: 20 }, item: 'åŠ å¯†å°ç±³å•†åŸ', rarity: 'legendary', skillPointsReward: 3, next: 'scout_mission' },
                    { text: 'ğŸ” æŠ€æœ¯è®ºå›å¯»æ‰¾ç‰¹æ®Šç‰ˆæœ¬', effect: { technology: 2, health: -8, successRate: 15 }, item: 'ç‰¹æ®Šç‰ˆæœ¬', rarity: 'rare', skillPointsReward: 2, next: 'scout_mission' },
                    { text: 'ğŸ“± å®˜æ–¹æ¸ é“æ­£å¸¸ä¸‹è½½', effect: { successRate: 5 }, next: 'scout_mission' },
                    { text: 'ğŸ’» ç½‘é¡µç‰ˆè®¿é—®', effect: { stealth: 1, technology: 1, successRate: 8 }, next: 'scout_mission' }
                ]
            },
            {
                id: 'scout_mission',
                title: 'ğŸ•µï¸ ä¾¦å¯Ÿä»»åŠ¡',
                text: 'æ·±å…¥è™ç©´è¿›è¡Œä¾¦å¯Ÿï¼è¢«å‘ç°å°±åœ¨æ¸¸æˆä¸­å¤±è´¥...',
                choices: [
                    { text: 'ğŸŒ™ å¤œé—´æ½œå…¥ï¼Œå®Œæ•´ä¾¦å¯Ÿ', effect: { stealth: 4, preparation: 3, health: -20, mentalHealth: -15, successRate: 25 }, flag: 'nightScout', item: 'è¯¦ç»†åœ°å›¾', rarity: 'legendary', skillPointsReward: 4, next: 'appointment_prep' },
                    { text: 'ğŸ“· è¿œç¨‹æ‹ç…§è®°å½•', effect: { preparation: 2, technology: 1, health: -5, successRate: 12 }, item: 'ç…§ç‰‡è®°å½•', next: 'appointment_prep' },
                    { text: 'ğŸ‘€ å¤–å›´è§‚å¯Ÿ', effect: { preparation: 1, successRate: 5 }, next: 'appointment_prep' },
                    { text: 'ğŸ  æ”¾å¼ƒä¾¦å¯Ÿ', effect: { successRate: -10 }, next: 'appointment_prep' }
                ]
            },
            {
                id: 'appointment_prep',
                title: 'ğŸ“‹ é¢„çº¦å‡†å¤‡',
                text: 'ç”Ÿæ­»æ”¸å…³çš„ä¿¡æ¯å¡«å†™ï¼ä¸€ä¸ªé”™è¯¯å°±ä¼šå¼•èµ·æ€€ç–‘...',
                choices: [
                    { text: 'ğŸ­ åˆ›é€ å®Œç¾å‡èº«ä»½', effect: { stealth: 3, preparation: 2, mentalHealth: -10, successRate: 18 }, flag: 'fakeIdentity', item: 'å‡èº«ä»½è¯', rarity: 'rare', skillPointsReward: 3, next: 'final_preparations' },
                    { text: 'ğŸ“ æŒ‰æ”»ç•¥ç²¾ç¡®å¡«å†™', effect: { preparation: 2, successRate: 12 }, next: 'final_preparations' },
                    { text: 'ğŸ“ å£°ç§°å­¦ç”Ÿç ”ç©¶é¡¹ç›®', effect: { stealth: 2, successRate: 8 }, flag: 'studentCover', next: 'final_preparations' },
                    { text: 'ğŸ“„ éšä¾¿å¡«å†™', effect: { successRate: -8 }, next: 'final_preparations' }
                ]
            },
            {
                id: 'final_preparations',
                title: 'âš”ï¸ æœ€ç»ˆå‡†å¤‡',
                text: 'æœ€åçš„å‡†å¤‡æ—¶åˆ»ï¼æ¯ä¸ªç»†èŠ‚éƒ½å¯èƒ½å†³å®šæ¸¸æˆæˆè´¥...',
                choices: [
                    { text: 'ğŸ’ª æé™ä½“èƒ½å†²åˆºè®­ç»ƒ', effect: { speed: 3, health: -25, mentalHealth: -10, successRate: 15 }, skillPointsReward: 2, next: 'transportation' },
                    { text: 'ğŸ§  å¿ƒç†æš—ç¤ºå¼ºåŒ–', effect: { mentalHealth: 15, courage: 2, successRate: 10 }, skillPointsReward: 1, next: 'transportation' },
                    { text: 'ğŸ”§ è£…å¤‡æœ€åæ£€æŸ¥', effect: { preparation: 2, technology: 1, successRate: 8 }, next: 'transportation' },
                    { text: 'ğŸº å–é…’å‹æƒŠ', effect: { health: -15, mentalHealth: -10, courage: 1, successRate: -5 }, next: 'transportation' }
                ]
            },
            {
                id: 'transportation',
                title: 'ğŸš— é€ƒè·‘è½½å…·',
                text: 'é€‰æ‹©é”™è¯¯çš„é€ƒè·‘å·¥å…·å°±æ˜¯æ­»è·¯ä¸€æ¡ï¼',
                choices: [
                    { text: 'ğŸï¸ æ”¹è£…æ‘©æ‰˜è½¦ï¼Œæé€Ÿé€ƒè·‘', effect: { speed: 5, health: -15, successRate: 20 }, flag: 'hasMotorcycle', item: 'æ”¹è£…æ‘©æ‰˜', rarity: 'rare', skillPointsReward: 2, next: 'infiltration' },
                    { text: 'ğŸ›µ ç”µåŠ¨è½¦çµæ´»æœºåŠ¨', effect: { speed: 3, stealth: 2, successRate: 15 }, flag: 'hasScooter', item: 'ç”µåŠ¨è½¦', next: 'infiltration' },
                    { text: 'ğŸš— æ±½è½¦å¿«é€Ÿä½†æ˜¾çœ¼', effect: { speed: 2, successRate: 8 }, flag: 'hasCar', next: 'infiltration' },
                    { text: 'ğŸƒâ€â™‚ï¸ çº¯é åŒè…¿', effect: { speed: 2, courage: 2, health: -10, successRate: 5 }, next: 'infiltration' },
                    { text: 'ğŸš é›‡ä½£ç›´å‡æœº', effect: { speed: 8, successRate: 35, skillPoints: 5 }, item: 'ç›´å‡æœº', rarity: 'legendary', special: true, next: 'infiltration' }
                ]
            },
            {
                id: 'infiltration',
                title: 'ğŸ—ï¸ æ½œå…¥é˜¶æ®µ',
                text: 'æ½œå…¥æœåŠ¡ä¸­å¿ƒï¼ä¸€æ­¥é”™è¯¯å°±æ˜¯ä¸‡åŠ«ä¸å¤...',
                choices: [
                    { text: 'ğŸ•³ï¸ ä»ä¸‹æ°´é“æ½œå…¥', effect: { stealth: 4, health: -30, mentalHealth: -20, successRate: 20 }, flag: 'sewerEntry', skillPointsReward: 3, next: 'security_bypass' },
                    { text: 'ğŸ¢ ç¿»å¢™è¿›å…¥', effect: { stealth: 2, speed: 2, health: -15, successRate: 12 }, next: 'security_bypass' },
                    { text: 'ğŸšª æ­£é—¨è¿›å…¥', effect: { courage: 1, successRate: 5 }, next: 'security_bypass' },
                    { text: 'ğŸ’¥ ç‚¸å‡ºä¸€ä¸ªæ´', effect: { courage: 3, health: -20, successRate: -10 }, condition: 'hasExplosives', next: 'security_bypass' }
                ]
            },
            {
                id: 'security_bypass',
                title: 'ğŸ”’ å®‰å…¨çªç ´',
                text: 'é¢å¯¹é«˜ç§‘æŠ€å®‰é˜²ç³»ç»Ÿï¼ç ´è§£å¤±è´¥ä¼šå¼•æ¥æ‰€æœ‰ä¿å®‰...',
                choices: [
                    { text: 'ğŸ’» æŠ€æœ¯ç ´è§£', effect: { technology: 3, health: -10, mentalHealth: -15, successRate: 25 }, condition: 'hackedSystem', skillPointsReward: 4, next: 'enter_store' },
                    { text: 'ğŸ“¡ ä½¿ç”¨ä¿¡å·å¹²æ‰°å™¨', effect: { technology: 2, stealth: 2, successRate: 18 }, condition: 'hasJammer', next: 'enter_store' },
                    { text: 'ğŸ”§ ç‰©ç†ç ´å', effect: { health: -20, courage: 2, successRate: 10 }, next: 'enter_store' },
                    { text: 'ğŸ¤ ç¥ˆç¥·æ²¡æœ‰å®‰é˜²', effect: { luck: 1, successRate: -15 }, next: 'enter_store' }
                ]
            },
            {
                id: 'enter_store',
                title: 'ğŸª è¿›å…¥æœåŠ¡ä¸­å¿ƒ',
                text: 'ç»ˆäºè¿›å…¥äº†ï¼ä½†è¿™é‡Œå°±æ˜¯çš„é¾™æ½­è™ç©´...',
                choices: [
                    { text: 'ğŸ•µï¸ æš—ä¸­è§‚å¯Ÿå¸ƒå±€', effect: { stealth: 2, preparation: 1, successRate: 8 }, next: 'interaction' },
                    { text: 'ğŸ˜Š è¡¨ç°è‡ªç„¶ï¼Œç›´æ¥è¡ŒåŠ¨', effect: { courage: 1, successRate: 5 }, next: 'interaction' },
                    { text: 'ğŸ“± å‡è£…ç´§æ€¥ç”µè¯', effect: { stealth: 1, successRate: 3 }, next: 'interaction' },
                    { text: 'ğŸ’¨ å¿«é€Ÿå†²åˆº', effect: { speed: 2, health: -5, successRate: -5 }, next: 'interaction' }
                ]
            },
            {
                id: 'interaction',
                title: 'ğŸ¤ åˆæ¬¡æ¥è§¦',
                text: 'å·¥ç¨‹å¸ˆçœ‹å‘ä½ ...è¿™ä¸€åˆ»å†³å®šæ¸¸æˆæˆè´¥ï¼',
                choices: [
                    { text: 'ğŸ­ å®Œç¾æ¼”æŠ€æ¬ºéª—', effect: { stealth: 3, mentalHealth: -10, successRate: 15 }, condition: 'masterDisguise', skillPointsReward: 2, next: 'diagnosis' },
                    { text: 'ğŸ“‹ å‡ºç¤ºé¢„çº¦ä¿¡æ¯', effect: { preparation: 1, successRate: 8 }, next: 'diagnosis' },
                    { text: 'ğŸ˜… è£…ä½œæ— å®³å®¢æˆ·', effect: { stealth: 2, successRate: 10 }, next: 'diagnosis' },
                    { text: 'ğŸ˜° ç´§å¼ è¿‡åº¦æš´éœ²', effect: { mentalHealth: -15, successRate: -20 }, next: 'diagnosis' }
                ]
            },
            {
                id: 'diagnosis',
                title: 'ğŸ” æ•…éšœè¯Šæ–­',
                text: 'å·¥ç¨‹å¸ˆå¼€å§‹æ£€æŸ¥...å¿ƒè·³å¦‚é›·é¸£ï¼',
                choices: [
                    { text: 'ğŸ“– è¯¦ç»†æè¿°æ•…éšœ', effect: { preparation: 2, successRate: 8 }, next: 'computer_access' },
                    { text: 'ğŸ¤” æ¨¡ç³Šå¼•å¯¼æ“ä½œ', effect: { stealth: 2, successRate: 6 }, next: 'computer_access' },
                    { text: 'ğŸ’¡ æš—ç¤ºéœ€è¦é‡ç½®', effect: { technology: 1, successRate: 10 }, next: 'computer_access' },
                    { text: 'ğŸ˜µ è£…ä½œæŠ€æœ¯å°ç™½', effect: { stealth: 1, luck: 1, successRate: 5 }, next: 'computer_access' }
                ]
            },
            {
                id: 'computer_access',
                title: 'ğŸ’» å…³é”®æ—¶åˆ»',
                text: 'ä»–è¿æ¥äº†ç”µè„‘ï¼åƒè½½éš¾é€¢çš„æœºä¼šï¼',
                choices: [
                    { text: 'ğŸ‘€ æ­»æ­»ç›¯ç€æ“ä½œ', effect: { technology: 2, preparation: 1, successRate: 8 }, next: 'critical_moment' },
                    { text: 'ğŸ—£ï¸ èŠå¤©åˆ†æ•£æ³¨æ„', effect: { stealth: 2, successRate: 10 }, next: 'critical_moment' },
                    { text: 'ğŸ“± å‡è£…æ¥ç”µè¯', effect: { stealth: 1, successRate: 5 }, next: 'critical_moment' },
                    { text: 'ğŸ˜¤ å‡†å¤‡è¡ŒåŠ¨', effect: { courage: 2, successRate: 6 }, next: 'critical_moment' }
                ]
            },
            {
                id: 'critical_moment',
                title: 'âš¡ åƒé’§ä¸€å‘',
                text: 'BLè§£é”æ ‡å¿—å‡ºç°äº†ï¼ï¼ï¼è¿™æ˜¯å”¯ä¸€çš„æœºä¼šï¼ï¼ï¼',
                choices: [
                    { text: 'â° ç­‰å¾…å®Œç¾æ—¶æœº', effect: { preparation: 3, stealth: 2, successRate: 15 }, next: 'action_phase' },
                    { text: 'âš¡ é—ªç”µå‡ºå‡»', effect: { speed: 3, successRate: 12 }, next: 'action_phase' },
                    { text: 'ğŸ­ åˆ¶é€ æ··ä¹±', effect: { stealth: 2, courage: 2, successRate: 10 }, next: 'action_phase' },
                    { text: 'ğŸ˜± æ‰‹æŠ–æš´éœ²', effect: { mentalHealth: -20, successRate: -25 }, next: 'action_phase' }
                ]
            },
            {
                id: 'action_phase',
                title: 'ğŸƒâ€â™‚ï¸ ç”Ÿæ­»æ—¶é€Ÿ',
                text: 'æŠ“èµ·è®¾å¤‡çš„ç¬é—´ï¼"ç«™ä½ï¼ï¼"æ€’å¼å“å½»æˆ¿é—´ï¼',
                choices: [
                    { text: 'ğŸ’¨ æ‹¼å‘½ç‹‚å¥”', effect: { speed: 4, health: -15, successRate: 18 }, next: 'chase_sequence' },
                    { text: 'ğŸª‘ è¸¢ç¿»éšœç¢ç‰©', effect: { speed: 2, courage: 2, successRate: 12 }, next: 'chase_sequence' },
                    { text: 'ğŸ”¥ å¤§å–Š"ç€ç«äº†"', effect: { courage: 3, mentalHealth: -5, successRate: 8 }, next: 'chase_sequence' },
                    { text: 'ğŸ¤¸ æˆ˜æœ¯ç¿»æ»š', effect: { speed: 2, stealth: 1, luck: 1, successRate: 10 }, next: 'chase_sequence' },
                    { text: 'ğŸ’¥ å¼•çˆ†ç‚¸å¼¹æ©æŠ¤', effect: { courage: 5, health: -25, successRate: 30 }, condition: 'hasExplosives', special: true, next: 'chase_sequence' }
                ]
            },
            {
                id: 'chase_sequence',
                title: 'ğŸš¨ ç–¯ç‹‚è¿½å‡»',
                text: 'èº«åä¼ æ¥å¯†é›†çš„è„šæ­¥å£°ï¼è­¦ç¬›å£°å“èµ·ï¼è¿™æ˜¯ç”Ÿæ­»å…³å¤´ï¼',
                choices: [
                    { text: 'ğŸƒâ€â™‚ï¸ ç‡ƒçƒ§ç”Ÿå‘½ç‹‚å¥”', effect: { speed: 5, health: -30, mentalHealth: -15, successRate: 20 }, next: 'final_escape' },
                    { text: 'ğŸ§  å†·é™åˆ†æè·¯çº¿', effect: { preparation: 2, stealth: 2, health: -10, successRate: 15 }, next: 'final_escape' },
                    { text: 'ğŸ—ºï¸ ä½¿ç”¨é¢„è®¾è·¯çº¿', effect: { preparation: 3, successRate: 22 }, condition: 'nightScout', next: 'final_escape' },
                    { text: 'ğŸŒƒ æ¶ˆå¤±åœ¨å¤œè‰²ä¸­', effect: { stealth: 4, luck: 2, successRate: 18 }, condition: 'ninjaTraining', next: 'final_escape' }
                ]
            },
            {
                id: 'final_escape',
                title: 'ğŸ ç»ˆæé€ƒè„±',
                text: 'æœ€åçš„å†²åˆºï¼ä½ å·²ç»ç­‹ç–²åŠ›å°½ï¼Œä½†èƒœåˆ©å°±åœ¨çœ¼å‰ï¼',
                choices: [
                    { text: 'ğŸš€ è¶…è¶Šæé™çˆ†å‘', effect: { speed: 6, health: -35, mentalHealth: -20, successRate: 25 }, next: 'result' },
                    { text: 'ğŸ¯ ç²¾å‡†è®¡ç®—é€ƒè„±', effect: { preparation: 3, stealth: 2, health: -15, successRate: 20 }, next: 'result' },
                    { text: 'ğŸ€ ç¥ˆç¥·å¹¸è¿å¥³ç¥', effect: { luck: 5, health: -10, successRate: 15 }, next: 'result' },
                    { text: 'ğŸ˜ æ·¡å®šå®Œç¾æ”¶å°¾', effect: { stealth: 3, courage: 2, successRate: 18 }, next: 'result' },
                    { text: 'ğŸš ç›´å‡æœºç©ºä¸­æ¥åº”', effect: { speed: 10, successRate: 40 }, condition: 'hasHelicopter', special: true, next: 'result' }
                ]
            }
        ];

        // --- Core Game Logic ---
        function initializeGameState() {
            currentStep = 0;
            successRate = 5;
            health = 100;
            mentalHealth = 100;
            skillPoints = 0;
            gameStartTime = Date.now();
            randomEventCount = 0;
            achievements = [];
            godMode = false;
            inventory = [];
            isProcessing = false;
            justHadRandomEvent = false;
            
            playerStats = { 
                preparation: 0, stealth: 0, speed: 0, 
                luck: 0, courage: 0, technology: 0 
            };
            flags = {
                hasBackup: false, knowsLayout: false, hasInside: false,
                hasDisguise: false, isMinor: false, hasVehicle: false,
                perfectTiming: false, survivedPoison: false, wonReactionGame: false,
                masterHacker: false, speedRunner: false, luckyDodge: false
            };
        }

        function startGame() {
            initializeGameState();
            
            const statsDock = document.getElementById('statsDock');
            const dockToggle = document.getElementById('dockToggle');
            statsDock.style.display = 'block';
            dockToggle.textContent = 'Ã—';
            dockToggle.style.backgroundColor = 'rgba(220, 53, 69, 0.9)';
            dockToggle.style.color = 'white';
            document.getElementById('skillPointsDisplay').style.display = 'block';
            
            unlockAchievement('first_play');
            
            updateTimer();
            nextStep();
        }

        function nextStep() {
            if (!justHadRandomEvent && currentStep > 0 && currentStep < gameSteps.length - 2 && Math.random() < 0.3) {
                justHadRandomEvent = true;
                triggerRandomEvent();
                return;
            }

            justHadRandomEvent = false;

            const step = gameSteps[currentStep];
            const gameArea = document.getElementById('gameArea');
            
            if (step.isMinigame) {
                showMinigame(step);
                return;
            }
            
            let choicesHtml = '';
            step.choices.forEach((choice, index) => {
                if (choice.condition && !flags[choice.condition]) return;
                
                let btnClass = 'choice-btn';
                if (choice.special) btnClass += ' special';
                else if ((choice.effect.health && choice.effect.health <= -20) || (choice.effect.mentalHealth && choice.effect.mentalHealth <= -15)) btnClass += ' deadly';
                else if ((choice.effect.successRate && choice.effect.successRate < 0) || (choice.effect.health && choice.effect.health < 0)) btnClass += ' danger';
                else if (choice.effect.successRate && choice.effect.successRate < 5) btnClass += ' neutral';
                
                choicesHtml += `<button class="${btnClass}" onclick="makeChoice(${index})">${choice.text}</button>`;
            });

            const isFinalEscape = step.id.includes('final') || step.id.includes('escape') || step.id.includes('chase');
            const areaClass = isFinalEscape ? 'final-escape-area' : '';
            const dangerIndicator = isFinalEscape ? '<div class="danger-indicator">âš ï¸ å±é™©</div>' : '';

            gameArea.innerHTML = `
                <div class="${areaClass}">
                    ${dangerIndicator}
                    <h2 style="color: #333; margin-bottom: 20px;">${step.title}</h2>
                    <div class="story-text">${step.text}</div>
                    <div class="choices">${choicesHtml}</div>
                </div>
            `;

            updateStats();
            isProcessing = false;
        }

        function makeChoice(choiceIndex) {
            if (isProcessing) return;
            isProcessing = true;

            document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = true);

            const step = gameSteps[currentStep];
            const choice = step.choices[choiceIndex];
            
            Object.keys(choice.effect).forEach(key => {
                if (key === 'successRate') successRate += choice.effect[key];
                else if (key === 'health') health = Math.max(0, Math.min(100, health + choice.effect[key]));
                else if (key === 'mentalHealth') mentalHealth = Math.max(0, Math.min(100, mentalHealth + choice.effect[key]));
                else if (key === 'skillPoints') skillPoints += choice.effect[key];
                else playerStats[key] = Math.max(0, playerStats[key] + choice.effect[key]);
            });

            if (choice.skillPointsReward) skillPoints += choice.skillPointsReward;
            if (choice.flag) flags[choice.flag] = true;
            if (choice.item) inventory.push({ name: choice.item, rarity: choice.rarity || 'common' });

            updateStats();
            checkAchievements();

            if (checkHealthStatus()) {
                return;
            }

            try {
                if (choice.next === 'result') {
                    showResult();
                } else if (choice.next === 'minigame_reaction') {
                    showReactionGame(); 
                } else {
                    const nextStepIndex = gameSteps.findIndex(s => s.id === choice.next);
                    if (nextStepIndex !== -1) {
                        currentStep = nextStepIndex;
                        nextStep();
                    } else {
                        throw new Error(`Next step ID not found: ${choice.next}`);
                    }
                }
            } catch (error) {
                console.error("CRITICAL ERROR:", error.message);
                alert("å‘ç”Ÿäº†ä¸€ä¸ªä¸¥é‡é”™è¯¯ï¼šæ‰¾ä¸åˆ°ä¸‹ä¸€æ­¥ã€‚æ¸¸æˆå·²åœæ­¢ã€‚è¯·å°è¯•åˆ·æ–°æˆ–é‡æ–°å¼€å§‹ã€‚");
                isProcessing = false;
            }
        }

        function checkHealthStatus() {
            if (health <= 0) {
                showResult('death');
                return true;
            }
            if (mentalHealth <= 0) {
                showResult('mental_breakdown');
                return true;
            }
            if (health <= 15 && !achievements.includes('survivor')) {
                unlockAchievement('survivor');
            }
            return false;
        }

        function checkAchievements() {
            const gameTime = Math.floor((Date.now() - gameStartTime) / 1000);
            if (gameTime <= 60 && !achievements.includes('speed_runner')) unlockAchievement('speed_runner');
            if (inventory.length >= 10 && !achievements.includes('collector')) unlockAchievement('collector');
            if (mentalHealth >= 80 && !achievements.includes('iron_will')) unlockAchievement('iron_will');
            if (playerStats.technology >= 10 && !achievements.includes('master_hacker')) unlockAchievement('master_hacker');
        }

        function unlockAchievement(achievementId) {
            if (achievements.includes(achievementId)) return;
            achievements.push(achievementId);
            const achievement = achievementList.find(a => a.id === achievementId);
            if (achievement) {
                showAchievementPopup(achievement);
                skillPoints += 2;
            }
        }

        function showAchievementPopup(achievement) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">ğŸ† æˆå°±è§£é”!</div>
                <div>${achievement.emoji} ${achievement.name}</div>
                <div style="font-size: 0.8em; margin-top: 5px;">${achievement.desc}</div>
                <div style="font-size: 0.7em; margin-top: 3px; color: #ffd700;">+2 æŠ€èƒ½ç‚¹æ•°</div>
            `;
            document.body.appendChild(popup);
            setTimeout(() => {
                if (document.body.contains(popup)) {
                    document.body.removeChild(popup);
                }
            }, 3000);
        }

        function triggerRandomEvent() {
            const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
            randomEventCount++;
            
            Object.keys(event.effect).forEach(key => {
                if (key === 'successRate') successRate += event.effect[key];
                else if (key === 'health') health = Math.max(0, Math.min(100, health + event.effect[key]));
                else if (key === 'mentalHealth') mentalHealth = Math.max(0, Math.min(100, mentalHealth + event.effect[key]));
                else if (key === 'skillPoints') skillPoints += event.effect[key];
                else playerStats[key] = Math.max(0, playerStats[key] + (event.effect[key] || 0));
            });

            if (randomEventCount >= 7 && event.effect.successRate > 0 && !achievements.includes('lucky_seven')) {
                unlockAchievement('lucky_seven');
            }

            const effectStrings = Object.keys(event.effect).map(key => {
                const value = event.effect[key];
                const symbol = value > 0 ? '+' : '';
                const chineseKey = { 'successRate': 'æˆåŠŸç‡', 'health': 'å¥åº·å€¼', 'mentalHealth': 'ç²¾ç¥å€¼', 'skillPoints': 'æŠ€èƒ½ç‚¹', 'preparation': 'å‡†å¤‡', 'stealth': 'éšè”½', 'speed': 'é€Ÿåº¦', 'luck': 'è¿æ°”', 'courage': 'å‹‡æ°”', 'technology': 'æŠ€æœ¯' }[key] || key;
                return `${chineseKey}: ${symbol}${value}`;
            });

            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="random-event">
                    <h2 style="color: #007bff; margin-bottom: 15px;">ğŸ² éšæœºäº‹ä»¶</h2>
                    <div style="font-size: 1.2em; margin-bottom: 20px;">${event.text}</div>
                    <div style="font-size: 0.9em; color: #666;">${effectStrings.join(' | ')}</div>
                    <button class="choice-btn" onclick="continueAfterEvent()" style="margin-top: 20px;">ç»§ç»­å‰è¿›</button>
                </div>
            `;

            updateStats();
            if (checkHealthStatus()) return;
            isProcessing = false;
        }

        function continueAfterEvent() {
            if (isProcessing) return;
            isProcessing = true;
            document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = true);
            nextStep();
        }

        function showMinigame(step) {
            if (step.minigameType === 'reaction') showReactionGame();
        }

        function showReactionGame() {
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="minigame-container">
                    <h2 style="color: #ffc107; margin-bottom: 20px;">âš¡ ååº”é€Ÿåº¦æµ‹è¯•</h2>
                    <div style="margin-bottom: 20px;">å½“æŒ‰é’®å˜ç»¿æ—¶ç«‹å³ç‚¹å‡»ï¼æµ‹è¯•ä½ çš„ååº”æé™ï¼</div>
                    <div class="reaction-game">
                        <button class="reaction-btn" id="reactionBtn" onclick="reactionTest()">ç­‰å¾…...</button>
                    </div>
                    <div id="reactionResult" style="margin-top: 20px; font-weight: bold;"></div>
                </div>
            `;
            isProcessing = false;
            setTimeout(() => {
                const btn = document.getElementById('reactionBtn');
                if (btn) {
                    btn.classList.add('active');
                    btn.textContent = 'ç‚¹å‡»!';
                    btn.dataset.startTime = Date.now();
                }
            }, Math.random() * 3000 + 2000);
        }

        function reactionTest() {
            if (isProcessing) return;
            isProcessing = true;
            const btn = document.getElementById('reactionBtn');
            const resultDiv = document.getElementById('reactionResult');
            btn.disabled = true;
            
            if (!btn.classList.contains('active')) {
                resultDiv.innerHTML = 'âŒ å¤ªæ—©äº†ï¼ååº”æµ‹è¯•å¤±è´¥ï¼<br><button class="choice-btn" onclick="finishReactionGame(false)">ç»§ç»­æ¸¸æˆ</button>';
                isProcessing = false;
                return;
            }

            const reactionTime = Date.now() - parseInt(btn.dataset.startTime);
            let bonus = 0, message = '';
            
            if (reactionTime < 200) { message = 'ğŸš€ é—ªç”µååº”ï¼'; bonus = 20; flags.wonReactionGame = true; unlockAchievement('speed_runner'); }
            else if (reactionTime < 400) { message = 'âš¡ ä¼˜ç§€ååº”ï¼'; bonus = 15; flags.wonReactionGame = true; }
            else if (reactionTime < 600) { message = 'ğŸ‘ è‰¯å¥½ååº”ï¼'; bonus = 10; }
            else { message = 'ğŸ˜ ååº”ä¸€èˆ¬...'; bonus = 5; }

            resultDiv.innerHTML = `
                ${message}<br>ååº”æ—¶é—´: ${reactionTime}ms<br>æˆåŠŸç‡å¥–åŠ±: +${bonus}%<br>
                <button class="choice-btn" onclick="finishReactionGame(true, ${bonus})">ç»§ç»­æ¸¸æˆ</button>
            `;
            isProcessing = false;
        }

        function finishReactionGame(success, bonus = 0) {
            if (isProcessing) return;
            isProcessing = true;

            if (success) {
                successRate += bonus;
                if (bonus >= 15) { skillPoints += 3; playerStats.speed += 2; }
            } else {
                successRate -= 10; health -= 10; mentalHealth -= 15;
            }

            updateStats();
            if (checkHealthStatus()) return;

            const nextStepIndex = gameSteps.findIndex(s => s.id === 'app_download');
            if (nextStepIndex !== -1) {
                currentStep = nextStepIndex;
                nextStep();
            } else {
                console.error("CRITICAL ERROR: Could not find 'app_download' step after minigame.");
                alert("å‘ç”Ÿäº†ä¸€ä¸ªä¸¥é‡é”™è¯¯ï¼šå°æ¸¸æˆåæ— æ³•ç»§ç»­ã€‚æ¸¸æˆå·²åœæ­¢ã€‚è¯·å°è¯•åˆ·æ–°æˆ–é‡æ–°å¼€å§‹ã€‚");
                isProcessing = false;
            }
        }

        function calculateCurrentSuccessRate() {
            if (gameStartTime === 0) return successRate;
            let currentSuccessRate = successRate + playerStats.preparation * 1.2 + playerStats.stealth * 1.5 + playerStats.speed * 1.8 + playerStats.luck * 1.5 + playerStats.courage * 1.0 + playerStats.technology * 1.0 + skillPoints * 0.8;
            if (flags.hasBackup) currentSuccessRate += 5;
            if (flags.nightScout) currentSuccessRate += 8;
            if (flags.hasInside) currentSuccessRate += 10;
            if (flags.masterDisguise) currentSuccessRate += 7;
            if (flags.ninjaTraining) currentSuccessRate += 12;
            if (flags.quantumBackup) currentSuccessRate += 15;
            if (flags.wonReactionGame) currentSuccessRate += 8;
            if (health < 30) currentSuccessRate -= 15;
            if (mentalHealth < 30) currentSuccessRate -= 20;
            if (health <= 10) currentSuccessRate -= 25;
            if (mentalHealth <= 10) currentSuccessRate -= 30;
            if (godMode) return 100;
            return Math.max(0, Math.min(95, currentSuccessRate));
        }

        function updateStats() {
            const healthFill = document.getElementById('healthFill');
            const healthText = document.getElementById('healthText');
            if (healthFill && healthText) {
                const healthColor = health > 60 ? '#28a745' : health > 30 ? '#ffc107' : '#dc3545';
                healthFill.style.width = health + '%';
                healthFill.style.background = healthColor;
                healthText.textContent = health;
            }

            const mentalFill = document.getElementById('mentalFill');
            const mentalText = document.getElementById('mentalText');
            if (mentalFill && mentalText) {
                const mentalColor = mentalHealth > 60 ? '#007bff' : mentalHealth > 30 ? '#ffc107' : '#dc3545';
                mentalFill.style.width = mentalHealth + '%';
                mentalFill.style.background = mentalColor;
                mentalText.textContent = mentalHealth;
            }

            const successRateText = document.getElementById('successRateText');
            if (successRateText) {
                const rate = Math.round(calculateCurrentSuccessRate());
                const color = rate > 30 ? '#28a745' : rate > 15 ? '#ffc107' : '#dc3545';
                successRateText.innerHTML = `<span style="color: ${color};">${rate}%</span>`;
            }

            const skillPointsText = document.getElementById('skillPointsText');
            const powerLevelText = document.getElementById('powerLevelText');
            if (skillPointsText && powerLevelText) {
                skillPointsText.textContent = skillPoints;
                const totalPower = Object.values(playerStats).reduce((a, b) => a + b, 0) + skillPoints;
                let powerLevel = 'æ–°æ‰‹';
                if (totalPower >= 50) powerLevel = 'ä¼ å¥‡';
                else if (totalPower >= 30) powerLevel = 'ä¸“å®¶';
                else if (totalPower >= 20) powerLevel = 'ç†Ÿç»ƒ';
                else if (totalPower >= 10) powerLevel = 'è¿›é˜¶';
                powerLevelText.textContent = powerLevel;
            }

            const inventoryPanel = document.getElementById('inventoryPanel');
            const inventoryItems = document.getElementById('inventoryItems');
            if (inventoryPanel && inventoryItems) {
                if (inventory.length > 0) {
                    inventoryPanel.style.display = 'block';
                    inventoryItems.innerHTML = inventory.map(item => `<span class="inventory-item ${item.rarity}">${item.name}</span>`).join('');
                } else {
                    inventoryPanel.style.display = 'none';
                }
            }
        }

        function showResult(forceResult = null) {
            const gameArea = document.getElementById('gameArea');
            const finalSuccessRate = calculateCurrentSuccessRate();
            
            let resultType = forceResult;
            if (!resultType) {
                const roll = Math.random() * 100;
                if (roll < finalSuccessRate * 0.08) resultType = 'legendary';
                else if (roll < finalSuccessRate * 0.35) resultType = 'success';
                else if (roll < finalSuccessRate * 0.65) resultType = 'caught';
                else if (health <= 5) resultType = 'death';
                else if (mentalHealth <= 5) resultType = 'mental_breakdown';
                else if (roll < 85) resultType = 'failure';
                else resultType = (finalSuccessRate < 20) ? 'caught' : 'failure';
            }
            
            if ((resultType === 'success' || resultType === 'legendary') && health === 100 && mentalHealth === 100) unlockAchievement('perfect_health');
            if (resultType === 'legendary') unlockAchievement('legendary_end');
            if (health <= 5 && (resultType === 'success' || resultType === 'legendary')) unlockAchievement('death_defier');
            
            const endingDetails = getDetailedEnding(resultType);
            const gameTime = Math.floor((Date.now() - gameStartTime) / 1000);

            let rating = 'F';
            if (finalSuccessRate >= 80 && health >= 70 && mentalHealth >= 70) rating = 'S+';
            else if (finalSuccessRate >= 70) rating = 'S';
            else if (finalSuccessRate >= 60) rating = 'A';
            else if (finalSuccessRate >= 50) rating = 'B';
            else if (finalSuccessRate >= 35) rating = 'C';
            else if (finalSuccessRate >= 20) rating = 'D';

            gameArea.innerHTML = `
                <div class="result ${endingDetails.class}">
                    ${endingDetails.emoji} ${endingDetails.title} ${endingDetails.emoji}
                </div>
                <div class="story-text">
                    ${endingDetails.message}
                    <br><br>
                    <div style="text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <div style="font-size: 1.5em; margin-bottom: 10px;">æ¸¸æˆè¯„çº§: <span style="color: #ffd700; font-weight: bold;">${rating}</span></div>
                        <div>${endingDetails.subtitle}</div>
                        <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.9;">${endingDetails.specialNote}</div>
                    </div>
                </div>
                <div style="text-align: center; margin: 20px 0;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 20px 0;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">æœ€ç»ˆæˆåŠŸç‡</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${Math.round(finalSuccessRate)}%</div></div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">æ¸¸æˆæ—¶é•¿</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${gameTime}ç§’</div></div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ç‰©å“æ”¶é›†</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${inventory.length}ä¸ª</div></div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">æŠ€èƒ½ç‚¹æ•°</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${skillPoints}</div></div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">æœ€ç»ˆå¥åº·</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${health}/100</div></div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"><div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ç²¾ç¥çŠ¶æ€</div><div style="font-size: 1.5em; font-weight: bold; color: #333;">${mentalHealth}/100</div></div>
                    </div>
                    <div style="margin: 20px 0; font-size: 0.9em; color: #666;"><strong>æœ€ç»ˆå±æ€§ï¼š</strong> å‡†å¤‡${playerStats.preparation} | éšè”½${playerStats.stealth} | é€Ÿåº¦${playerStats.speed} | è¿æ°”${playerStats.luck} | å‹‡æ°”${playerStats.courage} | æŠ€æœ¯${playerStats.technology}</div>
                    <div style="margin: 20px 0; font-size: 0.9em; color: #666;"><strong>è·å¾—æˆå°±ï¼š</strong> ${achievements.length}ä¸ª ${achievements.length > 0 ? '<br>' + achievements.map(id => { const ach = achievementList.find(a => a.id === id); return ach ? `${ach.emoji} ${ach.name}` : ''; }).join(' | ') : 'æ— '}</div>
                    <div style="margin: 20px 0; font-size: 0.9em; color: #666;"><strong>éšæœºäº‹ä»¶ï¼š</strong> ${randomEventCount}æ¬¡</div>
                </div>
                <div style="text-align: center;">
                    <button class="reset-btn" onclick="startGame()">ğŸ”„ å†æ¬¡æŒ‘æˆ˜</button>
                    <button class="share-btn" onclick="shareResult('${resultType}', ${Math.round(finalSuccessRate)}, ${gameTime}, '${rating}')">ğŸ“¤ åˆ†äº«ç»“æœ</button>
                </div>
                <div style="margin-top: 20px; color: #666; font-size: 0.9em; text-align: center;">${getMotivationalMessage(resultType, finalSuccessRate)}</div>
            `;
            isProcessing = false;
        }

        function getDetailedEnding(baseType) {
            const gameTime = Math.floor((Date.now() - gameStartTime) / 1000);
            let specialModifiers = [];
            if (health === 100 && mentalHealth === 100) specialModifiers.push('perfect');
            else if (health <= 10) specialModifiers.push('barely_alive');
            if (skillPoints >= 20) specialModifiers.push('master');
            if (gameTime <= 60) specialModifiers.push('speedrun');
            if (inventory.length >= 10) specialModifiers.push('collector');
            if (flags.ninjaTraining) specialModifiers.push('ninja');
            if (flags.hackedSystem) specialModifiers.push('hacker');
            return getEndingData(baseType, specialModifiers);
        }

        function getEndingData(baseType, modifiers) {
            const baseEndings = {
                legendary: { emoji: 'ğŸ‘‘', class: 'legendary', baseTitle: 'ä¼ å¥‡ç»“å±€' },
                success: { emoji: 'ğŸ‰', class: 'success', baseTitle: 'æˆåŠŸç»“å±€' },
                caught: { emoji: 'ğŸ˜…', class: 'caught', baseTitle: 'è¢«æŠ“ç»“å±€' },
                failure: { emoji: 'ğŸ˜¢', class: 'failure', baseTitle: 'å¤±è´¥ç»“å±€' },
                death: { emoji: 'ğŸ’€', class: 'death', baseTitle: 'æ­»äº¡ç»“å±€' },
                mental_breakdown: { emoji: 'ğŸ¤¯', class: 'failure', baseTitle: 'ç²¾ç¥å´©æºƒç»“å±€' }
            };
            const base = baseEndings[baseType];
            let title = base.baseTitle, subtitle = '', specialNote = '', message = '';
            if (modifiers.includes('perfect')) { title += ' - å®Œç¾æ— ç‘•'; subtitle = 'ä»¥å®Œç¾çŠ¶æ€è¾¾æˆç›®æ ‡ï¼'; specialNote = 'ä¼ è¯´ä¸­çš„å®Œç¾é€šå…³ï¼'; }
            else if (modifiers.includes('barely_alive')) { title += ' - æ­»é‡Œé€ƒç”Ÿ'; subtitle = 'åœ¨æ­»äº¡è¾¹ç¼˜å®Œæˆä»»åŠ¡ï¼'; specialNote = 'çœŸæ­£çš„æ­»ç¥è”‘è§†è€…ï¼'; }
            if (modifiers.includes('speedrun')) { title += ' - é—ªç”µè¡ŒåŠ¨'; subtitle = 'ä»¥æƒŠäººçš„é€Ÿåº¦å®ŒæˆæŒ‘æˆ˜ï¼'; specialNote = 'é€Ÿåº¦å°±æ˜¯ç”Ÿå‘½ï¼'; }
            if (modifiers.includes('ninja')) { title += ' - æš—å½±å¤§å¸ˆ'; subtitle = 'å¦‚å½±éšå½¢ï¼Œæ— å£°æ— æ¯ï¼'; specialNote = 'å¿è€…ä¹‹é“ï¼Œå¤§æˆï¼'; }
            message = generateEndingMessage(baseType, modifiers);
            return { emoji: base.emoji, title, subtitle, specialNote, message, class: base.class };
        }

        function generateEndingMessage(baseType, modifiers) {
            const messages = {
                legendary: ['ç¥è¯è¯ç”Ÿï¼ä½ çš„è¡¨ç°å·²ç»è¶…è¶Šäº†æ¸¸æˆçš„æé™ï¼', 'ä¼ å¥‡ä¸­çš„ä¼ å¥‡ï¼ä½ åˆ›é€ äº†å‰æ— å¤äººçš„å®Œç¾è®°å½•ï¼'],
                success: ['å¥‡è¿¹ï¼ä½ æˆåŠŸé€ƒè„±äº†ï¼è·å¾—äº†ä¼ è¯´ä¸­çš„ROOTæƒé™ï¼', 'ä¸å¯æ€è®®ï¼ä½ çœŸçš„åšåˆ°äº†ï¼æˆä¸ºäº†å°ç±³é©¬æ‹‰æ¾çš„ä¼ å¥‡äººç‰©ï¼'],
                caught: ['å¾ˆé—æ†¾ï¼Œä½ è¢«æŠ“ä½äº†...è™½ç„¶BLè§£é”äº†ï¼Œä½†é¢ä¸´å·¨é¢èµ”å¿ï¼', 'åŠŸäºä¸€ç¯‘ï¼è¢«ä¿å®‰åˆ¶æœäº†ï¼Œä¸è¿‡è‡³å°‘è®¾å¤‡è§£é”äº†ï¼'],
                failure: ['å®Œå…¨å¤±è´¥ï¼BLæ²¡è§£é”ï¼Œè¿˜å¯èƒ½é¢ä¸´èµ·è¯‰ï¼', 'ä»»åŠ¡å¤±è´¥ï¼å·¥ç¨‹å¸ˆåŠæ—¶é˜»æ­¢äº†ä½ ï¼Œè®¾å¤‡ä¾ç„¶è¢«é”ç€ï¼'],
                death: ['åœ¨æ¿€çƒˆçš„è¿½é€ä¸­ï¼Œä½ ä»˜å‡ºäº†æœ€ç»ˆçš„ä»£ä»·...ä½†ç²¾ç¥æ°¸å­˜ï¼', 'å£®çƒˆç‰ºç‰²ï¼è™½ç„¶ç”Ÿå‘½ç»ˆç»“äº†ï¼Œä½†æˆä¸ºäº†è§£é”å²ä¸Šçš„è‹±é›„ï¼'],
                mental_breakdown: ['å·¨å¤§çš„å¿ƒç†å‹åŠ›è®©ä½ å½»åº•å´©æºƒäº†...ç°åœ¨åªèƒ½åœ¨åŒ»é™¢é‡Œå›å¿†...', 'ç²¾ç¥é˜²çº¿å…¨é¢å´©å¡Œï¼é«˜å¼ºåº¦çš„å‹åŠ›è®©ä½ å¤±å»äº†ç†æ™º...']
            };
            let baseMessage = messages[baseType][Math.floor(Math.random() * messages[baseType].length)];
            if (modifiers.includes('perfect')) baseMessage += '\n\nğŸ’ æ›´ä»¤äººéœ‡æƒŠçš„æ˜¯ï¼Œä½ ä»¥å®Œç¾çš„çŠ¶æ€å®Œæˆäº†è¿™ä¸€åˆ‡ï¼';
            if (modifiers.includes('barely_alive')) baseMessage += '\n\nğŸ’€ è™½ç„¶ä½ å‡ ä¹æ­»åœ¨äº†è·¯ä¸Šï¼Œä½†å‡­å€Ÿç€æƒŠäººçš„æ„å¿—åŠ›åšæŒåˆ°äº†æœ€åï¼';
            if (modifiers.includes('ninja')) baseMessage += '\n\nğŸ¥· ä½ çš„å¿è€…æŠ€èƒ½å‘æŒ¥äº†å…³é”®ä½œç”¨ï¼';
            return baseMessage;
        }

        function getMotivationalMessage(resultType, successRate) {
            if (resultType === 'success' || resultType === 'legendary') return 'ğŸ† æ­å–œæˆä¸ºå°ç±³é©¬æ‹‰æ¾å¤§å¸ˆï¼ä½ å°±æ˜¯ä¼ è¯´ä¸­çš„æˆåŠŸè€…ï¼';
            if (resultType === 'caught') return 'ğŸ˜… è™½ç„¶è¢«æŠ“ä½†è‡³å°‘å°è¯•äº†ï¼å‹‡æ°”å¯å˜‰ï¼Œç»§ç»­åŠªåŠ›ï¼';
            if (successRate >= 60) return 'ğŸ’ª æˆåŠŸç‡å¾ˆé«˜ï¼è¿æ°”å·®äº†ç‚¹ï¼Œå†è¯•è¯•å§ï¼';
            if (successRate >= 40) return 'ğŸ“ˆ æˆåŠŸç‡ä¸é”™ï¼å†è°ƒæ•´ä¸€ä¸‹ç­–ç•¥å°±èƒ½æˆåŠŸäº†ï¼';
            return 'ğŸ’¡ æç¤ºï¼šé€‰æ‹©æ›´å¥½çš„è£…å¤‡å’Œè®­ç»ƒé€‰é¡¹èƒ½å¤§å¹…æå‡æˆåŠŸç‡ï¼';
        }

        function shareResult(resultType, successRate, gameTime, rating) {
            const resultEmojis = { 'success': 'ğŸ‰', 'legendary': 'ğŸ‘‘', 'caught': 'ğŸ˜…', 'failure': 'ğŸ˜¢', 'death': 'ğŸ’€', 'mental_breakdown': 'ğŸ¤¯' };
            const resultNames = { 'success': 'æˆåŠŸç»“å±€', 'legendary': 'ä¼ å¥‡ç»“å±€', 'caught': 'è¢«æŠ“ç»“å±€', 'failure': 'å¤±è´¥ç»“å±€', 'death': 'æ­»äº¡ç»“å±€', 'mental_breakdown': 'ç²¾ç¥å´©æºƒç»“å±€' };
            const shareText = `ğŸƒâ€â™‚ï¸ æˆ‘åˆšä½“éªŒäº†"å°ç±³å¤‡è·‘ç½‘"BLè§£é”æ¨¡æ‹Ÿå™¨ï¼\nè¿™æ˜¯ä¸€ä¸ªçº¯å¨±ä¹çš„æ–‡å­—å†’é™©æ¸¸æˆ\né…·å®‰ @è´åˆ©äºšè¶…çº§æ— æ•Œå¤§ç‹ åˆ¶ä½œçš„è™šæ„æ¸¸æˆä½“éªŒ\n\n${resultEmojis[resultType]} ç»“å±€ï¼š${resultNames[resultType]}\nğŸ“Š æœ€ç»ˆæˆåŠŸç‡ï¼š${successRate}%\nâ±ï¸ æ¸¸æˆæ—¶é•¿ï¼š${gameTime}ç§’\nğŸ¯ ç»¼åˆè¯„çº§ï¼š${rating}\nâ¤ï¸ æœ€ç»ˆå¥åº·ï¼š${health}/100\nğŸ§  ç²¾ç¥çŠ¶æ€ï¼š${mentalHealth}/100\n\n${successRate >= 50 ? 'æˆ‘åœ¨æ¸¸æˆä¸­æˆåŠŸç‡è¿™ä¹ˆé«˜ï¼' : 'è¿™è™šæ„æ¸¸æˆçœŸçš„å¤ªéš¾äº†...'}\nåˆ«ç¬‘ï¼Œä½ æ¥ä¹Ÿé€šä¸äº†å…³ï¼\næ¸¸æˆåœ°å€ï¼š8805288.xyz`;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(shareText).then(() => alert('ğŸ‰ åˆ†äº«å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼')).catch(() => fallbackCopyTextToClipboard(shareText));
            } else {
                fallbackCopyTextToClipboard(shareText);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0"; textArea.style.left = "0"; textArea.style.position = "fixed"; textArea.style.opacity = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                alert('ğŸ‰ åˆ†äº«å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } catch (err) {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚');
            }
            document.body.removeChild(textArea);
        }

        function updateTimer() {
            if (gameStartTime > 0) {
                const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            setTimeout(updateTimer, 1000);
        }

        // --- Hidden Menu & Easter Eggs ---
        function logoClick() {
            logoClicks++;
            if (logoClicks >= 5) {
                document.getElementById('hiddenMenu').style.display = 'block';
                logoClicks = 0;
                alert('ğŸ•µï¸ éšè—èœå•å·²æ¿€æ´»ï¼');
            }
        }

        function titleClick() {
            titleClicks++;
            if (titleClicks >= 3) {
                alert('ğŸ’¡ æç¤ºï¼šè¯•è¯•è¿ç»­ç‚¹å‡»5æ¬¡logoï¼');
                titleClicks = 0;
            }
        }

        function checkKonami(event) {
            konamiCode += event.key;
            if (konamiCode.includes('ArrowUpArrowUpArrowDownArrowDownArrowLeftArrowRightArrowLeftArrowRightba')) {
                document.getElementById('hiddenMenu').style.display = 'block';
                alert('ğŸ® ç§‘ä¹ç¾ç§˜ç±æ¿€æ´»ï¼');
                konamiCode = '';
            }
            if (konamiCode.length > 50) konamiCode = '';
        }

        function toggleGodMode() {
            godMode = !godMode;
            alert(godMode ? 'ğŸ˜‡ ä¸Šå¸æ¨¡å¼å¼€å¯ï¼' : 'ğŸ˜ˆ ä¸Šå¸æ¨¡å¼å…³é—­ï¼');
            updateStats();
        }

        function setMaxStats() {
            Object.keys(playerStats).forEach(key => playerStats[key] = 10);
            skillPoints += 20;
            alert('ğŸ’ª å±æ€§å·²è®¾ç½®ä¸ºæœ€å¤§å€¼ï¼æŠ€èƒ½ç‚¹æ•°+20ï¼');
            updateStats();
        }

        function showAllEndings() {
            alert(`ğŸ¯ æ¸¸æˆç»“å±€å˜ä½“ä¼—å¤šï¼\n\nåŸºç¡€ç»“å±€ç±»å‹ï¼š\nğŸ‘‘ ä¼ å¥‡, ğŸ‰ æˆåŠŸ, ğŸ˜… è¢«æŠ“, ğŸ˜¢ å¤±è´¥, ğŸ’€ æ­»äº¡, ğŸ¤¯ ç²¾ç¥å´©æºƒ\n\nç‰¹æ®Šå˜ä½“ï¼ˆåŸºäºè¡¨ç°ï¼‰ï¼š\nğŸ’ å®Œç¾æ— ç‘•, ğŸ’€ æ­»é‡Œé€ƒç”Ÿ, ğŸ¥· æš—å½±å¤§å¸ˆ, ğŸ’» ç½‘ç»œå¹½çµ, âš¡ é—ªç”µè¡ŒåŠ¨ç­‰ã€‚\n\nå°è¯•ä¸åŒé€‰æ‹©ä»¥è§£é”ï¼`);
        }

        function unlockAllAchievements() {
            achievementList.forEach(ach => unlockAchievement(ach.id));
            alert('ğŸ† æ‰€æœ‰æˆå°±å·²è§£é”ï¼');
        }

        function toggleDock() {
            const dock = document.getElementById('statsDock');
            const toggle = document.getElementById('dockToggle');
            const isHidden = dock.style.display === 'none';
            dock.style.display = isHidden ? 'block' : 'none';
            if (isHidden) {
                toggle.textContent = 'Ã—';
                toggle.style.backgroundColor = 'rgba(220, 53, 69, 0.9)';
            }
        }

        function showAbout() { 
            document.getElementById('aboutModal').style.display = 'block'; 
            // é˜»æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = 'hidden';
        }
        
        function closeAbout() { 
            document.getElementById('aboutModal').style.display = 'none'; 
            // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = 'auto';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('aboutModal');
            if (event.target === modal) {
                modal.style.display = 'none';
                // æ¢å¤èƒŒæ™¯æ»šåŠ¨
                document.body.style.overflow = 'auto';
            }
        }

        // --- Initial Setup ---
        updateTimer();
        document.getElementById('konamiInput').focus();
    </script>
</body>
</html>
